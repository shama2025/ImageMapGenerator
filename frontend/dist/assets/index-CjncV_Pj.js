(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var ii=Object.defineProperty,oi=(t,n,e)=>n in t?ii(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,Tn=(t,n,e)=>oi(t,typeof n!="symbol"?n+"":n,e);function mt(){}function pn(t,n){for(const e in n)t[e]=n[e];return t}function Or(t){return t()}function Ln(){return Object.create(null)}function Mt(t){t.forEach(Or)}function bt(t){return typeof t=="function"}function xt(t,n){return t!=t?n==n:t!==n||t&&typeof t=="object"||typeof t=="function"}function si(t){return Object.keys(t).length===0}function Ir(t,...n){if(t==null){for(const r of n)r(void 0);return mt}const e=t.subscribe(...n);return e.unsubscribe?()=>e.unsubscribe():e}function Ge(t,n,e){t.$$.on_destroy.push(Ir(n,e))}function ai(t,n,e,r){if(t){const i=Tr(t,n,e,r);return t[0](i)}}function Tr(t,n,e,r){return t[1]&&r?pn(e.ctx.slice(),t[1](r(n))):e.ctx}function li(t,n,e,r){if(t[2]&&r){const i=t[2](r(e));if(n.dirty===void 0)return i;if(typeof i=="object"){const o=[],a=Math.max(n.dirty.length,i.length);for(let s=0;s<a;s+=1)o[s]=n.dirty[s]|i[s];return o}return n.dirty|i}return n.dirty}function ci(t,n,e,r,i,o){if(i){const a=Tr(n,e,r,o);t.p(a,i)}}function di(t){if(t.ctx.length>32){const n=[],e=t.ctx.length/32;for(let r=0;r<e;r++)n[r]=-1;return n}return-1}function zn(t){const n={};for(const e in t)e[0]!=="$"&&(n[e]=t[e]);return n}function ce(t){return t??""}function dt(t,n){t.appendChild(n)}function it(t,n,e){t.insertBefore(n,e||null)}function rt(t){t.parentNode&&t.parentNode.removeChild(t)}function te(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}function tt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Lr(t){return document.createTextNode(t)}function zt(){return Lr(" ")}function Dt(){return Lr("")}function ht(t,n,e,r){return t.addEventListener(n,e,r),()=>t.removeEventListener(n,e,r)}function y(t,n,e){e==null?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function ui(t){return Array.from(t.childNodes)}function Ht(t,n,e){t.classList.toggle(n,!!e)}function fi(t,n,{bubbles:e=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:n,bubbles:e,cancelable:r})}let ke;function xe(t){ke=t}function zr(){if(!ke)throw new Error("Function called outside component initialization");return ke}function ee(t){zr().$$.on_mount.push(t)}function Kt(){const t=zr();return(n,e,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[n];if(i){const o=fi(n,e,{cancelable:r});return i.slice().forEach(a=>{a.call(t,o)}),!o.defaultPrevented}return!0}}function Ct(t,n){const e=t.$$.callbacks[n.type];e&&e.slice().forEach(r=>r.call(this,n))}const ae=[],De=[];let he=[];const Bn=[],Br=Promise.resolve();let mn=!1;function Rr(){mn||(mn=!0,Br.then(Mr))}function Pr(){return Rr(),Br}function gn(t){he.push(t)}const Ve=new Set;let re=0;function Mr(){if(re!==0)return;const t=ke;do{try{for(;re<ae.length;){const n=ae[re];re++,xe(n),hi(n.$$)}}catch(n){throw ae.length=0,re=0,n}for(xe(null),ae.length=0,re=0;De.length;)De.pop()();for(let n=0;n<he.length;n+=1){const e=he[n];Ve.has(e)||(Ve.add(e),e())}he.length=0}while(ae.length);for(;Bn.length;)Bn.pop()();mn=!1,Ve.clear(),xe(t)}function hi(t){if(t.fragment!==null){t.update(),Mt(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(gn)}}function pi(t){const n=[],e=[];he.forEach(r=>t.indexOf(r)===-1?n.push(r):e.push(r)),e.forEach(r=>r()),he=n}const Re=new Set;let Qt;function Bt(){Qt={r:0,c:[],p:Qt}}function Rt(){Qt.r||Mt(Qt.c),Qt=Qt.p}function ot(t,n){t&&t.i&&(Re.delete(t),t.i(n))}function lt(t,n,e,r){if(t&&t.o){if(Re.has(t))return;Re.add(t),Qt.c.push(()=>{Re.delete(t),r&&(e&&t.d(1),r())}),t.o(n)}else r&&r()}function Pt(t){return t?.length!==void 0?t:Array.from(t)}function At(t){t&&t.c()}function Et(t,n,e){const{fragment:r,after_update:i}=t.$$;r&&r.m(n,e),gn(()=>{const o=t.$$.on_mount.map(Or).filter(bt);t.$$.on_destroy?t.$$.on_destroy.push(...o):Mt(o),t.$$.on_mount=[]}),i.forEach(gn)}function $t(t,n){const e=t.$$;e.fragment!==null&&(pi(e.after_update),Mt(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function mi(t,n){t.$$.dirty[0]===-1&&(ae.push(t),Rr(),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function Tt(t,n,e,r,i,o,a=null,s=[-1]){const l=ke;xe(t);const c=t.$$={fragment:null,ctx:[],props:o,update:mt,not_equal:i,bound:Ln(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(l?l.$$.context:[])),callbacks:Ln(),dirty:s,skip_bound:!1,root:n.target||l.$$.root};a&&a(c.root);let f=!1;if(c.ctx=e?e(t,n.props||{},(d,p,...g)=>{const w=g.length?g[0]:p;return c.ctx&&i(c.ctx[d],c.ctx[d]=w)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](w),f&&mi(t,d)),p}):[],c.update(),f=!0,Mt(c.before_update),c.fragment=r?r(c.ctx):!1,n.target){if(n.hydrate){const d=ui(n.target);c.fragment&&c.fragment.l(d),d.forEach(rt)}else c.fragment&&c.fragment.c();n.intro&&ot(t.$$.fragment),Et(t,n.target,n.anchor),Mr()}xe(l)}class Lt{constructor(){Tn(this,"$$"),Tn(this,"$$set")}$destroy(){$t(this,1),this.$destroy=mt}$on(n,e){if(!bt(e))return mt;const r=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return r.push(e),()=>{const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}$set(n){this.$$set&&!si(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const gi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(gi);var kt=(t=>(t.ELLIPSE="ELLIPSE",t.MULTIPOLYGON="MULTIPOLYGON",t.POLYGON="POLYGON",t.POLYLINE="POLYLINE",t.RECTANGLE="RECTANGLE",t.LINE="LINE",t))(kt||{}),yi={exports:{}};(function(t){(function(){function n(s,l){var c=s.x-l.x,f=s.y-l.y;return c*c+f*f}function e(s,l,c){var f=l.x,d=l.y,p=c.x-f,g=c.y-d;if(p!==0||g!==0){var w=((s.x-f)*p+(s.y-d)*g)/(p*p+g*g);w>1?(f=c.x,d=c.y):w>0&&(f+=p*w,d+=g*w)}return p=s.x-f,g=s.y-d,p*p+g*g}function r(s,l){for(var c=s[0],f=[c],d,p=1,g=s.length;p<g;p++)d=s[p],n(d,c)>l&&(f.push(d),c=d);return c!==d&&f.push(d),f}function i(s,l,c,f,d){for(var p=f,g,w=l+1;w<c;w++){var h=e(s[w],s[l],s[c]);h>p&&(g=w,p=h)}p>f&&(g-l>1&&i(s,l,g,f,d),d.push(s[g]),c-g>1&&i(s,g,c,f,d))}function o(s,l){var c=s.length-1,f=[s[0]];return i(s,0,c,l,f),f.push(s[c]),f}function a(s,l,c){if(s.length<=2)return s;var f=l!==void 0?l*l:1;return s=c?s:r(s,f),s=o(s,f),s}t.exports=a,t.exports.default=a})()})(yi);const kn={},me=(t,n)=>kn[t]=n,yn=t=>kn[t.type].area(t),vi=(t,n,e,r)=>kn[t.type].intersects(t,n,e,r),Ft=t=>{let n=1/0,e=1/0,r=-1/0,i=-1/0;return t.forEach(([o,a])=>{n=Math.min(n,o),e=Math.min(e,a),r=Math.max(r,o),i=Math.max(i,a)}),{minX:n,minY:e,maxX:r,maxY:i}},Ue=t=>{let n=0,e=t.length-1;for(let r=0;r<t.length;r++)n+=(t[e][0]+t[r][0])*(t[e][1]-t[r][1]),e=r;return Math.abs(.5*n)},Ne=(t,n,e)=>{let r=!1;for(let i=0,o=t.length-1;i<t.length;o=i++){const a=t[i][0],s=t[i][1],l=t[o][0],c=t[o][1];s>e!=c>e&&n<(l-a)*(e-s)/(c-s)+a&&(r=!r)}return r},wi=(t,n=!0)=>{let e="M ";return t.forEach(([r,i],o)=>{o===0?e+=`${r},${i}`:e+=` L ${r},${i}`}),n&&(e+=" Z"),e},Pe=(t,n)=>{const e=Math.abs(n[0]-t[0]),r=Math.abs(n[1]-t[1]);return Math.sqrt(Math.pow(e,2)+Math.pow(r,2))},bi={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,n,e)=>{const{cx:r,cy:i,rx:o,ry:a}=t.geometry,s=0,l=Math.cos(s),c=Math.sin(s),f=n-r,d=e-i,p=l*f+c*d,g=c*f-l*d;return p*p/(o*o)+g*g/(a*a)<=1}};me(kt.ELLIPSE,bi);const _i={area:t=>0,intersects:(t,n,e,r=2)=>{const[[i,o],[a,s]]=t.geometry.points,l=Math.abs((s-o)*n-(a-i)*e+a*o-s*i),c=Pe([i,o],[a,s]);return l/c<=r}};me(kt.LINE,_i);const xi={area:t=>{const{polygons:n}=t.geometry;return n.reduce((e,r)=>{const[i,...o]=r.rings,a=Ue(i.points),s=o.reduce((l,c)=>l+Ue(c.points),0);return e+a-s},0)},intersects:(t,n,e)=>{const{polygons:r}=t.geometry;for(const i of r){const[o,...a]=i.rings;if(Ne(o.points,n,e)){let s=!1;for(const l of a)if(Ne(l.points,n,e)){s=!0;break}if(!s)return!0}}return!1}},qe=t=>{const n=t.reduce((e,r)=>[...e,...r.rings[0].points],[]);return Ft(n)},Gt=t=>t.rings.map(n=>wi(n.points)).join(" "),ki=t=>t.polygons.reduce((n,e)=>[...n,...e.rings.reduce((r,i)=>[...r,...i.points],[])],[]);me(kt.MULTIPOLYGON,xi);const Ei={area:t=>{const n=t.geometry.points;return Ue(n)},intersects:(t,n,e)=>{const r=t.geometry.points;return Ne(r,n,e)}};me(kt.POLYGON,Ei);const $i={area:t=>{const n=t.geometry;if(!n.closed||n.points.length<3)return 0;const e=Rn(n.points,n.closed);return Ue(e)},intersects:(t,n,e,r=2)=>{const i=t.geometry;if(i.closed){const o=Rn(i.points,i.closed);return Ne(o,n,e)}else return Si(i,[n,e],r)}},Rn=(t,n=!1)=>{const e=[];for(let r=0;r<t.length;r++){const i=t[r],o=t[(r+1)%t.length];if(e.push(i.point),(r<t.length-1||n)&&(i.type==="CURVE"||o.type=="CURVE")){const a=Dr(i.point,i.type==="CURVE"&&i.outHandle||i.point,o.type==="CURVE"&&o.inHandle||o.point,o.point,10);e.push(...a.slice(1))}}return e},Dr=(t,n,e,r,i=10)=>{const o=[];for(let a=0;a<=i;a++){const s=a/i,l=Math.pow(1-s,3)*t[0]+3*Math.pow(1-s,2)*s*n[0]+3*(1-s)*Math.pow(s,2)*e[0]+Math.pow(s,3)*r[0],c=Math.pow(1-s,3)*t[1]+3*Math.pow(1-s,2)*s*n[1]+3*(1-s)*Math.pow(s,2)*e[1]+Math.pow(s,3)*r[1];o.push([l,c])}return o},Si=(t,n,e)=>{for(let r=0;r<t.points.length-1;r++){const i=t.points[r],o=t.points[r+1];if(i.type==="CURVE"||o.type==="CURVE"){const a=Dr(i.point,i.type==="CURVE"&&i.outHandle||i.point,o.type==="CURVE"&&o.inHandle||o.point,o.point,20);for(let s=0;s<a.length-1;s++)if(Pn(n,a[s],a[s+1])<=e)return!0}else if(Pn(n,i.point,o.point)<=e)return!0}return!1},Pn=(t,n,e)=>{const[r,i]=t,[o,a]=n,[s,l]=e,c=s-o,f=l-a,d=Math.sqrt(c*c+f*f);if(d===0)return Math.sqrt((r-o)*(r-o)+(i-a)*(i-a));const p=((r-o)*c+(i-a)*f)/(d*d);return p<=0?Math.sqrt((r-o)*(r-o)+(i-a)*(i-a)):p>=1?Math.sqrt((r-s)*(r-s)+(i-l)*(i-l)):Math.abs((l-a)*r-(s-o)*i+s*a-l*o)/d},Ai=t=>{if(!t.points||t.points.length===0)return"";const n=[],e=t.points[0];n.push(`M ${e.point[0]} ${e.point[1]}`);for(let r=1;r<t.points.length;r++){const i=t.points[r],o=t.points[r-1];if(i.type==="CURVE"||o.type==="CURVE"){const a=o.type==="CURVE"&&o.outHandle||o.point,s=i.type==="CURVE"&&i.inHandle||i.point,l=i.point;n.push(`C ${a[0]} ${a[1]} ${s[0]} ${s[1]} ${l[0]} ${l[1]}`)}else n.push(`L ${i.point[0]} ${i.point[1]}`)}if(t.closed){const r=t.points[t.points.length-1],i=t.points[0];if(r.type==="CURVE"||i.type==="CURVE"){const o=r.outHandle||r.point,a=i.inHandle||i.point,s=i.point;n.push(`C ${o[0]} ${o[1]} ${a[0]} ${a[1]} ${s[0]} ${s[1]}`)}n.push("Z")}return n.join(" ")};me(kt.POLYLINE,$i);const Ci={area:t=>t.geometry.w*t.geometry.h,intersects:(t,n,e)=>n>=t.geometry.x&&n<=t.geometry.x+t.geometry.w&&e>=t.geometry.y&&e<=t.geometry.y+t.geometry.h};me(kt.RECTANGLE,Ci);const Fe=t=>Me(t.target),Me=t=>{var n,e;return t?.annotation!==void 0&&((e=(n=t?.selector)==null?void 0:n.geometry)==null?void 0:e.bounds)!==void 0},Ot=[];for(let t=0;t<256;++t)Ot.push((t+256).toString(16).slice(1));function Oi(t,n=0){return(Ot[t[n+0]]+Ot[t[n+1]]+Ot[t[n+2]]+Ot[t[n+3]]+"-"+Ot[t[n+4]]+Ot[t[n+5]]+"-"+Ot[t[n+6]]+Ot[t[n+7]]+"-"+Ot[t[n+8]]+Ot[t[n+9]]+"-"+Ot[t[n+10]]+Ot[t[n+11]]+Ot[t[n+12]]+Ot[t[n+13]]+Ot[t[n+14]]+Ot[t[n+15]]).toLowerCase()}let Ke;const Ii=new Uint8Array(16);function Ti(){if(!Ke){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ke=crypto.getRandomValues.bind(crypto)}return Ke(Ii)}const Li=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mn={randomUUID:Li};function zi(t,n,e){var r;t=t||{};const i=t.random??((r=t.rng)==null?void 0:r.call(t))??Ti();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Oi(i)}function Bi(t,n,e){return Mn.randomUUID&&!t?Mn.randomUUID():zi(t)}var Dn=Object.prototype.hasOwnProperty;function Vt(t,n){var e,r;if(t===n)return!0;if(t&&n&&(e=t.constructor)===n.constructor){if(e===Date)return t.getTime()===n.getTime();if(e===RegExp)return t.toString()===n.toString();if(e===Array){if((r=t.length)===n.length)for(;r--&&Vt(t[r],n[r]););return r===-1}if(!e||typeof t=="object"){r=0;for(e in t)if(Dn.call(t,e)&&++r&&!Dn.call(n,e)||!(e in n)||!Vt(t[e],n[e]))return!1;return Object.keys(n).length===r}}return t!==t&&n!==n}function Je(){}function Ri(t,n){return t!=t?n==n:t!==n||t&&typeof t=="object"||typeof t=="function"}const ie=[];function En(t,n=Je){let e;const r=new Set;function i(s){if(Ri(t,s)&&(t=s,e)){const l=!ie.length;for(const c of r)c[1](),ie.push(c,t);if(l){for(let c=0;c<ie.length;c+=2)ie[c][0](ie[c+1]);ie.length=0}}}function o(s){i(s(t))}function a(s,l=Je){const c=[s,l];return r.add(c),r.size===1&&(e=n(i,o)||Je),s(t),()=>{r.delete(c),r.size===0&&e&&(e(),e=null)}}return{set:i,update:o,subscribe:a}}const Pi=t=>{const{subscribe:n,set:e}=En();let r;return n(i=>r=i),t.observe(({changes:i})=>{if(r){(i.deleted||[]).some(a=>a.id===r)&&e(void 0);const o=(i.updated||[]).find(({oldValue:a})=>a.id===r);o&&e(o.newValue.id)}}),{get current(){return r},subscribe:n,set:e}};var Ur=(t=>(t.EDIT="EDIT",t.SELECT="SELECT",t.NONE="NONE",t))(Ur||{});const Oe={selected:[]},Mi=(t,n,e)=>{const{subscribe:r,set:i}=En(Oe);let o=n,a=Oe;r(h=>a=h);const s=()=>{Vt(a,Oe)||i(Oe)},l=()=>{var h;return((h=a.selected)==null?void 0:h.length)===0},c=h=>{if(l())return!1;const _=typeof h=="string"?h:h.id;return a.selected.some(v=>v.id===_)},f=(h,_)=>{let v;if(Array.isArray(h)){if(v=h.map(x=>t.getAnnotation(x)).filter(Boolean),v.length<h.length){console.warn("Invalid selection: "+h.filter(x=>!v.some($=>$.id===x)));return}}else{const x=t.getAnnotation(h);if(!x){console.warn("Invalid selection: "+h);return}v=[x]}const k=v.reduce((x,$)=>{const O=w($);return O==="EDIT"?[...x,{id:$.id,editable:!0}]:O==="SELECT"?[...x,{id:$.id}]:x},[]);i({selected:k,event:_})},d=(h,_)=>{const v=Array.isArray(h)?h:[h],k=v.map(x=>t.getAnnotation(x)).filter(x=>!!x);i({selected:k.map(x=>{const $=_===void 0?w(x)==="EDIT":_;return{id:x.id,editable:$}})}),k.length!==v.length&&console.warn("Invalid selection",h)},p=h=>{if(l())return!1;const{selected:_}=a;_.some(({id:v})=>h.includes(v))&&i({selected:_.filter(({id:v})=>!h.includes(v))})},g=h=>{o=h,d(a.selected.map(({id:_})=>_))},w=h=>Di(h,o,e);return t.observe(({changes:h})=>p((h.deleted||[]).map(_=>_.id))),{get event(){return a?a.event:null},get selected(){return a?[...a.selected]:null},get userSelectAction(){return o},clear:s,evalSelectAction:w,isEmpty:l,isSelected:c,setSelected:d,setUserSelectAction:g,subscribe:r,userSelect:f}},Di=(t,n,e)=>{const r=e?e.serialize(t):t;return typeof n=="function"?n(r):n||"EDIT"},It=[];for(let t=0;t<256;++t)It.push((t+256).toString(16).slice(1));function Ui(t,n=0){return(It[t[n+0]]+It[t[n+1]]+It[t[n+2]]+It[t[n+3]]+"-"+It[t[n+4]]+It[t[n+5]]+"-"+It[t[n+6]]+It[t[n+7]]+"-"+It[t[n+8]]+It[t[n+9]]+"-"+It[t[n+10]]+It[t[n+11]]+It[t[n+12]]+It[t[n+13]]+It[t[n+14]]+It[t[n+15]]).toLowerCase()}let Qe;const Ni=new Uint8Array(16);function Fi(){if(!Qe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Qe=crypto.getRandomValues.bind(crypto)}return Qe(Ni)}const ji=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Un={randomUUID:ji};function Xi(t,n,e){var r;t=t||{};const i=t.random??((r=t.rng)==null?void 0:r.call(t))??Fi();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ui(i)}function Hi(t,n,e){return Un.randomUUID&&!t?Un.randomUUID():Xi(t)}const tn=t=>{const n=e=>{const r={...e};return e.created&&typeof e.created=="string"&&(r.created=new Date(e.created)),e.updated&&typeof e.updated=="string"&&(r.updated=new Date(e.updated)),r};return{...t,bodies:(t.bodies||[]).map(n),target:n(t.target)}},Wi=(t,n)=>{const e=new Set(t.bodies.map(r=>r.id));return n.bodies.filter(r=>!e.has(r.id))},Yi=(t,n)=>{const e=new Set(n.bodies.map(r=>r.id));return t.bodies.filter(r=>!e.has(r.id))},Zi=(t,n)=>n.bodies.map(e=>{const r=t.bodies.find(i=>i.id===e.id);return{newBody:e,oldBody:r&&!Vt(r,e)?r:void 0}}).filter(({oldBody:e})=>e).map(({oldBody:e,newBody:r})=>({oldBody:e,newBody:r})),Gi=(t,n)=>!Vt(t.target,n.target),Nr=(t,n)=>{const e=Wi(t,n),r=Yi(t,n),i=Zi(t,n);return{oldValue:t,newValue:n,bodiesCreated:e.length>0?e:void 0,bodiesDeleted:r.length>0?r:void 0,bodiesUpdated:i.length>0?i:void 0,targetUpdated:Gi(t,n)?{oldTarget:t.target,newTarget:n.target}:void 0}};var vt=(t=>(t.LOCAL="LOCAL",t.REMOTE="REMOTE",t.SILENT="SILENT",t))(vt||{});const Vi=(t,n)=>{var e,r;const{changes:i,origin:o}=n;if(!(t.options.origin?t.options.origin===o:o!=="SILENT"))return!1;if(t.options.ignore){const{ignore:a}=t.options,s=l=>l&&l.length>0;if(!(s(i.created)||s(i.deleted))){const l=(e=i.updated)==null?void 0:e.some(f=>s(f.bodiesCreated)||s(f.bodiesDeleted)||s(f.bodiesUpdated)),c=(r=i.updated)==null?void 0:r.some(f=>f.targetUpdated);if(a==="BODY_ONLY"&&l&&!c||a==="TARGET_ONLY"&&c&&!l)return!1}}if(t.options.annotations){const a=new Set([...(i.created||[]).map(s=>s.id),...(i.deleted||[]).map(s=>s.id),...(i.updated||[]).map(({oldValue:s})=>s.id)]);return!!(Array.isArray(t.options.annotations)?t.options.annotations:[t.options.annotations]).find(s=>a.has(s))}else return!0},qi=(t,n)=>{const e=new Set((t.created||[]).map(d=>d.id)),r=new Set((t.updated||[]).map(({newValue:d})=>d.id)),i=new Set((n.created||[]).map(d=>d.id)),o=new Set((n.deleted||[]).map(d=>d.id)),a=new Set((n.updated||[]).map(({oldValue:d})=>d.id)),s=new Set((n.updated||[]).filter(({oldValue:d})=>e.has(d.id)||r.has(d.id)).map(({oldValue:d})=>d.id)),l=[...(t.created||[]).filter(d=>!o.has(d.id)).map(d=>a.has(d.id)?n.updated.find(({oldValue:p})=>p.id===d.id).newValue:d),...n.created||[]],c=[...(t.deleted||[]).filter(d=>!i.has(d.id)),...(n.deleted||[]).filter(d=>!e.has(d.id))],f=[...(t.updated||[]).filter(({newValue:d})=>!o.has(d.id)).map(d=>{const{oldValue:p,newValue:g}=d;if(a.has(g.id)){const w=n.updated.find(h=>h.oldValue.id===g.id).newValue;return Nr(p,w)}else return d}),...(n.updated||[]).filter(({oldValue:d})=>!s.has(d.id))];return{created:l,deleted:c,updated:f}},Ie=t=>{const n=t.id===void 0?Hi():t.id;return{...t,id:n,bodies:t.bodies===void 0?[]:t.bodies.map(e=>({...e,annotation:n})),target:{...t.target,annotation:n}}},Ki=t=>t.id!==void 0,Ji=()=>{const t=new Map,n=new Map,e=[],r=(b,C={})=>{e.push({onChange:b,options:C})},i=b=>{const C=e.findIndex(u=>u.onChange==b);C>-1&&e.splice(C,1)},o=(b,C)=>{const u={origin:b,changes:{created:C.created||[],updated:C.updated||[],deleted:C.deleted||[]},state:[...t.values()]};e.forEach(A=>{Vi(A,u)&&A.onChange(u)})},a=(b,C=vt.LOCAL)=>{if(b.id&&t.get(b.id))throw Error(`Cannot add annotation ${b.id} - exists already`);{const u=Ie(b);t.set(u.id,u),u.bodies.forEach(A=>n.set(A.id,u.id)),o(C,{created:[u]})}},s=(b,C)=>{const u=Ie(typeof b=="string"?C:b),A=typeof b=="string"?b:b.id,H=A&&t.get(A);if(H){const P=Nr(H,u);return A===u.id?t.set(A,u):(t.delete(A),t.set(u.id,u)),H.bodies.forEach(Y=>n.delete(Y.id)),u.bodies.forEach(Y=>n.set(Y.id,u.id)),P}else console.warn(`Cannot update annotation ${A} - does not exist`)},l=(b,C=vt.LOCAL,u=vt.LOCAL)=>{const A=Ki(C)?u:C,H=s(b,C);H&&o(A,{updated:[H]})},c=(b,C=vt.LOCAL)=>{t.get(b.id)?l(b,C):a(b,C)},f=(b,C=vt.LOCAL)=>{const u=b.reduce((A,H)=>{const P=s(H);return P?[...A,P]:A},[]);u.length>0&&o(C,{updated:u})},d=(b,C=vt.LOCAL)=>{const u=b.map(Ie),{toAdd:A,toUpdate:H}=u.reduce((Y,j)=>t.get(j.id)?{...Y,toUpdate:[...Y.toUpdate,j]}:{...Y,toAdd:[...Y.toAdd,j]},{toAdd:[],toUpdate:[]}),P=H.map(Y=>s(Y,C)).filter(Boolean);A.forEach(Y=>{t.set(Y.id,Y),Y.bodies.forEach(j=>n.set(j.id,Y.id))}),o(C,{created:A,updated:P})},p=(b,C=vt.LOCAL)=>{const u=t.get(b.annotation);if(u){const A={...u,bodies:[...u.bodies,b]};t.set(u.id,A),n.set(b.id,A.id),o(C,{updated:[{oldValue:u,newValue:A,bodiesCreated:[b]}]})}else console.warn(`Attempt to add body to missing annotation: ${b.annotation}`)},g=()=>[...t.values()],w=(b=vt.LOCAL)=>{const C=[...t.values()];t.clear(),n.clear(),o(b,{deleted:C})},h=(b,C=!0,u=vt.LOCAL)=>{const A=b.map(Ie);if(C){const H=[...t.values()];t.clear(),n.clear(),A.forEach(P=>{t.set(P.id,P),P.bodies.forEach(Y=>n.set(Y.id,P.id))}),o(u,{created:A,deleted:H})}else{const H=b.reduce((P,Y)=>{const j=Y.id&&t.get(Y.id);return j?[...P,j]:P},[]);if(H.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${H.map(P=>P.id).join(", ")}`);A.forEach(P=>{t.set(P.id,P),P.bodies.forEach(Y=>n.set(Y.id,P.id))}),o(u,{created:A})}},_=b=>{const C=typeof b=="string"?b:b.id,u=t.get(C);if(u)return t.delete(C),u.bodies.forEach(A=>n.delete(A.id)),u;console.warn(`Attempt to delete missing annotation: ${C}`)},v=(b,C=vt.LOCAL)=>{const u=_(b);u&&o(C,{deleted:[u]})},k=(b,C=vt.LOCAL)=>{const u=b.reduce((A,H)=>{const P=_(H);return P?[...A,P]:A},[]);u.length>0&&o(C,{deleted:u})},x=b=>{const C=t.get(b.annotation);if(C){const u=C.bodies.find(A=>A.id===b.id);if(u){n.delete(u.id);const A={...C,bodies:C.bodies.filter(H=>H.id!==b.id)};return t.set(C.id,A),{oldValue:C,newValue:A,bodiesDeleted:[u]}}else console.warn(`Attempt to delete missing body ${b.id} from annotation ${b.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${b.annotation}`)},$=(b,C=vt.LOCAL)=>{const u=x(b);u&&o(C,{updated:[u]})},O=(b,C=vt.LOCAL)=>{const u=b.map(A=>x(A)).filter(Boolean);u.length>0&&o(C,{updated:u})},z=b=>{const C=t.get(b);return C?{...C}:void 0},I=b=>{const C=n.get(b);if(C){const u=z(C).bodies.find(A=>A.id===b);if(u)return u;console.error(`Store integrity error: body ${b} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${b}`)},M=(b,C)=>{if(b.annotation!==C.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const u=t.get(b.annotation);if(u){const A=u.bodies.find(P=>P.id===b.id),H={...u,bodies:u.bodies.map(P=>P.id===A.id?C:P)};return t.set(u.id,H),A.id!==C.id&&(n.delete(A.id),n.set(C.id,H.id)),{oldValue:u,newValue:H,bodiesUpdated:[{oldBody:A,newBody:C}]}}else console.warn(`Attempt to add body to missing annotation ${b.annotation}`)},T=(b,C,u=vt.LOCAL)=>{const A=M(b,C);A&&o(u,{updated:[A]})},X=(b,C=vt.LOCAL)=>{const u=b.map(A=>M({id:A.id,annotation:A.annotation},A)).filter(Boolean);o(C,{updated:u})},G=b=>{const C=t.get(b.annotation);if(C){const u={...C,target:{...C.target,...b}};return t.set(C.id,u),{oldValue:C,newValue:u,targetUpdated:{oldTarget:C.target,newTarget:b}}}else console.warn(`Attempt to update target on missing annotation: ${b.annotation}`)};return{addAnnotation:a,addBody:p,all:g,bulkAddAnnotations:h,bulkDeleteAnnotations:k,bulkDeleteBodies:O,bulkUpdateAnnotations:f,bulkUpdateBodies:X,bulkUpdateTargets:(b,C=vt.LOCAL)=>{const u=b.map(A=>G(A)).filter(Boolean);u.length>0&&o(C,{updated:u})},bulkUpsertAnnotations:d,clear:w,deleteAnnotation:v,deleteBody:$,getAnnotation:z,getBody:I,observe:r,unobserve:i,updateAnnotation:l,updateBody:T,updateTarget:(b,C=vt.LOCAL)=>{const u=G(b);u&&o(C,{updated:[u]})},upsertAnnotation:c}},Qi=t=>({...t,subscribe:n=>{const e=r=>n(r.state);return t.observe(e),n(t.all()),()=>t.unobserve(e)}});let to=()=>({emit(t,...n){for(let e=this.events[t]||[],r=0,i=e.length;r<i;r++)e[r](...n)},events:{},on(t,n){var e;return((e=this.events)[t]||(e[t]=[])).push(n),()=>{var r;this.events[t]=(r=this.events[t])==null?void 0:r.filter(i=>n!==i)}}});const eo=250,no=(t,n)=>{const e=to(),r=n?.changes||[];let i=n?n.pointer:-1,o=!1,a=0;const s=w=>{if(!o){const{changes:h}=w,_=performance.now();if(_-a>eo)r.splice(i+1),r.push(h),i=r.length-1;else{const v=r.length-1;r[v]=qi(r[v],h)}a=_}o=!1};t.observe(s,{origin:vt.LOCAL});const l=w=>w&&w.length>0&&t.bulkDeleteAnnotations(w),c=w=>w&&w.length>0&&t.bulkAddAnnotations(w,!1),f=w=>w&&w.length>0&&t.bulkUpdateAnnotations(w.map(({oldValue:h})=>h)),d=w=>w&&w.length>0&&t.bulkUpdateAnnotations(w.map(({newValue:h})=>h)),p=w=>w&&w.length>0&&t.bulkAddAnnotations(w,!1),g=w=>w&&w.length>0&&t.bulkDeleteAnnotations(w);return{canRedo:()=>r.length-1>i,canUndo:()=>i>-1,destroy:()=>t.unobserve(s),getHistory:()=>({changes:[...r],pointer:i}),on:(w,h)=>e.on(w,h),redo:()=>{if(r.length-1>i){o=!0;const{created:w,updated:h,deleted:_}=r[i+1];c(w),d(h),g(_),e.emit("redo",r[i+1]),i+=1}},undo:()=>{if(i>-1){o=!0;const{created:w,updated:h,deleted:_}=r[i];l(w),f(h),p(_),e.emit("undo",r[i]),i-=1}}}},ro=()=>{const{subscribe:t,set:n}=En([]);return{subscribe:t,set:n}},io=(t,n,e,r)=>{const{hover:i,selection:o,store:a,viewport:s}=t,l=new Map;let c=[],f,d;const p=(v,k)=>{l.has(v)?l.get(v).push(k):l.set(v,[k])},g=(v,k)=>{const x=l.get(v);if(x){const $=x.indexOf(k);$!==-1&&x.splice($,1)}},w=(v,k,x)=>{l.has(v)&&setTimeout(()=>{l.get(v).forEach($=>{if(e){const O=Array.isArray(k)?k.map(I=>e.serialize(I)):e.serialize(k),z=x?x instanceof PointerEvent?x:e.serialize(x):void 0;$(O,z)}else $(k,x)})},1)},h=()=>{const{selected:v}=o,k=(v||[]).map(({id:x})=>a.getAnnotation(x));k.forEach(x=>{const $=c.find(O=>O.id===x.id);(!$||!Vt($,x))&&w("updateAnnotation",x,$)}),c=c.map(x=>k.find(({id:$})=>$===x.id)||x)};o.subscribe(({selected:v})=>{if(!(c.length===0&&v.length===0)){if(c.length===0&&v.length>0)c=v.map(({id:k})=>a.getAnnotation(k));else if(c.length>0&&v.length===0)c.forEach(k=>{const x=a.getAnnotation(k.id);x&&!Vt(x,k)&&w("updateAnnotation",x,k)}),c=[];else{const k=new Set(c.map($=>$.id)),x=new Set(v.map(({id:$})=>$));c.filter($=>!x.has($.id)).forEach($=>{const O=a.getAnnotation($.id);O&&!Vt(O,$)&&w("updateAnnotation",O,$)}),c=[...c.filter($=>x.has($.id)),...v.filter(({id:$})=>!k.has($)).map(({id:$})=>a.getAnnotation($))]}w("selectionChanged",c)}}),i.subscribe(v=>{!f&&v?w("mouseEnterAnnotation",a.getAnnotation(v)):f&&!v?w("mouseLeaveAnnotation",a.getAnnotation(f)):f&&v&&(w("mouseLeaveAnnotation",a.getAnnotation(f)),w("mouseEnterAnnotation",a.getAnnotation(v))),f=v}),s?.subscribe(v=>w("viewportIntersect",v.map(k=>a.getAnnotation(k)))),a.observe(v=>{r&&(d&&clearTimeout(d),d=setTimeout(h,1e3));const{created:k,deleted:x}=v.changes;(k||[]).forEach($=>w("createAnnotation",$)),(x||[]).forEach($=>w("deleteAnnotation",$)),(v.changes.updated||[]).filter($=>[...$.bodiesCreated||[],...$.bodiesDeleted||[],...$.bodiesUpdated||[]].length>0).forEach(({oldValue:$,newValue:O})=>{const z=c.find(I=>I.id===$.id)||$;c=c.map(I=>I.id===$.id?O:I),w("updateAnnotation",O,z)})},{origin:vt.LOCAL}),a.observe(v=>{if(c){const k=new Set(c.map($=>$.id)),x=(v.changes.updated||[]).filter(({newValue:$})=>k.has($.id)).map(({newValue:$})=>$);x.length>0&&(c=c.map($=>x.find(O=>O.id===$.id)||$))}},{origin:vt.REMOTE});const _=v=>k=>{const{updated:x}=k;v?(x||[]).forEach($=>w("updateAnnotation",$.oldValue,$.newValue)):(x||[]).forEach($=>w("updateAnnotation",$.newValue,$.oldValue))};return n.on("undo",_(!0)),n.on("redo",_(!1)),{on:p,off:g,emit:w}},oo=t=>n=>n.reduce((e,r)=>{const{parsed:i,error:o}=t.parse(r);return o?{parsed:e.parsed,failed:[...e.failed,r]}:i?{parsed:[...e.parsed,i],failed:e.failed}:{...e}},{parsed:[],failed:[]}),so=(t,n,e)=>{const{store:r,selection:i}=t,o=v=>{if(e){const{parsed:k,error:x}=e.parse(v);k?r.addAnnotation(k,vt.REMOTE):console.error(x)}else r.addAnnotation(tn(v),vt.REMOTE)},a=()=>i.clear(),s=()=>r.clear(),l=v=>{const k=r.getAnnotation(v);return e&&k?e.serialize(k):k},c=()=>e?r.all().map(e.serialize):r.all(),f=()=>{var v;const k=(((v=i.selected)==null?void 0:v.map(x=>x.id))||[]).map(x=>r.getAnnotation(x)).filter(Boolean);return e?k.map(e.serialize):k},d=(v,k=!0)=>fetch(v).then(x=>x.json()).then(x=>(g(x,k),x)),p=v=>{if(typeof v=="string"){const k=r.getAnnotation(v);if(r.deleteAnnotation(v),k)return e?e.serialize(k):k}else{const k=e?e.parse(v).parsed:v;if(k)return r.deleteAnnotation(k),v}},g=(v,k=!0)=>{if(e){const x=e.parseAll||oo(e),{parsed:$,failed:O}=x(v);O.length>0&&console.warn(`Discarded ${O.length} invalid annotations`,O),r.bulkAddAnnotations($,k,vt.REMOTE)}else r.bulkAddAnnotations(v.map(tn),k,vt.REMOTE)},w=(v,k)=>{v?i.setSelected(v,k):i.clear()},h=v=>{i.setUserSelectAction(v)},_=v=>{if(e){const k=e.parse(v).parsed,x=e.serialize(r.getAnnotation(k.id));return r.updateAnnotation(k),x}else{const k=r.getAnnotation(v.id);return r.updateAnnotation(tn(v)),k}};return{addAnnotation:o,cancelSelected:a,canRedo:n.canRedo,canUndo:n.canUndo,clearAnnotations:s,getAnnotationById:l,getAnnotations:c,getHistory:n.getHistory,getSelected:f,loadAnnotations:d,redo:n.redo,removeAnnotation:p,setAnnotations:g,setSelected:w,setUserSelectAction:h,undo:n.undo,updateAnnotation:_}},ao="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let lo=t=>crypto.getRandomValues(new Uint8Array(t)),co=(t,n,e)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*n/t.length);return(o=n)=>{let a="";for(;;){let s=e(i),l=i|0;for(;l--;)if(a+=t[s[l]&r]||"",a.length>=o)return a}}},uo=(t,n=21)=>co(t,n|0,lo),fo=(t=21)=>{let n="",e=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)n+=ao[e[t]&63];return n};const ho=()=>({isGuest:!0,id:uo("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});fo();const oe=[];function po(t,n=mt){let e;const r=new Set;function i(s){if(xt(t,s)&&(t=s,e)){const l=!oe.length;for(const c of r)c[1](),oe.push(c,t);if(l){for(let c=0;c<oe.length;c+=2)oe[c][0](oe[c+1]);oe.length=0}}}function o(s){i(s(t))}function a(s,l=mt){const c=[s,l];return r.add(c),r.size===1&&(e=n(i,o)||mt),s(t),()=>{r.delete(c),r.size===0&&e&&(e(),e=null)}}return{set:i,update:o,subscribe:a}}const mo=(t,n)=>{const{naturalWidth:e,naturalHeight:r}=t;if(!e&&!r){const{width:i,height:o}=t;n.setAttribute("viewBox",`0 0 ${i} ${o}`),t.addEventListener("load",a=>{const s=a.target;n.setAttribute("viewBox",`0 0 ${s.naturalWidth} ${s.naturalHeight}`)})}else n.setAttribute("viewBox",`0 0 ${e} ${r}`)},go=(t,n)=>{mo(t,n);const{subscribe:e,set:r}=po(1);let i;return window.ResizeObserver&&(i=new ResizeObserver(()=>{const o=n.getBoundingClientRect(),{width:a,height:s}=n.viewBox.baseVal,l=Math.max(o.width/a,o.height/s);r(l)}),i.observe(n.parentElement)),{destroy:()=>{i&&i.disconnect()},subscribe:e}},ne=(t,n)=>{const e=typeof n=="function"?n(t):n;if(e){const{fill:r,fillOpacity:i,stroke:o,strokeWidth:a,strokeOpacity:s}=e;let l="";return r&&(l+=`fill:${r};`),i||i===0?l+=`fill-opacity:${i};`:r&&(l+="fill-opacity:0.25;"),o&&(l+=`stroke:${o};`,l+=`stroke-width:${a||"1"};`,l+=`stroke-opacity:${s||"1"};`),l}},Xe=(t,n=0)=>{const{minX:e,minY:r,maxX:i,maxY:o}=t;return{x:e-n,y:r-n,w:i-e+2*n,h:o-r+2*n}},Yt=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,yo=t=>({}),Nn=t=>({grab:t[0]});function vo(t){let n,e,r,i;const o=t[8].default,a=ai(o,t,t[7],Nn);return{c(){n=tt("g"),a&&a.c(),y(n,"class","a9s-annotation selected")},m(s,l){it(s,n,l),a&&a.m(n,null),e=!0,r||(i=[ht(n,"pointerup",t[2]),ht(n,"pointermove",t[1])],r=!0)},p(s,[l]){a&&a.p&&(!e||l&128)&&ci(a,o,s,s[7],e?li(o,s[7],l,yo):di(s[7]),Nn)},i(s){e||(ot(a,s),e=!0)},o(s){lt(a,s),e=!1},d(s){s&&rt(n),a&&a.d(s),r=!1,Mt(i)}}}function wo(t,n,e){let{$$slots:r={},$$scope:i}=n;const o=Kt();let{shape:a}=n,{editor:s}=n,{transform:l}=n,{svgEl:c}=n,f,d,p;const g=_=>v=>{if(f=_,c){const{left:k,top:x}=c.getBoundingClientRect(),$=v.clientX-k,O=v.clientY-x;d=l.elementToImage($,O)}else{const{offsetX:k,offsetY:x}=v;d=l.elementToImage(k,x)}p=a,v.target.setPointerCapture(v.pointerId),o("grab",v)},w=_=>{if(f){const[v,k]=l.elementToImage(_.offsetX,_.offsetY),x=[v-d[0],k-d[1]];e(3,a=s(p,f,x)),o("change",a)}},h=_=>{_.target.releasePointerCapture(_.pointerId),f=void 0,p=a,o("release",_)};return t.$$set=_=>{"shape"in _&&e(3,a=_.shape),"editor"in _&&e(4,s=_.editor),"transform"in _&&e(5,l=_.transform),"svgEl"in _&&e(6,c=_.svgEl),"$$scope"in _&&e(7,i=_.$$scope)},[g,w,h,a,s,l,c,i,r]}class $n extends Lt{constructor(n){super(),Tt(this,n,wo,vo,xt,{shape:3,editor:4,transform:5,svgEl:6})}}function bo(t){let n,e,r,i,o,a,s,l,c=t[3]&&Fn(t);return{c(){n=tt("g"),e=tt("circle"),c&&c.c(),i=tt("circle"),y(e,"class","a9s-handle-buffer svelte-qtyc7s"),y(e,"cx",t[0]),y(e,"cy",t[1]),y(e,"r",r=t[5]+6/t[2]),y(e,"role","button"),y(e,"tabindex","0"),y(i,"class",o=ce(`a9s-handle-dot${t[3]?" selected":""}`)+" svelte-qtyc7s"),y(i,"cx",t[0]),y(i,"cy",t[1]),y(i,"r",t[5]),y(n,"class",a=`a9s-handle ${t[8].class||""}`.trim())},m(f,d){it(f,n,d),dt(n,e),c&&c.m(n,null),dt(n,i),s||(l=[ht(e,"dblclick",t[12]),ht(e,"pointerenter",t[13]),ht(e,"pointerleave",t[14]),ht(e,"pointerdown",t[15]),ht(e,"pointerdown",t[6]),ht(e,"pointerup",t[16]),ht(e,"pointerup",t[7])],s=!0)},p(f,d){d&1&&y(e,"cx",f[0]),d&2&&y(e,"cy",f[1]),d&36&&r!==(r=f[5]+6/f[2])&&y(e,"r",r),f[3]?c?c.p(f,d):(c=Fn(f),c.c(),c.m(n,i)):c&&(c.d(1),c=null),d&8&&o!==(o=ce(`a9s-handle-dot${f[3]?" selected":""}`)+" svelte-qtyc7s")&&y(i,"class",o),d&1&&y(i,"cx",f[0]),d&2&&y(i,"cy",f[1]),d&32&&y(i,"r",f[5]),d&256&&a!==(a=`a9s-handle ${f[8].class||""}`.trim())&&y(n,"class",a)},d(f){f&&rt(n),c&&c.d(),s=!1,Mt(l)}}}function _o(t){let n,e,r,i,o,a,s,l,c;return{c(){n=tt("g"),e=tt("circle"),i=tt("circle"),a=tt("circle"),y(e,"cx",t[0]),y(e,"cy",t[1]),y(e,"r",r=t[5]*10),y(e,"class","a9s-touch-halo"),Ht(e,"touched",t[4]),y(i,"cx",t[0]),y(i,"cy",t[1]),y(i,"r",o=t[5]+10/t[2]),y(i,"class","a9s-handle-buffer svelte-qtyc7s"),y(i,"role","button"),y(i,"tabindex","0"),y(a,"class","a9s-handle-dot"),y(a,"cx",t[0]),y(a,"cy",t[1]),y(a,"r",s=t[5]+2/t[2]),y(n,"class","a9s-touch-handle")},m(f,d){it(f,n,d),dt(n,e),dt(n,i),dt(n,a),l||(c=[ht(i,"dblclick",t[9]),ht(i,"pointerdown",t[10]),ht(i,"pointerdown",t[6]),ht(i,"pointerup",t[11]),ht(i,"pointerup",t[7])],l=!0)},p(f,d){d&1&&y(e,"cx",f[0]),d&2&&y(e,"cy",f[1]),d&32&&r!==(r=f[5]*10)&&y(e,"r",r),d&16&&Ht(e,"touched",f[4]),d&1&&y(i,"cx",f[0]),d&2&&y(i,"cy",f[1]),d&36&&o!==(o=f[5]+10/f[2])&&y(i,"r",o),d&1&&y(a,"cx",f[0]),d&2&&y(a,"cy",f[1]),d&36&&s!==(s=f[5]+2/f[2])&&y(a,"r",s)},d(f){f&&rt(n),l=!1,Mt(c)}}}function Fn(t){let n,e;return{c(){n=tt("circle"),y(n,"class","a9s-handle-selected"),y(n,"cx",t[0]),y(n,"cy",t[1]),y(n,"r",e=t[5]+8/t[2])},m(r,i){it(r,n,i)},p(r,i){i&1&&y(n,"cx",r[0]),i&2&&y(n,"cy",r[1]),i&36&&e!==(e=r[5]+8/r[2])&&y(n,"r",e)},d(r){r&&rt(n)}}}function xo(t){let n;function e(i,o){return Yt?_o:bo}let r=e()(t);return{c(){r.c(),n=Dt()},m(i,o){r.m(i,o),it(i,n,o)},p(i,[o]){r.p(i,o)},i:mt,o:mt,d(i){i&&rt(n),r.d(i)}}}function ko(t,n,e){let r,{x:i}=n,{y:o}=n,{scale:a}=n,{selected:s=void 0}=n,l=!1;const c=x=>{x.pointerType==="touch"&&e(4,l=!0)},f=()=>e(4,l=!1);function d(x){Ct.call(this,t,x)}function p(x){Ct.call(this,t,x)}function g(x){Ct.call(this,t,x)}function w(x){Ct.call(this,t,x)}function h(x){Ct.call(this,t,x)}function _(x){Ct.call(this,t,x)}function v(x){Ct.call(this,t,x)}function k(x){Ct.call(this,t,x)}return t.$$set=x=>{e(8,n=pn(pn({},n),zn(x))),"x"in x&&e(0,i=x.x),"y"in x&&e(1,o=x.y),"scale"in x&&e(2,a=x.scale),"selected"in x&&e(3,s=x.selected)},t.$$.update=()=>{t.$$.dirty&4&&e(5,r=4/a)},n=zn(n),[i,o,a,s,l,r,c,f,n,d,p,g,w,h,_,v,k]}class de extends Lt{constructor(n){super(),Tt(this,n,ko,xo,xt,{x:0,y:1,scale:2,selected:3})}}function Eo(t){let n,e,r,i,o,a,s;return{c(){n=tt("g"),e=tt("circle"),i=tt("circle"),o=tt("circle"),y(e,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),y(e,"cx",t[0]),y(e,"cy",t[1]),y(e,"r",r=1.75*t[2]),y(i,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),y(i,"cx",t[0]),y(i,"cy",t[1]),y(i,"r",t[2]),y(o,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),y(o,"cx",t[0]),y(o,"cy",t[1]),y(o,"r",t[2]),y(n,"class","a9s-polygon-midpoint svelte-12ykj76")},m(l,c){it(l,n,c),dt(n,e),dt(n,i),dt(n,o),a||(s=[ht(e,"pointerdown",t[5]),ht(e,"pointerdown",t[3])],a=!0)},p(l,c){c&1&&y(e,"cx",l[0]),c&2&&y(e,"cy",l[1]),c&4&&r!==(r=1.75*l[2])&&y(e,"r",r),c&1&&y(i,"cx",l[0]),c&2&&y(i,"cy",l[1]),c&4&&y(i,"r",l[2]),c&1&&y(o,"cx",l[0]),c&2&&y(o,"cy",l[1]),c&4&&y(o,"r",l[2])},d(l){l&&rt(n),a=!1,Mt(s)}}}function $o(t){let n;return{c(){n=tt("circle"),y(n,"cx",t[0]),y(n,"cy",t[1]),y(n,"r",t[2])},m(e,r){it(e,n,r)},p(e,r){r&1&&y(n,"cx",e[0]),r&2&&y(n,"cy",e[1]),r&4&&y(n,"r",e[2])},d(e){e&&rt(n)}}}function So(t){let n;function e(i,o){return Yt?$o:Eo}let r=e()(t);return{c(){r.c(),n=Dt()},m(i,o){r.m(i,o),it(i,n,o)},p(i,[o]){r.p(i,o)},i:mt,o:mt,d(i){i&&rt(n),r.d(i)}}}function Ao(t,n,e){let r,{x:i}=n,{y:o}=n,{scale:a}=n;const s=c=>{c.pointerType};function l(c){Ct.call(this,t,c)}return t.$$set=c=>{"x"in c&&e(0,i=c.x),"y"in c&&e(1,o=c.y),"scale"in c&&e(4,a=c.scale)},t.$$.update=()=>{t.$$.dirty&16&&e(2,r=4/a)},[i,o,r,s,a,l]}class Fr extends Lt{constructor(n){super(),Tt(this,n,Ao,So,xt,{x:0,y:1,scale:4})}}function en(t){const n=t.slice(),e=n[10][n[6]];return n[28]=e.point,n}function jn(t,n,e){const r=t.slice();return r[28]=n[e],r[30]=e,r}function nn(t){const n=t.slice(),e=n[10][n[6]];return n[28]=e.point,n}function rn(t){const n=t.slice(),e=n[10][n[6]];return n[28]=e.point,n}function Xn(t){let n,e,r,i;return{c(){n=tt("circle"),y(n,"cx",e=t[28][0]),y(n,"cy",r=t[28][1]),y(n,"r",i=Ee/t[3]),y(n,"class","svelte-1h2slbm")},m(o,a){it(o,n,a)},p(o,a){a[0]&1088&&e!==(e=o[28][0])&&y(n,"cx",e),a[0]&1088&&r!==(r=o[28][1])&&y(n,"cy",r),a[0]&8&&i!==(i=Ee/o[3])&&y(n,"r",i)},d(o){o&&rt(n)}}}function Hn(t){let n,e,r,i,o,a,s,l,c,f;return{c(){n=tt("mask"),e=tt("rect"),s=tt("circle"),y(e,"x",r=t[9].x),y(e,"y",i=t[9].y),y(e,"width",o=t[9].w),y(e,"height",a=t[9].h),y(e,"class","svelte-1h2slbm"),y(s,"cx",l=t[28][0]),y(s,"cy",c=t[28][1]),y(s,"r",f=Ee/t[3]),y(s,"class","svelte-1h2slbm"),y(n,"id",`${t[19]}-inner`),y(n,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(d,p){it(d,n,p),dt(n,e),dt(n,s)},p(d,p){p[0]&512&&r!==(r=d[9].x)&&y(e,"x",r),p[0]&512&&i!==(i=d[9].y)&&y(e,"y",i),p[0]&512&&o!==(o=d[9].w)&&y(e,"width",o),p[0]&512&&a!==(a=d[9].h)&&y(e,"height",a),p[0]&1088&&l!==(l=d[28][0])&&y(s,"cx",l),p[0]&1088&&c!==(c=d[28][1])&&y(s,"cy",c),p[0]&8&&f!==(f=Ee/d[3])&&y(s,"r",f)},d(d){d&&rt(n)}}}function Wn(t){let n,e;return n=new de({props:{class:"a9s-corner-handle",x:t[28][0],y:t[28][1],scale:t[3],selected:t[8].includes(t[30])}}),n.$on("pointerenter",t[11]),n.$on("pointerleave",t[12]),n.$on("pointerdown",t[15]),n.$on("pointerdown",function(){bt(t[27](`HANDLE-${t[30]}`))&&t[27](`HANDLE-${t[30]}`).apply(this,arguments)}),n.$on("pointerup",t[16](t[30])),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){t=r;const o={};i[0]&32&&(o.x=t[28][0]),i[0]&32&&(o.y=t[28][1]),i[0]&8&&(o.scale=t[3]),i[0]&256&&(o.selected=t[8].includes(t[30])),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Yn(t){let n,e;return n=new Fr({props:{x:t[28][0],y:t[28][1],scale:t[3]}}),n.$on("pointerdown",function(){bt(t[18](t[6]))&&t[18](t[6]).apply(this,arguments)}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){t=r;const o={};i[0]&1088&&(o.x=t[28][0]),i[0]&1088&&(o.y=t[28][1]),i[0]&8&&(o.scale=t[3]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Co(t){let n,e,r,i,o,a,s,l,c,f,d,p,g,w,h,_,v,k,x,$,O,z=t[6]!==void 0&&!t[7]&&Xn(rn(t)),I=t[6]!==void 0&&!t[7]&&Hn(nn(t)),M=Pt(t[5].points),T=[];for(let b=0;b<M.length;b+=1)T[b]=Wn(jn(t,M,b));const X=b=>lt(T[b],1,1,()=>{T[b]=null});let G=t[6]!==void 0&&!t[7]&&Yn(en(t));return{c(){n=tt("defs"),e=tt("mask"),r=tt("rect"),l=tt("polygon"),z&&z.c(),I&&I.c(),f=zt(),d=tt("polygon"),g=zt(),w=tt("polygon"),_=zt();for(let b=0;b<T.length;b+=1)T[b].c();v=zt(),G&&G.c(),k=Dt(),y(r,"x",i=t[9].x),y(r,"y",o=t[9].y),y(r,"width",a=t[9].w),y(r,"height",s=t[9].h),y(r,"class","svelte-1h2slbm"),y(l,"points",c=t[5].points.map(Zn).join(" ")),y(l,"class","svelte-1h2slbm"),y(e,"id",`${t[19]}-outer`),y(e,"class","a9s-polygon-editor-mask svelte-1h2slbm"),y(d,"class","a9s-outer"),y(d,"mask",`url(#${t[19]}-outer)`),y(d,"points",p=t[5].points.map(Gn).join(" ")),y(w,"class","a9s-inner a9s-shape-handle"),y(w,"mask",`url(#${t[19]}-inner)`),y(w,"style",t[1]),y(w,"points",h=t[5].points.map(Vn).join(" "))},m(b,C){it(b,n,C),dt(n,e),dt(e,r),dt(e,l),z&&z.m(e,null),I&&I.m(n,null),it(b,f,C),it(b,d,C),it(b,g,C),it(b,w,C),it(b,_,C);for(let u=0;u<T.length;u+=1)T[u]&&T[u].m(b,C);it(b,v,C),G&&G.m(b,C),it(b,k,C),x=!0,$||(O=[ht(d,"pointerup",t[14]),ht(d,"pointerdown",function(){bt(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)}),ht(w,"pointermove",t[13]),ht(w,"pointerup",t[14]),ht(w,"pointerdown",function(){bt(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)})],$=!0)},p(b,C){if(t=b,(!x||C[0]&512&&i!==(i=t[9].x))&&y(r,"x",i),(!x||C[0]&512&&o!==(o=t[9].y))&&y(r,"y",o),(!x||C[0]&512&&a!==(a=t[9].w))&&y(r,"width",a),(!x||C[0]&512&&s!==(s=t[9].h))&&y(r,"height",s),(!x||C[0]&32&&c!==(c=t[5].points.map(Zn).join(" ")))&&y(l,"points",c),t[6]!==void 0&&!t[7]?z?z.p(rn(t),C):(z=Xn(rn(t)),z.c(),z.m(e,null)):z&&(z.d(1),z=null),t[6]!==void 0&&!t[7]?I?I.p(nn(t),C):(I=Hn(nn(t)),I.c(),I.m(n,null)):I&&(I.d(1),I=null),(!x||C[0]&32&&p!==(p=t[5].points.map(Gn).join(" ")))&&y(d,"points",p),(!x||C[0]&2)&&y(w,"style",t[1]),(!x||C[0]&32&&h!==(h=t[5].points.map(Vn).join(" ")))&&y(w,"points",h),C[0]&134322472){M=Pt(t[5].points);let u;for(u=0;u<M.length;u+=1){const A=jn(t,M,u);T[u]?(T[u].p(A,C),ot(T[u],1)):(T[u]=Wn(A),T[u].c(),ot(T[u],1),T[u].m(v.parentNode,v))}for(Bt(),u=M.length;u<T.length;u+=1)X(u);Rt()}t[6]!==void 0&&!t[7]?G?(G.p(en(t),C),C[0]&192&&ot(G,1)):(G=Yn(en(t)),G.c(),ot(G,1),G.m(k.parentNode,k)):G&&(Bt(),lt(G,1,1,()=>{G=null}),Rt())},i(b){if(!x){for(let C=0;C<M.length;C+=1)ot(T[C]);ot(G),x=!0}},o(b){T=T.filter(Boolean);for(let C=0;C<T.length;C+=1)lt(T[C]);lt(G),x=!1},d(b){b&&(rt(n),rt(f),rt(d),rt(g),rt(w),rt(_),rt(v),rt(k)),z&&z.d(),I&&I.d(),te(T,b),G&&G.d(b),$=!1,Mt(O)}}}function Oo(t){let n,e;return n=new $n({props:{shape:t[0],transform:t[2],editor:t[17],svgEl:t[4],$$slots:{default:[Co,({grab:r})=>({27:r}),({grab:r})=>[r?134217728:0]]},$$scope:{ctx:t}}}),n.$on("change",t[20]),n.$on("grab",t[21]),n.$on("release",t[22]),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&1&&(o.shape=r[0]),i[0]&4&&(o.transform=r[2]),i[0]&16&&(o.svgEl=r[4]),i[0]&134219754|i[1]&1&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}const Io=250,To=1e3,Lo=12,Ee=4.5,Zn=t=>t.join(","),Gn=t=>t.join(","),Vn=t=>t.join(",");function zo(t,n,e){let r,i,o;const a=Kt();let{shape:s}=n,{computedStyle:l}=n,{transform:c}=n,{viewportScale:f=1}=n,{svgEl:d}=n,p,g=!1,w,h=[];const _=()=>e(7,g=!0),v=()=>e(7,g=!1),k=u=>{if(h.length>0||!i.some(B=>B.visible)){e(6,p=void 0);return}const[A,H]=c.elementToImage(u.offsetX,u.offsetY),P=B=>Math.pow(B[0]-A,2)+Math.pow(B[1]-H,2),Y=r.points.reduce((B,L)=>P(L)<P(B)?L:B),j=i.filter(B=>B.visible).reduce((B,L)=>P(L.point)<P(B.point)?L:B),V=Math.pow(To/f,2);P(Y)<V||P(j.point)<V?e(6,p=i.indexOf(j)):e(6,p=void 0)},x=()=>{document.activeElement!==d&&d.focus()},$=()=>{e(8,h=[]),x()},O=u=>{e(7,g=!0),u.preventDefault(),u.stopPropagation(),w=performance.now()},z=u=>A=>{if(!w||Yt||performance.now()-w>Io)return;const H=h.includes(u);A.metaKey||A.ctrlKey||A.shiftKey?H?e(8,h=h.filter(P=>P!==u)):e(8,h=[...h,u]):H&&h.length>1?e(8,h=[u]):H?e(8,h=[]):e(8,h=[u]),x()},I=(u,A,H)=>{x();let P;const Y=u.geometry;h.length>1?P=Y.points.map(([V,B],L)=>h.includes(L)?[V+H[0],B+H[1]]:[V,B]):A==="SHAPE"?P=Y.points.map(([V,B])=>[V+H[0],B+H[1]]):P=Y.points.map(([V,B],L)=>A===`HANDLE-${L}`?[V+H[0],B+H[1]]:[V,B]);const j=Ft(P);return{...u,geometry:{points:P,bounds:j}}},M=u=>async A=>{A.stopPropagation();const H=[...r.points.slice(0,u+1),i[u].point,...r.points.slice(u+1)],P=Ft(H);a("change",{...s,geometry:{points:H,bounds:P}}),await Pr();const Y=[...document.querySelectorAll(".a9s-handle")][u+1];if(Y!=null&&Y.firstChild){const j=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:A.clientX,clientY:A.clientY,pointerId:A.pointerId,pointerType:A.pointerType,isPrimary:A.isPrimary,buttons:A.buttons});Y.firstChild.dispatchEvent(j)}},T=()=>{if(r.points.length-h.length<3)return;const u=r.points.filter((H,P)=>!h.includes(P)),A=Ft(u);a("change",{...s,geometry:{points:u,bounds:A}}),e(8,h=[])};ee(()=>{if(Yt)return;const u=A=>{(A.key==="Delete"||A.key==="Backspace")&&(A.preventDefault(),T())};return d.addEventListener("pointermove",k),d.addEventListener("keydown",u),()=>{d.removeEventListener("pointermove",k),d.removeEventListener("keydown",u)}});const X=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function G(u){Ct.call(this,t,u)}function b(u){Ct.call(this,t,u)}function C(u){Ct.call(this,t,u)}return t.$$set=u=>{"shape"in u&&e(0,s=u.shape),"computedStyle"in u&&e(1,l=u.computedStyle),"transform"in u&&e(2,c=u.transform),"viewportScale"in u&&e(3,f=u.viewportScale),"svgEl"in u&&e(4,d=u.svgEl)},t.$$.update=()=>{t.$$.dirty[0]&1&&e(5,r=s.geometry),t.$$.dirty[0]&40&&e(10,i=Yt?[]:r.points.map((u,A)=>{const H=A===r.points.length-1?r.points[0]:r.points[A+1],P=(u[0]+H[0])/2,Y=(u[1]+H[1])/2,j=Math.sqrt(Math.pow(H[0]-P,2)+Math.pow(H[1]-Y,2))>Lo/f;return{point:[P,Y],visible:j}})),t.$$.dirty[0]&40&&e(9,o=Xe(r.bounds,Ee/f))},[s,l,c,f,d,r,p,g,h,o,i,_,v,k,$,O,z,I,M,X,G,b,C]}class Bo extends Lt{constructor(n){super(),Tt(this,n,zo,Oo,xt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function Ro(t){let n,e,r,i,o,a,s,l,c,f,d,p,g,w,h,_,v,k,x,$,O,z,I,M,T,X,G,b,C,u,A,H,P,Y,j,V,B,L,et,Q,Z,pt,yt,K,ct,at,ut,wt,St,m,W,F,E,S,R;return at=new de({props:{class:"a9s-corner-handle-topleft",x:t[5].x,y:t[5].y,scale:t[3]}}),at.$on("pointerdown",function(){bt(t[12]("TOP_LEFT"))&&t[12]("TOP_LEFT").apply(this,arguments)}),wt=new de({props:{class:"a9s-corner-handle-topright",x:t[5].x+t[5].w,y:t[5].y,scale:t[3]}}),wt.$on("pointerdown",function(){bt(t[12]("TOP_RIGHT"))&&t[12]("TOP_RIGHT").apply(this,arguments)}),m=new de({props:{class:"a9s-corner-handle-bottomright",x:t[5].x+t[5].w,y:t[5].y+t[5].h,scale:t[3]}}),m.$on("pointerdown",function(){bt(t[12]("BOTTOM_RIGHT"))&&t[12]("BOTTOM_RIGHT").apply(this,arguments)}),F=new de({props:{class:"a9s-corner-handle-bottomleft",x:t[5].x,y:t[5].y+t[5].h,scale:t[3]}}),F.$on("pointerdown",function(){bt(t[12]("BOTTOM_LEFT"))&&t[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){n=tt("defs"),e=tt("mask"),r=tt("rect"),l=tt("rect"),g=zt(),w=tt("rect"),x=zt(),$=tt("rect"),T=zt(),X=tt("rect"),u=zt(),A=tt("rect"),j=zt(),V=tt("rect"),Q=zt(),Z=tt("rect"),ct=zt(),At(at.$$.fragment),ut=zt(),At(wt.$$.fragment),St=zt(),At(m.$$.fragment),W=zt(),At(F.$$.fragment),y(r,"class","rect-mask-bg svelte-1njczvj"),y(r,"x",i=t[6].x),y(r,"y",o=t[6].y),y(r,"width",a=t[6].w),y(r,"height",s=t[6].h),y(l,"class","rect-mask-fg svelte-1njczvj"),y(l,"x",c=t[5].x),y(l,"y",f=t[5].y),y(l,"width",d=t[5].w),y(l,"height",p=t[5].h),y(e,"id",t[8]),y(e,"class","a9s-rectangle-editor-mask svelte-1njczvj"),y(w,"class","a9s-outer"),y(w,"mask",`url(#${t[8]})`),y(w,"x",h=t[5].x),y(w,"y",_=t[5].y),y(w,"width",v=t[5].w),y(w,"height",k=t[5].h),y($,"class","a9s-inner a9s-shape-handle"),y($,"style",t[1]),y($,"x",O=t[5].x),y($,"y",z=t[5].y),y($,"width",I=t[5].w),y($,"height",M=t[5].h),y(X,"class","a9s-edge-handle a9s-edge-handle-top"),y(X,"x",G=t[5].x),y(X,"y",b=t[5].y),y(X,"height",1),y(X,"width",C=t[5].w),y(A,"class","a9s-edge-handle a9s-edge-handle-right"),y(A,"x",H=t[5].x+t[5].w),y(A,"y",P=t[5].y),y(A,"height",Y=t[5].h),y(A,"width",1),y(V,"class","a9s-edge-handle a9s-edge-handle-bottom"),y(V,"x",B=t[5].x),y(V,"y",L=t[5].y+t[5].h),y(V,"height",1),y(V,"width",et=t[5].w),y(Z,"class","a9s-edge-handle a9s-edge-handle-left"),y(Z,"x",pt=t[5].x),y(Z,"y",yt=t[5].y),y(Z,"height",K=t[5].h),y(Z,"width",1)},m(N,D){it(N,n,D),dt(n,e),dt(e,r),dt(e,l),it(N,g,D),it(N,w,D),it(N,x,D),it(N,$,D),it(N,T,D),it(N,X,D),it(N,u,D),it(N,A,D),it(N,j,D),it(N,V,D),it(N,Q,D),it(N,Z,D),it(N,ct,D),Et(at,N,D),it(N,ut,D),Et(wt,N,D),it(N,St,D),Et(m,N,D),it(N,W,D),Et(F,N,D),E=!0,S||(R=[ht(w,"pointerdown",function(){bt(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),ht($,"pointerdown",function(){bt(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),ht(X,"pointerdown",function(){bt(t[12]("TOP"))&&t[12]("TOP").apply(this,arguments)}),ht(A,"pointerdown",function(){bt(t[12]("RIGHT"))&&t[12]("RIGHT").apply(this,arguments)}),ht(V,"pointerdown",function(){bt(t[12]("BOTTOM"))&&t[12]("BOTTOM").apply(this,arguments)}),ht(Z,"pointerdown",function(){bt(t[12]("LEFT"))&&t[12]("LEFT").apply(this,arguments)})],S=!0)},p(N,D){t=N,(!E||D&64&&i!==(i=t[6].x))&&y(r,"x",i),(!E||D&64&&o!==(o=t[6].y))&&y(r,"y",o),(!E||D&64&&a!==(a=t[6].w))&&y(r,"width",a),(!E||D&64&&s!==(s=t[6].h))&&y(r,"height",s),(!E||D&32&&c!==(c=t[5].x))&&y(l,"x",c),(!E||D&32&&f!==(f=t[5].y))&&y(l,"y",f),(!E||D&32&&d!==(d=t[5].w))&&y(l,"width",d),(!E||D&32&&p!==(p=t[5].h))&&y(l,"height",p),(!E||D&32&&h!==(h=t[5].x))&&y(w,"x",h),(!E||D&32&&_!==(_=t[5].y))&&y(w,"y",_),(!E||D&32&&v!==(v=t[5].w))&&y(w,"width",v),(!E||D&32&&k!==(k=t[5].h))&&y(w,"height",k),(!E||D&2)&&y($,"style",t[1]),(!E||D&32&&O!==(O=t[5].x))&&y($,"x",O),(!E||D&32&&z!==(z=t[5].y))&&y($,"y",z),(!E||D&32&&I!==(I=t[5].w))&&y($,"width",I),(!E||D&32&&M!==(M=t[5].h))&&y($,"height",M),(!E||D&32&&G!==(G=t[5].x))&&y(X,"x",G),(!E||D&32&&b!==(b=t[5].y))&&y(X,"y",b),(!E||D&32&&C!==(C=t[5].w))&&y(X,"width",C),(!E||D&32&&H!==(H=t[5].x+t[5].w))&&y(A,"x",H),(!E||D&32&&P!==(P=t[5].y))&&y(A,"y",P),(!E||D&32&&Y!==(Y=t[5].h))&&y(A,"height",Y),(!E||D&32&&B!==(B=t[5].x))&&y(V,"x",B),(!E||D&32&&L!==(L=t[5].y+t[5].h))&&y(V,"y",L),(!E||D&32&&et!==(et=t[5].w))&&y(V,"width",et),(!E||D&32&&pt!==(pt=t[5].x))&&y(Z,"x",pt),(!E||D&32&&yt!==(yt=t[5].y))&&y(Z,"y",yt),(!E||D&32&&K!==(K=t[5].h))&&y(Z,"height",K);const U={};D&32&&(U.x=t[5].x),D&32&&(U.y=t[5].y),D&8&&(U.scale=t[3]),at.$set(U);const q={};D&32&&(q.x=t[5].x+t[5].w),D&32&&(q.y=t[5].y),D&8&&(q.scale=t[3]),wt.$set(q);const nt={};D&32&&(nt.x=t[5].x+t[5].w),D&32&&(nt.y=t[5].y+t[5].h),D&8&&(nt.scale=t[3]),m.$set(nt);const J={};D&32&&(J.x=t[5].x),D&32&&(J.y=t[5].y+t[5].h),D&8&&(J.scale=t[3]),F.$set(J)},i(N){E||(ot(at.$$.fragment,N),ot(wt.$$.fragment,N),ot(m.$$.fragment,N),ot(F.$$.fragment,N),E=!0)},o(N){lt(at.$$.fragment,N),lt(wt.$$.fragment,N),lt(m.$$.fragment,N),lt(F.$$.fragment,N),E=!1},d(N){N&&(rt(n),rt(g),rt(w),rt(x),rt($),rt(T),rt(X),rt(u),rt(A),rt(j),rt(V),rt(Q),rt(Z),rt(ct),rt(ut),rt(St),rt(W)),$t(at,N),$t(wt,N),$t(m,N),$t(F,N),S=!1,Mt(R)}}}function Po(t){let n,e;return n=new $n({props:{shape:t[0],transform:t[2],editor:t[7],svgEl:t[4],$$slots:{default:[Ro,({grab:r})=>({12:r}),({grab:r})=>r?4096:0]},$$scope:{ctx:t}}}),n.$on("grab",t[9]),n.$on("change",t[10]),n.$on("release",t[11]),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,[i]){const o={};i&1&&(o.shape=r[0]),i&4&&(o.transform=r[2]),i&16&&(o.svgEl=r[4]),i&12394&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Mo(t,n,e){let r,i,{shape:o}=n,{computedStyle:a}=n,{transform:s}=n,{viewportScale:l=1}=n,{svgEl:c}=n;const f=(h,_,v)=>{const k=h.geometry.bounds;let[x,$]=[k.minX,k.minY],[O,z]=[k.maxX,k.maxY];const[I,M]=v;if(_==="SHAPE")x+=I,O+=I,$+=M,z+=M;else{switch(_){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{$+=M;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{z+=M;break}}switch(_){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{x+=I;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{O+=I;break}}}const T=Math.min(x,O),X=Math.min($,z),G=Math.abs(O-x),b=Math.abs(z-$);return{...h,geometry:{x:T,y:X,w:G,h:b,bounds:{minX:T,minY:X,maxX:T+G,maxY:X+b}}}},d=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function p(h){Ct.call(this,t,h)}function g(h){Ct.call(this,t,h)}function w(h){Ct.call(this,t,h)}return t.$$set=h=>{"shape"in h&&e(0,o=h.shape),"computedStyle"in h&&e(1,a=h.computedStyle),"transform"in h&&e(2,s=h.transform),"viewportScale"in h&&e(3,l=h.viewportScale),"svgEl"in h&&e(4,c=h.svgEl)},t.$$.update=()=>{t.$$.dirty&1&&e(5,r=o.geometry),t.$$.dirty&40&&e(6,i=Xe(r.bounds,2/l))},[o,a,s,l,c,r,i,f,d,p,g,w]}class Do extends Lt{constructor(n){super(),Tt(this,n,Mo,Po,xt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var qn=Object.prototype.hasOwnProperty;function vn(t,n){var e,r;if(t===n)return!0;if(t&&n&&(e=t.constructor)===n.constructor){if(e===Date)return t.getTime()===n.getTime();if(e===RegExp)return t.toString()===n.toString();if(e===Array){if((r=t.length)===n.length)for(;r--&&vn(t[r],n[r]););return r===-1}if(!e||typeof t=="object"){r=0;for(e in t)if(qn.call(t,e)&&++r&&!qn.call(n,e)||!(e in n)||!vn(t[e],n[e]))return!1;return Object.keys(n).length===r}}return t!==t&&n!==n}const Uo=12,No=(t,n)=>t.polygons.reduce((e,r,i)=>{const o=r.rings.reduce((a,s,l)=>{const c=s.points.map((f,d)=>{const p=d===s.points.length-1?s.points[0]:s.points[d+1],g=(f[0]+p[0])/2,w=(f[1]+p[1])/2,h=Math.sqrt(Math.pow(p[0]-g,2)+Math.pow(p[1]-w,2))>Uo/n;return{point:[g,w],visible:h,elementIdx:i,ringIdx:l,pointIdx:d}});return[...a,...c]},[]);return[...e,...o]},[]);function on(t){const n=t.slice(),e=n[10][n[6]];return n[29]=e.point,n}function Kn(t,n,e){const r=t.slice();return r[30]=n[e],r[32]=e,r}function Jn(t,n,e){const r=t.slice();return r[33]=n[e],r[35]=e,r}function Qn(t,n,e){const r=t.slice();return r[29]=n[e],r[37]=e,r}function sn(t){const n=t.slice(),e=n[10][n[6]];return n[29]=e.point,n}function an(t){const n=t.slice(),e=n[10][n[6]];return n[29]=e.point,n}function tr(t){let n,e,r,i;return{c(){n=tt("circle"),y(n,"cx",e=t[29][0]),y(n,"cy",r=t[29][1]),y(n,"r",i=$e/t[3]),y(n,"class","svelte-1vxo6dc")},m(o,a){it(o,n,a)},p(o,a){a[0]&1088&&e!==(e=o[29][0])&&y(n,"cx",e),a[0]&1088&&r!==(r=o[29][1])&&y(n,"cy",r),a[0]&8&&i!==(i=$e/o[3])&&y(n,"r",i)},d(o){o&&rt(n)}}}function er(t){let n,e,r,i,o,a,s,l,c,f;return{c(){n=tt("mask"),e=tt("rect"),s=tt("circle"),y(e,"x",r=t[9].x),y(e,"y",i=t[9].y),y(e,"width",o=t[9].w),y(e,"height",a=t[9].h),y(e,"class","svelte-1vxo6dc"),y(s,"cx",l=t[29][0]),y(s,"cy",c=t[29][1]),y(s,"r",f=$e/t[3]),y(s,"class","svelte-1vxo6dc"),y(n,"id",`${t[18]}-${t[32]}-inner`),y(n,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(d,p){it(d,n,p),dt(n,e),dt(n,s)},p(d,p){p[0]&512&&r!==(r=d[9].x)&&y(e,"x",r),p[0]&512&&i!==(i=d[9].y)&&y(e,"y",i),p[0]&512&&o!==(o=d[9].w)&&y(e,"width",o),p[0]&512&&a!==(a=d[9].h)&&y(e,"height",a),p[0]&1088&&l!==(l=d[29][0])&&y(s,"cx",l),p[0]&1088&&c!==(c=d[29][1])&&y(s,"cy",c),p[0]&8&&f!==(f=$e/d[3])&&y(s,"r",f)},d(d){d&&rt(n)}}}function nr(t){let n,e;function r(...i){return t[19](t[32],t[35],t[37],...i)}return n=new de({props:{class:"a9s-corner-handle",x:t[29][0],y:t[29][1],scale:t[3],selected:t[8].some(r)}}),n.$on("pointerenter",t[11]),n.$on("pointerleave",t[12]),n.$on("pointerdown",t[14]),n.$on("pointerdown",function(){bt(t[28](`HANDLE-${t[32]}-${t[35]}-${t[37]}`))&&t[28](`HANDLE-${t[32]}-${t[35]}-${t[37]}`).apply(this,arguments)}),n.$on("pointerup",t[15](t[32],t[35],t[37])),{c(){At(n.$$.fragment)},m(i,o){Et(n,i,o),e=!0},p(i,o){t=i;const a={};o[0]&32&&(a.x=t[29][0]),o[0]&32&&(a.y=t[29][1]),o[0]&8&&(a.scale=t[3]),o[0]&256&&(a.selected=t[8].some(r)),n.$set(a)},i(i){e||(ot(n.$$.fragment,i),e=!0)},o(i){lt(n.$$.fragment,i),e=!1},d(i){$t(n,i)}}}function rr(t){let n,e,r=Pt(t[33].points),i=[];for(let a=0;a<r.length;a+=1)i[a]=nr(Qn(t,r,a));const o=a=>lt(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();n=Dt()},m(a,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(a,s);it(a,n,s),e=!0},p(a,s){if(s[0]&268491048){r=Pt(a[33].points);let l;for(l=0;l<r.length;l+=1){const c=Qn(a,r,l);i[l]?(i[l].p(c,s),ot(i[l],1)):(i[l]=nr(c),i[l].c(),ot(i[l],1),i[l].m(n.parentNode,n))}for(Bt(),l=r.length;l<i.length;l+=1)o(l);Rt()}},i(a){if(!e){for(let s=0;s<r.length;s+=1)ot(i[s]);e=!0}},o(a){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)lt(i[s]);e=!1},d(a){a&&rt(n),te(i,a)}}}function ir(t){let n,e,r,i,o,a,s,l,c,f,d,p,g,w,h,_,v,k=t[6]!==void 0&&!t[7]&&tr(an(t)),x=t[6]!==void 0&&!t[7]&&er(sn(t)),$=Pt(t[30].rings),O=[];for(let I=0;I<$.length;I+=1)O[I]=rr(Jn(t,$,I));const z=I=>lt(O[I],1,1,()=>{O[I]=null});return{c(){n=tt("g"),e=tt("defs"),r=tt("mask"),i=tt("rect"),c=tt("path"),k&&k.c(),x&&x.c(),d=tt("path"),g=tt("path");for(let I=0;I<O.length;I+=1)O[I].c();y(i,"x",o=t[9].x),y(i,"y",a=t[9].y),y(i,"width",s=t[9].w),y(i,"height",l=t[9].h),y(i,"class","svelte-1vxo6dc"),y(c,"d",f=Gt(t[30])),y(c,"class","svelte-1vxo6dc"),y(r,"id",`${t[18]}-${t[32]}-outer`),y(r,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),y(d,"class","a9s-outer"),y(d,"mask",`url(#${t[18]}-${t[32]}-outer)`),y(d,"fill-rule","evenodd"),y(d,"d",p=Gt(t[30])),y(g,"class","a9s-inner"),y(g,"mask",`url(#${t[18]}-${t[32]}-inner)`),y(g,"style",t[1]),y(g,"fill-rule","evenodd"),y(g,"d",w=Gt(t[30]))},m(I,M){it(I,n,M),dt(n,e),dt(e,r),dt(r,i),dt(r,c),k&&k.m(r,null),x&&x.m(e,null),dt(n,d),dt(n,g);for(let T=0;T<O.length;T+=1)O[T]&&O[T].m(n,null);h=!0,_||(v=[ht(d,"pointerup",t[13]),ht(d,"pointerdown",function(){bt(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)}),ht(g,"pointerup",t[13]),ht(g,"pointerdown",function(){bt(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)})],_=!0)},p(I,M){if(t=I,(!h||M[0]&512&&o!==(o=t[9].x))&&y(i,"x",o),(!h||M[0]&512&&a!==(a=t[9].y))&&y(i,"y",a),(!h||M[0]&512&&s!==(s=t[9].w))&&y(i,"width",s),(!h||M[0]&512&&l!==(l=t[9].h))&&y(i,"height",l),(!h||M[0]&32&&f!==(f=Gt(t[30])))&&y(c,"d",f),t[6]!==void 0&&!t[7]?k?k.p(an(t),M):(k=tr(an(t)),k.c(),k.m(r,null)):k&&(k.d(1),k=null),t[6]!==void 0&&!t[7]?x?x.p(sn(t),M):(x=er(sn(t)),x.c(),x.m(e,null)):x&&(x.d(1),x=null),(!h||M[0]&32&&p!==(p=Gt(t[30])))&&y(d,"d",p),(!h||M[0]&2)&&y(g,"style",t[1]),(!h||M[0]&32&&w!==(w=Gt(t[30])))&&y(g,"d",w),M[0]&268491048){$=Pt(t[30].rings);let T;for(T=0;T<$.length;T+=1){const X=Jn(t,$,T);O[T]?(O[T].p(X,M),ot(O[T],1)):(O[T]=rr(X),O[T].c(),ot(O[T],1),O[T].m(n,null))}for(Bt(),T=$.length;T<O.length;T+=1)z(T);Rt()}},i(I){if(!h){for(let M=0;M<$.length;M+=1)ot(O[M]);h=!0}},o(I){O=O.filter(Boolean);for(let M=0;M<O.length;M+=1)lt(O[M]);h=!1},d(I){I&&rt(n),k&&k.d(),x&&x.d(),te(O,I),_=!1,Mt(v)}}}function or(t){let n,e;return n=new Fr({props:{x:t[29][0],y:t[29][1],scale:t[3]}}),n.$on("pointerdown",function(){bt(t[17](t[6]))&&t[17](t[6]).apply(this,arguments)}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){t=r;const o={};i[0]&1088&&(o.x=t[29][0]),i[0]&1088&&(o.y=t[29][1]),i[0]&8&&(o.scale=t[3]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Fo(t){let n,e,r,i=Pt(t[5].polygons),o=[];for(let l=0;l<i.length;l+=1)o[l]=ir(Kn(t,i,l));const a=l=>lt(o[l],1,1,()=>{o[l]=null});let s=t[6]!==void 0&&!t[7]&&or(on(t));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();n=zt(),s&&s.c(),e=Dt()},m(l,c){for(let f=0;f<o.length;f+=1)o[f]&&o[f].m(l,c);it(l,n,c),s&&s.m(l,c),it(l,e,c),r=!0},p(l,c){if(c[0]&268763114){i=Pt(l[5].polygons);let f;for(f=0;f<i.length;f+=1){const d=Kn(l,i,f);o[f]?(o[f].p(d,c),ot(o[f],1)):(o[f]=ir(d),o[f].c(),ot(o[f],1),o[f].m(n.parentNode,n))}for(Bt(),f=i.length;f<o.length;f+=1)a(f);Rt()}l[6]!==void 0&&!l[7]?s?(s.p(on(l),c),c[0]&192&&ot(s,1)):(s=or(on(l)),s.c(),ot(s,1),s.m(e.parentNode,e)):s&&(Bt(),lt(s,1,1,()=>{s=null}),Rt())},i(l){if(!r){for(let c=0;c<i.length;c+=1)ot(o[c]);ot(s),r=!0}},o(l){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)lt(o[c]);lt(s),r=!1},d(l){l&&(rt(n),rt(e)),te(o,l),s&&s.d(l)}}}function jo(t){let n,e;return n=new $n({props:{shape:t[0],transform:t[2],editor:t[16],svgEl:t[4],$$slots:{default:[Fo,({grab:r})=>({28:r}),({grab:r})=>[r?268435456:0]]},$$scope:{ctx:t}}}),n.$on("change",t[20]),n.$on("grab",t[21]),n.$on("release",t[22]),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&1&&(o.shape=r[0]),i[0]&4&&(o.transform=r[2]),i[0]&16&&(o.svgEl=r[4]),i[0]&268437482|i[1]&128&&(o.$$scope={dirty:i,ctx:r}),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}const Xo=250,Ho=1e3,$e=4.5;function Wo(t,n,e){let r,i,o;const a=Kt();let{shape:s}=n,{computedStyle:l}=n,{transform:c}=n,{viewportScale:f=1}=n,{svgEl:d}=n,p,g=!1,w,h=[];const _=()=>e(7,g=!0),v=()=>e(7,g=!1),k=A=>{if(h.length>0||!i.some(L=>L.visible)){e(6,p=void 0);return}const[H,P]=c.elementToImage(A.offsetX,A.offsetY),Y=L=>Math.pow(L[0]-H,2)+Math.pow(L[1]-P,2),j=ki(r).reduce((L,et)=>Y(et)<Y(L)?et:L),V=i.filter(L=>L.visible).reduce((L,et)=>Y(et.point)<Y(L.point)?et:L),B=Math.pow(Ho/f,2);Y(j)<B||Y(V.point)<B?e(6,p=i.indexOf(V)):e(6,p=void 0)},x=()=>{document.activeElement!==d&&d.focus()},$=()=>{e(8,h=[]),x()},O=A=>{e(7,g=!0),A.preventDefault(),A.stopPropagation(),w=performance.now()},z=(A,H,P)=>Y=>{if(!w||Yt||performance.now()-w>Xo)return;const j=B=>B.polygon===A&&B.ring===H&&B.point===P,V=h.some(j);Y.metaKey||Y.ctrlKey||Y.shiftKey?V?e(8,h=h.filter(B=>!j(B))):e(8,h=[...h,{polygon:A,ring:H,point:P}]):V&&h.length>1?e(8,h=[{polygon:A,ring:H,point:P}]):V?e(8,h=[]):e(8,h=[{polygon:A,ring:H,point:P}]),x()},I=(A,H,P)=>{x();const Y=A.geometry.polygons;let j;if(H==="SHAPE")j=Y.map(V=>{const B=V.rings.map((et,Q)=>({points:et.points.map((Z,pt)=>[Z[0]+P[0],Z[1]+P[1]])})),L=Ft(B[0].points);return{rings:B,bounds:L}});else{const[V,B,L,et]=H.split("-").map(Q=>parseInt(Q));j=Y.map((Q,Z)=>{if(Z===B){const pt=Q.rings.map((K,ct)=>ct===L?{points:K.points.map((at,ut)=>ut===et?[at[0]+P[0],at[1]+P[1]]:at)}:K),yt=Ft(pt[0].points);return{rings:pt,bounds:yt}}else return Q})}return{...A,geometry:{polygons:j,bounds:qe(j)}}},M=A=>async H=>{H.stopPropagation();const P=i[A],Y=r.polygons.map((V,B)=>{if(B===P.elementIdx){const L=V.rings.map((Q,Z)=>Z===P.ringIdx?{points:[...Q.points.slice(0,P.pointIdx+1),P.point,...Q.points.slice(P.pointIdx+1)]}:Q),et=Ft(L[0].points);return{rings:L,bounds:et}}else return V});a("change",{...s,geometry:{polygons:Y,bounds:qe(Y)}}),await Pr();const j=[...document.querySelectorAll(".a9s-handle")][A+1];if(j!=null&&j.firstChild){const V=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:H.clientX,clientY:H.clientY,pointerId:H.pointerId,pointerType:H.pointerType,isPrimary:H.isPrimary,buttons:H.buttons});j.firstChild.dispatchEvent(V)}},T=()=>{const A=r.polygons.map((H,P)=>{if(h.some(Y=>Y.polygon===P)){const Y=H.rings.map((V,B)=>{const L=h.filter(et=>et.polygon===P&&et.ring===B);return L.length&&V.points.length-L.length>=3?{points:V.points.filter((et,Q)=>!L.some(Z=>Z.point===Q))}:V}),j=Ft(Y[0].points);return{rings:Y,bounds:j}}else return H});!vn(r.polygons,A)&&(a("change",{...s,geometry:{polygons:A,bounds:qe(A)}}),e(8,h=[]))};ee(()=>{if(Yt)return;const A=H=>{(H.key==="Delete"||H.key==="Backspace")&&(H.preventDefault(),T())};return d.addEventListener("pointermove",k),d.addEventListener("keydown",A),()=>{d.removeEventListener("pointermove",k),d.removeEventListener("keydown",A)}});const X=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,G=(A,H,P,{polygon:Y,ring:j,point:V})=>Y===A&&j===H&&V===P;function b(A){Ct.call(this,t,A)}function C(A){Ct.call(this,t,A)}function u(A){Ct.call(this,t,A)}return t.$$set=A=>{"shape"in A&&e(0,s=A.shape),"computedStyle"in A&&e(1,l=A.computedStyle),"transform"in A&&e(2,c=A.transform),"viewportScale"in A&&e(3,f=A.viewportScale),"svgEl"in A&&e(4,d=A.svgEl)},t.$$.update=()=>{t.$$.dirty[0]&1&&e(5,r=s.geometry),t.$$.dirty[0]&40&&e(10,i=Yt?[]:No(r,f)),t.$$.dirty[0]&40&&e(9,o=Xe(r.bounds,$e/f))},[s,l,c,f,d,r,p,g,h,o,i,_,v,$,O,z,I,M,X,G,b,C,u]}class Yo extends Lt{constructor(n){super(),Tt(this,n,Wo,jo,xt,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}const jr=new Map([[kt.RECTANGLE,Do],[kt.POLYGON,Bo],[kt.MULTIPOLYGON,Yo]]),Zo=t=>jr.get(t.type),Go=(t,n)=>jr.set(t,n);function Vo(t,n,e){let r;const i=Kt();let{annotation:o}=n,{editor:a}=n,{style:s}=n,{target:l}=n,{transform:c}=n,{viewportScale:f}=n,d;return ee(()=>(e(6,d=new a({target:l,props:{shape:o.target.selector,computedStyle:r,transform:c,viewportScale:f,svgEl:l.closest("svg")}})),d.$on("change",p=>{d.$$set({shape:p.detail}),i("change",p.detail)}),d.$on("grab",p=>i("grab",p.detail)),d.$on("release",p=>i("release",p.detail)),()=>{d.$destroy()})),t.$$set=p=>{"annotation"in p&&e(0,o=p.annotation),"editor"in p&&e(1,a=p.editor),"style"in p&&e(2,s=p.style),"target"in p&&e(3,l=p.target),"transform"in p&&e(4,c=p.transform),"viewportScale"in p&&e(5,f=p.viewportScale)},t.$$.update=()=>{t.$$.dirty&5&&e(7,r=ne(o,s)),t.$$.dirty&65&&o&&d?.$set({shape:o.target.selector}),t.$$.dirty&80&&d&&d.$set({transform:c}),t.$$.dirty&96&&d&&d.$set({viewportScale:f}),t.$$.dirty&192&&d&&r&&d.$set({computedStyle:r})},[o,a,s,l,c,f,d,r]}class qo extends Lt{constructor(n){super(),Tt(this,n,Vo,null,xt,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}}function Ko(t,n,e){const r=Kt();let{drawingMode:i}=n,{target:o}=n,{tool:a}=n,{transform:s}=n,{viewportScale:l}=n,c;return ee(()=>{const f=o.closest("svg"),d=[],p=(g,w,h)=>{f?.addEventListener(g,w,h),d.push(()=>f?.removeEventListener(g,w,h))};return e(5,c=new a({target:o,props:{addEventListener:p,drawingMode:i,transform:s,viewportScale:l}})),c.$on("create",g=>r("create",g.detail)),()=>{d.forEach(g=>g()),c.$destroy()}}),t.$$set=f=>{"drawingMode"in f&&e(0,i=f.drawingMode),"target"in f&&e(1,o=f.target),"tool"in f&&e(2,a=f.tool),"transform"in f&&e(3,s=f.transform),"viewportScale"in f&&e(4,l=f.viewportScale)},t.$$.update=()=>{t.$$.dirty&40&&c&&c.$set({transform:s}),t.$$.dirty&48&&c&&c.$set({viewportScale:l})},[i,o,a,s,l,c]}class Jo extends Lt{constructor(n){super(),Tt(this,n,Ko,null,xt,{drawingMode:0,target:1,tool:2,transform:3,viewportScale:4})}}function sr(t){let n,e,r,i,o,a,s,l,c,f;return{c(){n=tt("defs"),e=tt("mask"),r=tt("rect"),l=tt("rect"),c=tt("rect"),f=tt("rect"),y(r,"class","rect-mask-bg svelte-1a76qe7"),y(r,"x",i=t[1]-t[5]),y(r,"y",o=t[2]-t[5]),y(r,"width",a=t[3]+2*t[5]),y(r,"height",s=t[4]+2*t[5]),y(l,"class","rect-mask-fg svelte-1a76qe7"),y(l,"x",t[1]),y(l,"y",t[2]),y(l,"width",t[3]),y(l,"height",t[4]),y(e,"id",t[6]),y(e,"class","a9s-rubberband-rectangle-mask svelte-1a76qe7"),y(c,"class","a9s-outer"),y(c,"mask",`url(#${t[6]})`),y(c,"x",t[1]),y(c,"y",t[2]),y(c,"width",t[3]),y(c,"height",t[4]),y(f,"class","a9s-inner"),y(f,"x",t[1]),y(f,"y",t[2]),y(f,"width",t[3]),y(f,"height",t[4])},m(d,p){it(d,n,p),dt(n,e),dt(e,r),dt(e,l),it(d,c,p),it(d,f,p)},p(d,p){p&34&&i!==(i=d[1]-d[5])&&y(r,"x",i),p&36&&o!==(o=d[2]-d[5])&&y(r,"y",o),p&40&&a!==(a=d[3]+2*d[5])&&y(r,"width",a),p&48&&s!==(s=d[4]+2*d[5])&&y(r,"height",s),p&2&&y(l,"x",d[1]),p&4&&y(l,"y",d[2]),p&8&&y(l,"width",d[3]),p&16&&y(l,"height",d[4]),p&2&&y(c,"x",d[1]),p&4&&y(c,"y",d[2]),p&8&&y(c,"width",d[3]),p&16&&y(c,"height",d[4]),p&2&&y(f,"x",d[1]),p&4&&y(f,"y",d[2]),p&8&&y(f,"width",d[3]),p&16&&y(f,"height",d[4])},d(d){d&&(rt(n),rt(c),rt(f))}}}function Qo(t){let n,e=t[0]&&sr(t);return{c(){n=tt("g"),e&&e.c(),y(n,"class","a9s-annotation a9s-rubberband")},m(r,i){it(r,n,i),e&&e.m(n,null)},p(r,[i]){r[0]?e?e.p(r,i):(e=sr(r),e.c(),e.m(n,null)):e&&(e.d(1),e=null)},i:mt,o:mt,d(r){r&&rt(n),e&&e.d()}}}function ts(t,n,e){let r;const i=Kt();let{addEventListener:o}=n,{drawingMode:a}=n,{transform:s}=n,{viewportScale:l=1}=n,c,f,d,p,g,w,h;const _=O=>{const z=O;c=performance.now(),a==="drag"&&(e(0,f=s.elementToImage(z.offsetX,z.offsetY)),d=f,e(1,p=f[0]),e(2,g=f[1]),e(3,w=1),e(4,h=1))},v=O=>{const z=O;f&&(d=s.elementToImage(z.offsetX,z.offsetY),e(1,p=Math.min(d[0],f[0])),e(2,g=Math.min(d[1],f[1])),e(3,w=Math.abs(d[0]-f[0])),e(4,h=Math.abs(d[1]-f[1])))},k=O=>{const z=O,I=performance.now()-c;if(a==="click"){if(I>300)return;f?x():(e(0,f=s.elementToImage(z.offsetX,z.offsetY)),d=f,e(1,p=f[0]),e(2,g=f[1]),e(3,w=1),e(4,h=1))}else f&&(I>300||w*h>100?(z.stopPropagation(),x()):(e(0,f=void 0),d=void 0))},x=()=>{if(w*h>15){const O={type:kt.RECTANGLE,geometry:{bounds:{minX:p,minY:g,maxX:p+w,maxY:g+h},x:p,y:g,w,h}};i("create",O)}e(0,f=void 0),d=void 0};ee(()=>{o("pointerdown",_),o("pointermove",v),o("pointerup",k,!0)});const $=`rect-mask-${Math.random().toString(36).substring(2,12)}`;return t.$$set=O=>{"addEventListener"in O&&e(7,o=O.addEventListener),"drawingMode"in O&&e(8,a=O.drawingMode),"transform"in O&&e(9,s=O.transform),"viewportScale"in O&&e(10,l=O.viewportScale)},t.$$.update=()=>{t.$$.dirty&1024&&e(5,r=2/l)},[f,p,g,w,h,r,$,o,a,s,l]}class es extends Lt{constructor(n){super(),Tt(this,n,ts,Qo,xt,{addEventListener:7,drawingMode:8,transform:9,viewportScale:10})}}function ln(t){const n=t.slice(),e=n[2].map(r=>r.join(",")).join(" ");return n[19]=e,n}function ar(t){let n,e,r,i,o,a,s,l,c,f,d,p,g,w,h=t[1]&&lr(t);return{c(){n=tt("defs"),e=tt("mask"),r=tt("rect"),l=tt("polygon"),f=tt("polygon"),p=tt("polygon"),h&&h.c(),w=Dt(),y(r,"x",i=t[3].x),y(r,"y",o=t[3].y),y(r,"width",a=t[3].w),y(r,"height",s=t[3].h),y(r,"class","svelte-18wrg3t"),y(l,"points",c=t[19]),y(l,"class","svelte-18wrg3t"),y(e,"id",t[5]),y(e,"class","a9s-rubberband-polygon-mask svelte-18wrg3t"),y(f,"class","a9s-outer"),y(f,"mask",`url(#${t[5]})`),y(f,"points",d=t[19]),y(p,"class","a9s-inner"),y(p,"points",g=t[19])},m(_,v){it(_,n,v),dt(n,e),dt(e,r),dt(e,l),it(_,f,v),it(_,p,v),h&&h.m(_,v),it(_,w,v)},p(_,v){v&8&&i!==(i=_[3].x)&&y(r,"x",i),v&8&&o!==(o=_[3].y)&&y(r,"y",o),v&8&&a!==(a=_[3].w)&&y(r,"width",a),v&8&&s!==(s=_[3].h)&&y(r,"height",s),v&4&&c!==(c=_[19])&&y(l,"points",c),v&4&&d!==(d=_[19])&&y(f,"points",d),v&4&&g!==(g=_[19])&&y(p,"points",g),_[1]?h?h.p(_,v):(h=lr(_),h.c(),h.m(w.parentNode,w)):h&&(h.d(1),h=null)},d(_){_&&(rt(n),rt(f),rt(p),rt(w)),h&&h.d(_)}}}function lr(t){let n,e,r;return{c(){n=tt("circle"),y(n,"class","a9s-handle svelte-18wrg3t"),y(n,"cx",e=t[0][0][0]),y(n,"cy",r=t[0][0][1]),y(n,"r",t[4])},m(i,o){it(i,n,o)},p(i,o){o&1&&e!==(e=i[0][0][0])&&y(n,"cx",e),o&1&&r!==(r=i[0][0][1])&&y(n,"cy",r),o&16&&y(n,"r",i[4])},d(i){i&&rt(n)}}}function ns(t){let n,e=t[3]&&ar(ln(t));return{c(){n=tt("g"),e&&e.c(),y(n,"class","a9s-annotation a9s-rubberband")},m(r,i){it(r,n,i),e&&e.m(n,null)},p(r,[i]){r[3]?e?e.p(ln(r),i):(e=ar(ln(r)),e.c(),e.m(n,null)):e&&(e.d(1),e=null)},i:mt,o:mt,d(r){r&&rt(n),e&&e.d()}}}const rs=20,is=1500;function os(t,n,e){let r,i,o;const a=Kt();let{addEventListener:s}=n,{drawingMode:l}=n,{transform:c}=n,{viewportScale:f=1}=n,d,p=[],g,w,h=!1;const _=z=>{const I=z,{timeStamp:M,offsetX:T,offsetY:X}=I;if(d={timeStamp:M,offsetX:T,offsetY:X},l==="drag"&&p.length===0){const G=c.elementToImage(I.offsetX,I.offsetY);p.push(G),e(10,g=G)}},v=z=>{const I=z;if(w&&clearTimeout(w),p.length>0){if(e(10,g=c.elementToImage(I.offsetX,I.offsetY)),p.length>2){const M=Pe(g,p[0])*f;e(1,h=M<rs)}I.pointerType==="touch"&&(w=setTimeout(()=>{x()},is))}},k=z=>{const I=z;if(w&&clearTimeout(w),l==="click"){const M=I.timeStamp-d.timeStamp,T=Pe([d.offsetX,d.offsetY],[I.offsetX,I.offsetY]);if(M>300||T>15)return;if(h)$();else if(p.length===0){const X=c.elementToImage(I.offsetX,I.offsetY);p.push(X),e(10,g=X)}else g&&p.push(g)}else{if(!g)return;if(p.length===1&&Pe(p[0],g)<=4){e(0,p=[]),e(10,g=void 0);return}I.stopImmediatePropagation(),h?$():p.push(g)}},x=()=>{if(!g)return;const z=p.slice(0,-1);if(z.length<3)return;const I={type:kt.POLYGON,geometry:{bounds:Ft(p),points:z}};yn(I)>4&&(e(0,p=[]),e(10,g=void 0),a("create",I))},$=()=>{const z={type:kt.POLYGON,geometry:{bounds:Ft(p),points:[...p]}};e(0,p=[]),e(10,g=void 0),a("create",z)};ee(()=>{s("pointerdown",_,!0),s("pointermove",v),s("pointerup",k,!0),s("dblclick",x,!0)});const O=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;return t.$$set=z=>{"addEventListener"in z&&e(6,s=z.addEventListener),"drawingMode"in z&&e(7,l=z.drawingMode),"transform"in z&&e(8,c=z.transform),"viewportScale"in z&&e(9,f=z.viewportScale)},t.$$.update=()=>{t.$$.dirty&512&&e(4,r=4/f),t.$$.dirty&1027&&e(2,i=g?h?p:[...p,g]:[]),t.$$.dirty&516&&e(3,o=i.length>0?Xe(Ft(i),2/f):void 0)},[p,h,i,o,r,O,s,l,c,f,g]}class ss extends Lt{constructor(n){super(),Tt(this,n,os,ns,xt,{addEventListener:6,drawingMode:7,transform:8,viewportScale:9})}}const Sn=new Map([["rectangle",{tool:es}],["polygon",{tool:ss}]]),Xr=()=>[...Sn.keys()],Hr=t=>Sn.get(t),as=(t,n,e={})=>Sn.set(t,{tool:n,opts:e});function ls(t){let n,e,r,i,o;return{c(){n=tt("g"),e=tt("ellipse"),i=tt("ellipse"),y(e,"class","a9s-outer"),y(e,"style",r=t[1]?"display:none;":void 0),y(e,"cx",t[2]),y(e,"cy",t[3]),y(e,"rx",t[4]),y(e,"ry",t[5]),y(i,"class","a9s-inner"),y(i,"style",t[1]),y(i,"cx",t[2]),y(i,"cy",t[3]),y(i,"rx",t[4]),y(i,"ry",t[5]),y(n,"class","a9s-annotation"),y(n,"data-id",o=t[0].id)},m(a,s){it(a,n,s),dt(n,e),dt(n,i)},p(a,[s]){s&2&&r!==(r=a[1]?"display:none;":void 0)&&y(e,"style",r),s&2&&y(i,"style",a[1]),s&1&&o!==(o=a[0].id)&&y(n,"data-id",o)},i:mt,o:mt,d(a){a&&rt(n)}}}function cs(t,n,e){let r,{annotation:i}=n,{geom:o}=n,{style:a}=n;const{cx:s,cy:l,rx:c,ry:f}=o;return t.$$set=d=>{"annotation"in d&&e(0,i=d.annotation),"geom"in d&&e(6,o=d.geom),"style"in d&&e(7,a=d.style)},t.$$.update=()=>{t.$$.dirty&129&&e(1,r=ne(i,a))},[i,r,s,l,c,f,o,a]}class ds extends Lt{constructor(n){super(),Tt(this,n,cs,ls,xt,{annotation:0,geom:6,style:7})}}function us(t){let n,e,r,i,o;return{c(){n=tt("g"),e=tt("line"),i=tt("line"),y(e,"class","a9s-outer"),y(e,"style",r=t[1]?"display:none;":void 0),y(e,"x1",t[2]),y(e,"y1",t[3]),y(e,"x2",t[4]),y(e,"y2",t[5]),y(i,"class","a9s-inner"),y(i,"style",t[1]),y(i,"x1",t[2]),y(i,"y1",t[3]),y(i,"x2",t[4]),y(i,"y2",t[5]),y(n,"class","a9s-annotation"),y(n,"data-id",o=t[0].id)},m(a,s){it(a,n,s),dt(n,e),dt(n,i)},p(a,[s]){s&2&&r!==(r=a[1]?"display:none;":void 0)&&y(e,"style",r),s&2&&y(i,"style",a[1]),s&1&&o!==(o=a[0].id)&&y(n,"data-id",o)},i:mt,o:mt,d(a){a&&rt(n)}}}function fs(t,n,e){let r,{annotation:i}=n,{geom:o}=n,{style:a}=n;const{points:s}=o,[[l,c],[f,d]]=s;return t.$$set=p=>{"annotation"in p&&e(0,i=p.annotation),"geom"in p&&e(6,o=p.geom),"style"in p&&e(7,a=p.style)},t.$$.update=()=>{t.$$.dirty&129&&e(1,r=ne(i,a))},[i,r,l,c,f,d,o,a]}class hs extends Lt{constructor(n){super(),Tt(this,n,fs,us,xt,{annotation:0,geom:6,style:7})}}function cr(t,n,e){const r=t.slice();return r[5]=n[e],r}function dr(t){let n,e,r;return{c(){n=tt("path"),r=tt("path"),y(n,"class","a9s-outer"),y(n,"style",e=t[1]?"display:none;":void 0),y(n,"fill-rule","evenodd"),y(n,"d",Gt(t[5])),y(r,"class","a9s-inner"),y(r,"style",t[1]),y(r,"fill-rule","evenodd"),y(r,"d",Gt(t[5]))},m(i,o){it(i,n,o),it(i,r,o)},p(i,o){o&2&&e!==(e=i[1]?"display:none;":void 0)&&y(n,"style",e),o&2&&y(r,"style",i[1])},d(i){i&&(rt(n),rt(r))}}}function ps(t){let n,e,r=Pt(t[2]),i=[];for(let o=0;o<r.length;o+=1)i[o]=dr(cr(t,r,o));return{c(){n=tt("g");for(let o=0;o<i.length;o+=1)i[o].c();y(n,"class","a9s-annotation"),y(n,"data-id",e=t[0].id)},m(o,a){it(o,n,a);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(n,null)},p(o,[a]){if(a&6){r=Pt(o[2]);let s;for(s=0;s<r.length;s+=1){const l=cr(o,r,s);i[s]?i[s].p(l,a):(i[s]=dr(l),i[s].c(),i[s].m(n,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=r.length}a&1&&e!==(e=o[0].id)&&y(n,"data-id",e)},i:mt,o:mt,d(o){o&&rt(n),te(i,o)}}}function ms(t,n,e){let r,{annotation:i}=n,{geom:o}=n,{style:a}=n;const{polygons:s}=o;return t.$$set=l=>{"annotation"in l&&e(0,i=l.annotation),"geom"in l&&e(3,o=l.geom),"style"in l&&e(4,a=l.style)},t.$$.update=()=>{t.$$.dirty&17&&e(1,r=ne(i,a))},[i,r,s,o,a]}class gs extends Lt{constructor(n){super(),Tt(this,n,ms,ps,xt,{annotation:0,geom:3,style:4})}}function ys(t){let n,e,r,i,o;return{c(){n=tt("g"),e=tt("polygon"),i=tt("polygon"),y(e,"class","a9s-outer"),y(e,"style",r=t[1]?"display:none;":void 0),y(e,"points",t[2].map(vs).join(" ")),y(i,"class","a9s-inner"),y(i,"style",t[1]),y(i,"points",t[2].map(ws).join(" ")),y(n,"class","a9s-annotation"),y(n,"data-id",o=t[0].id)},m(a,s){it(a,n,s),dt(n,e),dt(n,i)},p(a,[s]){s&2&&r!==(r=a[1]?"display:none;":void 0)&&y(e,"style",r),s&2&&y(i,"style",a[1]),s&1&&o!==(o=a[0].id)&&y(n,"data-id",o)},i:mt,o:mt,d(a){a&&rt(n)}}}const vs=t=>t.join(","),ws=t=>t.join(",");function bs(t,n,e){let r,{annotation:i}=n,{geom:o}=n,{style:a}=n;const{points:s}=o;return t.$$set=l=>{"annotation"in l&&e(0,i=l.annotation),"geom"in l&&e(3,o=l.geom),"style"in l&&e(4,a=l.style)},t.$$.update=()=>{t.$$.dirty&17&&e(1,r=ne(i,a))},[i,r,s,o,a]}class _s extends Lt{constructor(n){super(),Tt(this,n,bs,ys,xt,{annotation:0,geom:3,style:4})}}function xs(t){let n,e,r,i,o,a,s;return{c(){n=tt("g"),e=tt("path"),o=tt("path"),y(e,"class",r=ce(`a9s-outer ${t[1]}`)+" svelte-1w0132l"),y(e,"style",i=t[3]?"display:none;":void 0),y(e,"d",t[2]),y(o,"class",a=ce(`a9s-inner ${t[1]}`)+" svelte-1w0132l"),y(o,"style",t[3]),y(o,"d",t[2]),y(n,"class","a9s-annotation"),y(n,"data-id",s=t[0].id)},m(l,c){it(l,n,c),dt(n,e),dt(n,o)},p(l,[c]){c&2&&r!==(r=ce(`a9s-outer ${l[1]}`)+" svelte-1w0132l")&&y(e,"class",r),c&8&&i!==(i=l[3]?"display:none;":void 0)&&y(e,"style",i),c&4&&y(e,"d",l[2]),c&2&&a!==(a=ce(`a9s-inner ${l[1]}`)+" svelte-1w0132l")&&y(o,"class",a),c&8&&y(o,"style",l[3]),c&4&&y(o,"d",l[2]),c&1&&s!==(s=l[0].id)&&y(n,"data-id",s)},i:mt,o:mt,d(l){l&&rt(n)}}}function ks(t,n,e){let r,i,o,{annotation:a}=n,{geom:s}=n,{style:l}=n;return t.$$set=c=>{"annotation"in c&&e(0,a=c.annotation),"geom"in c&&e(4,s=c.geom),"style"in c&&e(5,l=c.style)},t.$$.update=()=>{t.$$.dirty&33&&e(3,r=ne(a,l)),t.$$.dirty&16&&e(2,i=Ai(s)),t.$$.dirty&16&&e(1,o=s.closed?"closed":"open")},[a,o,i,r,s,l]}class Es extends Lt{constructor(n){super(),Tt(this,n,ks,xs,xt,{annotation:0,geom:4,style:5})}}function $s(t){let n,e,r,i,o;return{c(){n=tt("g"),e=tt("rect"),i=tt("rect"),y(e,"class","a9s-outer"),y(e,"style",r=t[5]?"display:none;":void 0),y(e,"x",t[4]),y(e,"y",t[3]),y(e,"width",t[2]),y(e,"height",t[1]),y(i,"class","a9s-inner"),y(i,"style",t[5]),y(i,"x",t[4]),y(i,"y",t[3]),y(i,"width",t[2]),y(i,"height",t[1]),y(n,"class","a9s-annotation"),y(n,"data-id",o=t[0].id)},m(a,s){it(a,n,s),dt(n,e),dt(n,i)},p(a,[s]){s&32&&r!==(r=a[5]?"display:none;":void 0)&&y(e,"style",r),s&16&&y(e,"x",a[4]),s&8&&y(e,"y",a[3]),s&4&&y(e,"width",a[2]),s&2&&y(e,"height",a[1]),s&32&&y(i,"style",a[5]),s&16&&y(i,"x",a[4]),s&8&&y(i,"y",a[3]),s&4&&y(i,"width",a[2]),s&2&&y(i,"height",a[1]),s&1&&o!==(o=a[0].id)&&y(n,"data-id",o)},i:mt,o:mt,d(a){a&&rt(n)}}}function Ss(t,n,e){let r,i,o,a,s,{annotation:l}=n,{geom:c}=n,{style:f}=n;return t.$$set=d=>{"annotation"in d&&e(0,l=d.annotation),"geom"in d&&e(6,c=d.geom),"style"in d&&e(7,f=d.style)},t.$$.update=()=>{t.$$.dirty&129&&e(5,r=ne(l,f)),t.$$.dirty&64&&e(4,{x:i,y:o,w:a,h:s}=c,i,(e(3,o),e(6,c)),(e(2,a),e(6,c)),(e(1,s),e(6,c)))},[l,s,a,o,i,r,c,f]}class As extends Lt{constructor(n){super(),Tt(this,n,Ss,$s,xt,{annotation:0,geom:6,style:7})}}const Cs=t=>({elementToImage:(n,e)=>{const r=t.getBoundingClientRect(),i=t.createSVGPoint();i.x=n+r.x,i.y=e+r.y;const{x:o,y:a}=i.matrixTransform(t.getScreenCTM().inverse());return[o,a]}}),Os=250,Is=(t,n)=>{const e=Kt();let r;return{onPointerDown:()=>r=performance.now(),onPointerUp:i=>{if(performance.now()-r<Os){const{x:o,y:a}=Wr(i,t),s=Yt?10:2,l=n.getAt(o,a,void 0,s);l?e("click",{originalEvent:i,annotation:l}):e("click",{originalEvent:i})}}}},Wr=(t,n)=>{const e=n.createSVGPoint(),r=n.getBoundingClientRect(),i=t.clientX-r.x,o=t.clientY-r.y,{left:a,top:s}=n.getBoundingClientRect();return e.x=i+a,e.y=o+s,e.matrixTransform(n.getScreenCTM().inverse())};function ur(t,n,e){const r=t.slice();return r[39]=n[e],r}function fr(t,n,e){const r=t.slice();return r[42]=n[e],r}function cn(t){const n=t.slice(),e=n[42].target.selector;return n[45]=e,n}function hr(t){let n=t[42],e,r,i=pr(t);return{c(){i.c(),e=Dt()},m(o,a){i.m(o,a),it(o,e,a),r=!0},p(o,a){a[0]&131072&&xt(n,n=o[42])?(Bt(),lt(i,1,1,mt),Rt(),i=pr(o),i.c(),ot(i,1),i.m(e.parentNode,e)):i.p(o,a)},i(o){r||(ot(i),r=!0)},o(o){lt(i),r=!1},d(o){o&&rt(e),i.d(o)}}}function Ts(t){let n,e;return n=new hs({props:{annotation:t[42],geom:t[45].geometry,style:t[1]}}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&131072&&(o.annotation=r[42]),i[0]&131072&&(o.geom=r[45].geometry),i[0]&2&&(o.style=r[1]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Ls(t){let n,e;return n=new Es({props:{annotation:t[42],geom:t[45].geometry,style:t[1]}}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&131072&&(o.annotation=r[42]),i[0]&131072&&(o.geom=r[45].geometry),i[0]&2&&(o.style=r[1]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function zs(t){let n,e;return n=new gs({props:{annotation:t[42],geom:t[45].geometry,style:t[1]}}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&131072&&(o.annotation=r[42]),i[0]&131072&&(o.geom=r[45].geometry),i[0]&2&&(o.style=r[1]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Bs(t){let n,e;return n=new _s({props:{annotation:t[42],geom:t[45].geometry,style:t[1]}}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&131072&&(o.annotation=r[42]),i[0]&131072&&(o.geom=r[45].geometry),i[0]&2&&(o.style=r[1]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Rs(t){let n,e;return n=new As({props:{annotation:t[42],geom:t[45].geometry,style:t[1]}}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&131072&&(o.annotation=r[42]),i[0]&131072&&(o.geom=r[45].geometry),i[0]&2&&(o.style=r[1]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function Ps(t){var n;let e,r;return e=new ds({props:{annotation:t[42],geom:(n=t[45])==null?void 0:n.geometry,style:t[1]}}),{c(){At(e.$$.fragment)},m(i,o){Et(e,i,o),r=!0},p(i,o){var a;const s={};o[0]&131072&&(s.annotation=i[42]),o[0]&131072&&(s.geom=(a=i[45])==null?void 0:a.geometry),o[0]&2&&(s.style=i[1]),e.$set(s)},i(i){r||(ot(e.$$.fragment,i),r=!0)},o(i){lt(e.$$.fragment,i),r=!1},d(i){$t(e,i)}}}function pr(t){let n,e,r,i;const o=[Ps,Rs,Bs,zs,Ls,Ts],a=[];function s(l,c){var f,d,p,g,w,h;return((f=l[45])==null?void 0:f.type)===kt.ELLIPSE?0:((d=l[45])==null?void 0:d.type)===kt.RECTANGLE?1:((p=l[45])==null?void 0:p.type)===kt.POLYGON?2:((g=l[45])==null?void 0:g.type)===kt.MULTIPOLYGON?3:((w=l[45])==null?void 0:w.type)===kt.POLYLINE?4:((h=l[45])==null?void 0:h.type)===kt.LINE?5:-1}return~(n=s(t))&&(e=a[n]=o[n](t)),{c(){e&&e.c(),r=Dt()},m(l,c){~n&&a[n].m(l,c),it(l,r,c),i=!0},p(l,c){let f=n;n=s(l),n===f?~n&&a[n].p(l,c):(e&&(Bt(),lt(a[f],1,1,()=>{a[f]=null}),Rt()),~n?(e=a[n],e?e.p(l,c):(e=a[n]=o[n](l),e.c()),ot(e,1),e.m(r.parentNode,r)):e=null)},i(l){i||(ot(e),i=!0)},o(l){lt(e),i=!1},d(l){l&&rt(r),~n&&a[n].d(l)}}}function mr(t){let n=Fe(t[42])&&!t[10](t[42]),e,r,i=n&&hr(cn(t));return{c(){i&&i.c(),e=Dt()},m(o,a){i&&i.m(o,a),it(o,e,a),r=!0},p(o,a){a[0]&132096&&(n=Fe(o[42])&&!o[10](o[42])),n?i?(i.p(cn(o),a),a[0]&132096&&ot(i,1)):(i=hr(cn(o)),i.c(),ot(i,1),i.m(e.parentNode,e)):i&&(Bt(),lt(i,1,1,()=>{i=null}),Rt())},i(o){r||(ot(i),r=!0)},o(o){lt(i),r=!1},d(o){o&&rt(e),i&&i.d(o)}}}function gr(t){let n,e,r,i;const o=[Ds,Ms],a=[];function s(l,c){return l[6]?0:l[15]&&l[0]?1:-1}return~(n=s(t))&&(e=a[n]=o[n](t)),{c(){e&&e.c(),r=Dt()},m(l,c){~n&&a[n].m(l,c),it(l,r,c),i=!0},p(l,c){let f=n;n=s(l),n===f?~n&&a[n].p(l,c):(e&&(Bt(),lt(a[f],1,1,()=>{a[f]=null}),Rt()),~n?(e=a[n],e?e.p(l,c):(e=a[n]=o[n](l),e.c()),ot(e,1),e.m(r.parentNode,r)):e=null)},i(l){i||(ot(e),i=!0)},o(l){lt(e),i=!1},d(l){l&&rt(r),~n&&a[n].d(l)}}}function Ms(t){let n=`${t[2]}-${t[7]}`,e,r,i=yr(t);return{c(){i.c(),e=Dt()},m(o,a){i.m(o,a),it(o,e,a),r=!0},p(o,a){a[0]&132&&xt(n,n=`${o[2]}-${o[7]}`)?(Bt(),lt(i,1,1,mt),Rt(),i=yr(o),i.c(),ot(i,1),i.m(e.parentNode,e)):i.p(o,a)},i(o){r||(ot(i),r=!0)},o(o){lt(i),r=!1},d(o){o&&rt(e),i.d(o)}}}function Ds(t){let n,e,r=Pt(t[6]),i=[];for(let a=0;a<r.length;a+=1)i[a]=wr(ur(t,r,a));const o=a=>lt(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();n=Dt()},m(a,s){for(let l=0;l<i.length;l+=1)i[l]&&i[l].m(a,s);it(a,n,s),e=!0},p(a,s){if(s[0]&8659266){r=Pt(a[6]);let l;for(l=0;l<r.length;l+=1){const c=ur(a,r,l);i[l]?(i[l].p(c,s),ot(i[l],1)):(i[l]=wr(c),i[l].c(),ot(i[l],1),i[l].m(n.parentNode,n))}for(Bt(),l=r.length;l<i.length;l+=1)o(l);Rt()}},i(a){if(!e){for(let s=0;s<r.length;s+=1)ot(i[s]);e=!0}},o(a){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)lt(i[s]);e=!1},d(a){a&&rt(n),te(i,a)}}}function yr(t){let n,e;return n=new Jo({props:{target:t[8],tool:t[15],drawingMode:t[14],transform:t[13],viewportScale:t[18]}}),n.$on("create",t[22]),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){const o={};i[0]&256&&(o.target=r[8]),i[0]&32768&&(o.tool=r[15]),i[0]&16384&&(o.drawingMode=r[14]),i[0]&8192&&(o.transform=r[13]),i[0]&262144&&(o.viewportScale=r[18]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function vr(t){let n,e;return n=new qo({props:{target:t[8],editor:t[39].editor,annotation:t[39].annotation,style:t[1],transform:t[13],viewportScale:t[18]}}),n.$on("change",function(){bt(t[23](t[39].annotation))&&t[23](t[39].annotation).apply(this,arguments)}),{c(){At(n.$$.fragment)},m(r,i){Et(n,r,i),e=!0},p(r,i){t=r;const o={};i[0]&256&&(o.target=t[8]),i[0]&64&&(o.editor=t[39].editor),i[0]&64&&(o.annotation=t[39].annotation),i[0]&2&&(o.style=t[1]),i[0]&8192&&(o.transform=t[13]),i[0]&262144&&(o.viewportScale=t[18]),n.$set(o)},i(r){e||(ot(n.$$.fragment,r),e=!0)},o(r){lt(n.$$.fragment,r),e=!1},d(r){$t(n,r)}}}function wr(t){let n=t[39].annotation.id,e,r,i=vr(t);return{c(){i.c(),e=Dt()},m(o,a){i.m(o,a),it(o,e,a),r=!0},p(o,a){a[0]&64&&xt(n,n=o[39].annotation.id)?(Bt(),lt(i,1,1,mt),Rt(),i=vr(o),i.c(),ot(i,1),i.m(e.parentNode,e)):i.p(o,a)},i(o){r||(ot(i),r=!0)},o(o){lt(i),r=!1},d(o){o&&rt(e),i.d(o)}}}function Us(t){let n,e,r,i,o,a,s=Pt(t[17].filter(t[34])),l=[];for(let d=0;d<s.length;d+=1)l[d]=mr(fr(t,s,d));const c=d=>lt(l[d],1,1,()=>{l[d]=null});let f=t[8]&&gr(t);return{c(){n=tt("svg"),e=tt("g");for(let d=0;d<l.length;d+=1)l[d].c();r=tt("g"),f&&f.c(),y(r,"class","drawing"),y(n,"role","application"),y(n,"tabindex",0),y(n,"class","a9s-annotationlayer"),Ht(n,"drawing",t[15]),Ht(n,"editing",t[5]),Ht(n,"hidden",!t[3]),Ht(n,"hover",t[16])},m(d,p){it(d,n,p),dt(n,e);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(e,null);dt(n,r),f&&f.m(r,null),t[35](r),t[36](n),i=!0,o||(a=[ht(n,"pointerup",function(){bt(t[11])&&t[11].apply(this,arguments)}),ht(n,"pointerdown",function(){bt(t[12])&&t[12].apply(this,arguments)}),ht(n,"pointermove",t[24])],o=!0)},p(d,p){if(t=d,p[0]&132098){s=Pt(t[17].filter(t[34]));let g;for(g=0;g<s.length;g+=1){const w=fr(t,s,g);l[g]?(l[g].p(w,p),ot(l[g],1)):(l[g]=mr(w),l[g].c(),ot(l[g],1),l[g].m(e,null))}for(Bt(),g=s.length;g<l.length;g+=1)c(g);Rt()}t[8]?f?(f.p(t,p),p[0]&256&&ot(f,1)):(f=gr(t),f.c(),ot(f,1),f.m(r,null)):f&&(Bt(),lt(f,1,1,()=>{f=null}),Rt()),(!i||p[0]&32768)&&Ht(n,"drawing",t[15]),(!i||p[0]&32)&&Ht(n,"editing",t[5]),(!i||p[0]&8)&&Ht(n,"hidden",!t[3]),(!i||p[0]&65536)&&Ht(n,"hover",t[16])},i(d){if(!i){for(let p=0;p<s.length;p+=1)ot(l[p]);ot(f),i=!0}},o(d){l=l.filter(Boolean);for(let p=0;p<l.length;p+=1)lt(l[p]);lt(f),i=!1},d(d){d&&rt(n),te(l,d),f&&f.d(),t[35](null),t[36](null),o=!1,Mt(a)}}}function Ns(t,n,e){let r,i,o,a,s,l,c,f,d,p,g,w,h=mt,_=()=>(h(),h=Ir(A,K=>e(18,w=K)),A);t.$$.on_destroy.push(()=>h());let{drawingEnabled:v}=n,{image:k}=n,{preferredDrawingMode:x}=n,{state:$}=n,{style:O=void 0}=n,{toolName:z=Xr()[0]}=n,{user:I}=n,{visible:M=!0}=n,T=0;const X=()=>e(7,T+=1),G=()=>z,b=()=>v;let C,u,A;ee(()=>_(e(9,A=go(k,u))));const{hover:H,selection:P,store:Y}=$;Ge(t,H,K=>e(16,d=K)),Ge(t,P,K=>e(33,p=K)),Ge(t,Y,K=>e(17,g=K));let j,V;const B=K=>{j&&Y.unobserve(j);const ct=K.filter(({editable:at})=>at).map(({id:at})=>at);ct.length>0?(e(5,V=ct.map(at=>Y.getAnnotation(at)).filter(at=>at&&Fe(at))),j=at=>{const{updated:ut}=at.changes;e(5,V=ut?.map(wt=>wt.newValue))},Y.observe(j,{annotations:ct})):e(5,V=void 0)},L=K=>{const ct=Bi(),at={id:ct,bodies:[],target:{annotation:ct,selector:K.detail,creator:I,created:new Date}};Y.addAnnotation(at),P.setSelected(at.id)},et=K=>ct=>{var at;const{target:ut}=K,wt=600*1e3,St=((at=ut.creator)==null?void 0:at.id)!==I.id||!ut.created||new Date().getTime()-ut.created.getTime()>wt;Y.updateTarget({...ut,selector:ct.detail,created:St?ut.created:new Date,updated:St?new Date:void 0,updatedBy:St?I:void 0})},Q=K=>{const{x:ct,y:at}=Wr(K,u),ut=Y.getAt(ct,at,void 0,2);ut?d!==ut.id&&H.set(ut.id):H.set(void 0)},Z=K=>Fe(K);function pt(K){De[K?"unshift":"push"](()=>{C=K,e(8,C)})}function yt(K){De[K?"unshift":"push"](()=>{u=K,e(4,u)})}return t.$$set=K=>{"drawingEnabled"in K&&e(0,v=K.drawingEnabled),"image"in K&&e(25,k=K.image),"preferredDrawingMode"in K&&e(26,x=K.preferredDrawingMode),"state"in K&&e(27,$=K.state),"style"in K&&e(1,O=K.style),"toolName"in K&&e(2,z=K.toolName),"user"in K&&e(28,I=K.user),"visible"in K&&e(3,M=K.visible)},t.$$.update=()=>{t.$$.dirty[0]&4&&e(15,{tool:r,opts:i}=Hr(z)||{tool:void 0,opts:void 0},r,(e(32,i),e(2,z))),t.$$.dirty[0]&67108864|t.$$.dirty[1]&2&&e(14,o=i?.drawingMode||x),t.$$.dirty[0]&16&&e(13,a=Cs(u)),t.$$.dirty[0]&16&&e(12,{onPointerDown:s,onPointerUp:l}=Is(u,Y),s,(e(11,l),e(4,u))),t.$$.dirty[1]&4&&B(p.selected),t.$$.dirty[0]&32&&e(6,c=V?V.map(K=>({annotation:K,editor:Zo(K.target.selector)})).filter(K=>K.editor):void 0),t.$$.dirty[0]&64&&e(10,f=K=>c&&c.some(ct=>ct.annotation.id===K.id))},[v,O,z,M,u,V,c,T,C,A,f,l,s,a,o,r,d,g,w,H,P,Y,L,et,Q,k,x,$,I,X,G,b,i,p,Z,pt,yt]}class Fs extends Lt{constructor(n){super(),Tt(this,n,Ns,Us,xt,{drawingEnabled:0,image:25,preferredDrawingMode:26,state:27,style:1,toolName:2,user:28,visible:3,cancelDrawing:29,getDrawingTool:30,isDrawingEnabled:31},null,[-1,-1])}get cancelDrawing(){return this.$$.ctx[29]}get getDrawingTool(){return this.$$.ctx[30]}get isDrawingEnabled(){return this.$$.ctx[31]}}function Yr(t,n,e=0,r=t.length-1,i=js){for(;r>e;){if(r-e>600){const l=r-e+1,c=n-e+1,f=Math.log(l),d=.5*Math.exp(2*f/3),p=.5*Math.sqrt(f*d*(l-d)/l)*(c-l/2<0?-1:1),g=Math.max(e,Math.floor(n-c*d/l+p)),w=Math.min(r,Math.floor(n+(l-c)*d/l+p));Yr(t,n,g,w,i)}const o=t[n];let a=e,s=r;for(we(t,e,n),i(t[r],o)>0&&we(t,e,r);a<s;){for(we(t,a,s),a++,s--;i(t[a],o)<0;)a++;for(;i(t[s],o)>0;)s--}i(t[e],o)===0?we(t,e,s):(s++,we(t,s,r)),s<=n&&(e=s+1),n<=s&&(r=s-1)}}function we(t,n,e){const r=t[n];t[n]=t[e],t[e]=r}function js(t,n){return t<n?-1:t>n?1:0}class Xs{constructor(n=9){this._maxEntries=Math.max(4,n),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(n){let e=this.data;const r=[];if(!Le(n,e))return r;const i=this.toBBox,o=[];for(;e;){for(let a=0;a<e.children.length;a++){const s=e.children[a],l=e.leaf?i(s):s;Le(n,l)&&(e.leaf?r.push(s):un(n,l)?this._all(s,r):o.push(s))}e=o.pop()}return r}collides(n){let e=this.data;if(!Le(n,e))return!1;const r=[];for(;e;){for(let i=0;i<e.children.length;i++){const o=e.children[i],a=e.leaf?this.toBBox(o):o;if(Le(n,a)){if(e.leaf||un(n,a))return!0;r.push(o)}}e=r.pop()}return!1}load(n){if(!(n&&n.length))return this;if(n.length<this._minEntries){for(let r=0;r<n.length;r++)this.insert(n[r]);return this}let e=this._build(n.slice(),0,n.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(n){return n&&this._insert(n,this.data.height-1),this}clear(){return this.data=le([]),this}remove(n,e){if(!n)return this;let r=this.data;const i=this.toBBox(n),o=[],a=[];let s,l,c;for(;r||o.length;){if(r||(r=o.pop(),l=o[o.length-1],s=a.pop(),c=!0),r.leaf){const f=Hs(n,r.children,e);if(f!==-1)return r.children.splice(f,1),o.push(r),this._condense(o),this}!c&&!r.leaf&&un(r,i)?(o.push(r),a.push(s),s=0,l=r,r=r.children[0]):l?(s++,r=l.children[s],c=!1):r=null}return this}toBBox(n){return n}compareMinX(n,e){return n.minX-e.minX}compareMinY(n,e){return n.minY-e.minY}toJSON(){return this.data}fromJSON(n){return this.data=n,this}_all(n,e){const r=[];for(;n;)n.leaf?e.push(...n.children):r.push(...n.children),n=r.pop();return e}_build(n,e,r,i){const o=r-e+1;let a=this._maxEntries,s;if(o<=a)return s=le(n.slice(e,r+1)),se(s,this.toBBox),s;i||(i=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,i-1))),s=le([]),s.leaf=!1,s.height=i;const l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));br(n,e,r,c,this.compareMinX);for(let f=e;f<=r;f+=c){const d=Math.min(f+c-1,r);br(n,f,d,l,this.compareMinY);for(let p=f;p<=d;p+=l){const g=Math.min(p+l-1,d);s.children.push(this._build(n,p,g,i-1))}}return se(s,this.toBBox),s}_chooseSubtree(n,e,r,i){for(;i.push(e),!(e.leaf||i.length-1===r);){let o=1/0,a=1/0,s;for(let l=0;l<e.children.length;l++){const c=e.children[l],f=dn(c),d=Zs(n,c)-f;d<a?(a=d,o=f<o?f:o,s=c):d===a&&f<o&&(o=f,s=c)}e=s||e.children[0]}return e}_insert(n,e,r){const i=r?n:this.toBBox(n),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(n),_e(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)}_split(n,e){const r=n[e],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);const a=this._chooseSplitIndex(r,o,i),s=le(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,se(r,this.toBBox),se(s,this.toBBox),e?n[e-1].children.push(s):this._splitRoot(r,s)}_splitRoot(n,e){this.data=le([n,e]),this.data.height=n.height+1,this.data.leaf=!1,se(this.data,this.toBBox)}_chooseSplitIndex(n,e,r){let i,o=1/0,a=1/0;for(let s=e;s<=r-e;s++){const l=be(n,0,s,this.toBBox),c=be(n,s,r,this.toBBox),f=Gs(l,c),d=dn(l)+dn(c);f<o?(o=f,i=s,a=d<a?d:a):f===o&&d<a&&(a=d,i=s)}return i||r-e}_chooseSplitAxis(n,e,r){const i=n.leaf?this.compareMinX:Ws,o=n.leaf?this.compareMinY:Ys,a=this._allDistMargin(n,e,r,i),s=this._allDistMargin(n,e,r,o);a<s&&n.children.sort(i)}_allDistMargin(n,e,r,i){n.children.sort(i);const o=this.toBBox,a=be(n,0,e,o),s=be(n,r-e,r,o);let l=Te(a)+Te(s);for(let c=e;c<r-e;c++){const f=n.children[c];_e(a,n.leaf?o(f):f),l+=Te(a)}for(let c=r-e-1;c>=e;c--){const f=n.children[c];_e(s,n.leaf?o(f):f),l+=Te(s)}return l}_adjustParentBBoxes(n,e,r){for(let i=r;i>=0;i--)_e(e[i],n)}_condense(n){for(let e=n.length-1,r;e>=0;e--)n[e].children.length===0?e>0?(r=n[e-1].children,r.splice(r.indexOf(n[e]),1)):this.clear():se(n[e],this.toBBox)}}function Hs(t,n,e){if(!e)return n.indexOf(t);for(let r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function se(t,n){be(t,0,t.children.length,n,t)}function be(t,n,e,r,i){i||(i=le(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=n;o<e;o++){const a=t.children[o];_e(i,t.leaf?r(a):a)}return i}function _e(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function Ws(t,n){return t.minX-n.minX}function Ys(t,n){return t.minY-n.minY}function dn(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Te(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Zs(t,n){return(Math.max(n.maxX,t.maxX)-Math.min(n.minX,t.minX))*(Math.max(n.maxY,t.maxY)-Math.min(n.minY,t.minY))}function Gs(t,n){const e=Math.max(t.minX,n.minX),r=Math.max(t.minY,n.minY),i=Math.min(t.maxX,n.maxX),o=Math.min(t.maxY,n.maxY);return Math.max(0,i-e)*Math.max(0,o-r)}function un(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function Le(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function le(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function br(t,n,e,r,i){const o=[n,e];for(;o.length;){if(e=o.pop(),n=o.pop(),e-n<=r)continue;const a=n+Math.ceil((e-n)/r/2)*r;Yr(t,a,n,e,i),o.push(n,a,a,e)}}const Vs=()=>{const t=new Xs,n=new Map,e=()=>[...n.values()],r=()=>{t.clear(),n.clear()},i=a=>{if(!Me(a))return;const{minX:s,minY:l,maxX:c,maxY:f}=a.selector.geometry.bounds,d={minX:s,minY:l,maxX:c,maxY:f,target:a};t.insert(d),n.set(a.annotation,d)},o=a=>{if(!Me(a))return;const s=n.get(a.annotation);s&&t.remove(s),n.delete(a.annotation)};return{all:e,clear:r,getAt:(a,s,l=0)=>{const c=t.search({minX:a-l,minY:s-l,maxX:a+l,maxY:s+l}).map(f=>f.target).filter(f=>f.selector.type===kt.RECTANGLE||vi(f.selector,a,s,l));return c.length>0?(c.sort((f,d)=>yn(f.selector)-yn(d.selector)),c):[]},getIntersecting:(a,s,l,c)=>t.search({minX:a,minY:s,maxX:a+l,maxY:s+c}).map(f=>f.target),insert:i,remove:o,set:(a,s=!0)=>{s&&r();const l=a.reduce((c,f)=>{if(Me(f)){const{minX:d,minY:p,maxX:g,maxY:w}=f.selector.geometry.bounds;return[...c,{minX:d,minY:p,maxX:g,maxY:w,target:f}]}else return c},[]);l.forEach(c=>n.set(c.target.annotation,c)),t.load(l)},size:()=>t.all().length,update:(a,s)=>{o(a),i(s)}}},qs=t=>{const n=Ji(),e=Vs(),r=Mi(n,t.userSelectAction,t.adapter),i=Pi(n),o=ro();return n.observe(({changes:a})=>{e.set((a.created||[]).map(s=>s.target),!1),(a.deleted||[]).forEach(s=>e.remove(s.target)),(a.updated||[]).forEach(({oldValue:s,newValue:l})=>e.update(s.target,l.target))}),{store:{...n,getAt:(a,s,l,c)=>{const f=e.getAt(a,s,c);if(l)return f.map(d=>n.getAnnotation(d.annotation)).filter(Boolean).filter(l)[0];{const d=f[0];return d?n.getAnnotation(d.annotation):void 0}},getIntersecting:(a,s,l,c)=>e.getIntersecting(a,s,l,c).map(f=>n.getAnnotation(f.annotation)).filter(Boolean)},selection:r,hover:i,viewport:o}},Ks=t=>{const n=qs(t);return{...n,store:Qi(n.store)}},Js=t=>{let n,e;if(t.nodeName==="CANVAS")n=t,e=n.getContext("2d",{willReadFrequently:!0});else{const i=t;n=document.createElement("canvas"),n.width=i.width,n.height=i.height,e=n.getContext("2d",{willReadFrequently:!0}),e.drawImage(i,0,0,i.width,i.height)}let r=0;for(let i=1;i<10;i++)for(let o=1;o<10;o++){const a=Math.round(o*n.width/10),s=Math.round(i*n.height/10),l=e.getImageData(a,s,1,1).data,c=(.299*l[0]+.587*l[1]+.114*l[2])/255;r+=c}return r/81},Qs=t=>{const n=Js(t),e=n>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${n.toFixed(1)}. Setting ${e} theme.`),e},_r=(t,n,e)=>n.setAttribute("data-theme",e==="auto"?Qs(t):e),ta=(t,n)=>({...t,drawingEnabled:t.drawingEnabled===void 0?n.drawingEnabled:t.drawingEnabled,drawingMode:t.drawingMode||n.drawingMode,userSelectAction:t.userSelectAction||n.userSelectAction,theme:t.theme||n.theme}),xr=typeof navigator>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1,ea=(t,n)=>{const e=document,r=a=>{const s=a;s.key==="z"&&s.ctrlKey?t.undo():s.key==="y"&&s.ctrlKey&&t.redo()},i=a=>{const s=a;s.key==="z"&&s.metaKey&&(s.shiftKey?t.redo():t.undo())},o=()=>{xr?e.removeEventListener("keydown",i):e.removeEventListener("keydown",r)};return xr?e.addEventListener("keydown",i):e.addEventListener("keydown",r),{destroy:o}},na=(t,n={})=>{if(!t)throw"Missing argument: image";const e=typeof t=="string"?document.getElementById(t):t,r=ta(n,{drawingEnabled:!0,drawingMode:"drag",userSelectAction:Ur.EDIT,theme:"light"}),i=Ks(r),{selection:o,store:a}=i,s=no(a,r.initialHistory),l=io(i,s,r.adapter,r.autoSave),c=document.createElement("DIV");c.style.position="relative",c.style.display="inline-block",e.style.display="block",e.parentNode.insertBefore(c,e),c.appendChild(e);const f=ea(s);let d=ho();_r(e,c,r.theme);const p=new Fs({target:c,props:{drawingEnabled:!!r.drawingEnabled,image:e,preferredDrawingMode:r.drawingMode,state:i,style:r.style,user:d}});p.$on("click",b=>{const{originalEvent:C,annotation:u}=b.detail;u?o.userSelect(u.id,C):o.isEmpty()||o.clear()});const g=so(i,s,r.adapter),w=()=>p.cancelDrawing(),h=()=>{p.$destroy(),c.parentNode.insertBefore(e,c),c.parentNode.removeChild(c),f.destroy(),s.destroy()},_=()=>p.getDrawingTool(),v=()=>d,k=()=>p.isDrawingEnabled(),x=(b,C,u)=>as(b,C,u),$=(b,C)=>Go(b,C),O=b=>{if(!Hr(b))throw`No drawing tool named ${b}`;p.$set({toolName:b})},z=b=>p.$set({drawingEnabled:b}),I=b=>{console.warn("Filter not implemented yet")},M=b=>p.$set({style:b}),T=b=>_r(e,c,b),X=b=>{d=b,p.$set({user:b})},G=b=>p.$set({visible:b});return{...g,cancelDrawing:w,destroy:h,getDrawingTool:_,getUser:v,isDrawingEnabled:k,listDrawingTools:Xr,on:l.on,off:l.off,registerDrawingTool:x,registerShapeEditor:$,setDrawingEnabled:z,setDrawingTool:O,setFilter:I,setStyle:M,setTheme:T,setUser:X,setVisible:G,element:c,state:i}};var ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ra(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Be(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var kr;function ia(){return kr||(kr=1,(function(t,n){(function(e){t.exports=e()})(function(){return(function e(r,i,o){function a(c,f){if(!i[c]){if(!r[c]){var d=typeof Be=="function"&&Be;if(!f&&d)return d(c,!0);if(s)return s(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var g=i[c]={exports:{}};r[c][0].call(g.exports,function(w){var h=r[c][1][w];return a(h||w)},g,g.exports,e,r,i,o)}return i[c].exports}for(var s=typeof Be=="function"&&Be,l=0;l<o.length;l++)a(o[l]);return a})({1:[function(e,r,i){var o=e("./utils"),a=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,f,d,p,g,w,h,_=[],v=0,k=l.length,x=k,$=o.getTypeOf(l)!=="string";v<l.length;)x=k-v,d=$?(c=l[v++],f=v<k?l[v++]:0,v<k?l[v++]:0):(c=l.charCodeAt(v++),f=v<k?l.charCodeAt(v++):0,v<k?l.charCodeAt(v++):0),p=c>>2,g=(3&c)<<4|f>>4,w=1<x?(15&f)<<2|d>>6:64,h=2<x?63&d:64,_.push(s.charAt(p)+s.charAt(g)+s.charAt(w)+s.charAt(h));return _.join("")},i.decode=function(l){var c,f,d,p,g,w,h=0,_=0,v="data:";if(l.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var k,x=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===s.charAt(64)&&x--,l.charAt(l.length-2)===s.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=a.uint8array?new Uint8Array(0|x):new Array(0|x);h<l.length;)c=s.indexOf(l.charAt(h++))<<2|(p=s.indexOf(l.charAt(h++)))>>4,f=(15&p)<<4|(g=s.indexOf(l.charAt(h++)))>>2,d=(3&g)<<6|(w=s.indexOf(l.charAt(h++))),k[_++]=c,g!==64&&(k[_++]=f),w!==64&&(k[_++]=d);return k}},{"./support":30,"./utils":32}],2:[function(e,r,i){var o=e("./external"),a=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(f,d,p,g,w){this.compressedSize=f,this.uncompressedSize=d,this.crc32=p,this.compression=g,this.compressedContent=w}c.prototype={getContentWorker:function(){var f=new a(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return f.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new a(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(f,d,p){return f.pipe(new s).pipe(new l("uncompressedSize")).pipe(d.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,i){var o=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,i){var o=e("./utils"),a=(function(){for(var s,l=[],c=0;c<256;c++){s=c;for(var f=0;f<8;f++)s=1&s?3988292384^s>>>1:s>>>1;l[c]=s}return l})();r.exports=function(s,l){return s!==void 0&&s.length?o.getTypeOf(s)!=="string"?(function(c,f,d,p){var g=a,w=p+d;c^=-1;for(var h=p;h<w;h++)c=c>>>8^g[255&(c^f[h])];return-1^c})(0|l,s,s.length,0):(function(c,f,d,p){var g=a,w=p+d;c^=-1;for(var h=p;h<w;h++)c=c>>>8^g[255&(c^f.charCodeAt(h))];return-1^c})(0|l,s,s.length,0):0}},{"./utils":32}],5:[function(e,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,r,i){var o=null;o=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:o}},{lie:37}],7:[function(e,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),s=e("./utils"),l=e("./stream/GenericWorker"),c=o?"uint8array":"array";function f(d,p){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=p,this.meta={}}i.magic="\b\0",s.inherits(f,l),f.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(c,d.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(p){d.push({data:p,meta:d.meta})}},i.compressWorker=function(d){return new f("Deflate",d)},i.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,i){function o(g,w){var h,_="";for(h=0;h<w;h++)_+=String.fromCharCode(255&g),g>>>=8;return _}function a(g,w,h,_,v,k){var x,$,O=g.file,z=g.compression,I=k!==c.utf8encode,M=s.transformTo("string",k(O.name)),T=s.transformTo("string",c.utf8encode(O.name)),X=O.comment,G=s.transformTo("string",k(X)),b=s.transformTo("string",c.utf8encode(X)),C=T.length!==O.name.length,u=b.length!==X.length,A="",H="",P="",Y=O.dir,j=O.date,V={crc32:0,compressedSize:0,uncompressedSize:0};w&&!h||(V.crc32=g.crc32,V.compressedSize=g.compressedSize,V.uncompressedSize=g.uncompressedSize);var B=0;w&&(B|=8),I||!C&&!u||(B|=2048);var L=0,et=0;Y&&(L|=16),v==="UNIX"?(et=798,L|=(function(Z,pt){var yt=Z;return Z||(yt=pt?16893:33204),(65535&yt)<<16})(O.unixPermissions,Y)):(et=20,L|=(function(Z){return 63&(Z||0)})(O.dosPermissions)),x=j.getUTCHours(),x<<=6,x|=j.getUTCMinutes(),x<<=5,x|=j.getUTCSeconds()/2,$=j.getUTCFullYear()-1980,$<<=4,$|=j.getUTCMonth()+1,$<<=5,$|=j.getUTCDate(),C&&(H=o(1,1)+o(f(M),4)+T,A+="up"+o(H.length,2)+H),u&&(P=o(1,1)+o(f(G),4)+b,A+="uc"+o(P.length,2)+P);var Q="";return Q+=`
\0`,Q+=o(B,2),Q+=z.magic,Q+=o(x,2),Q+=o($,2),Q+=o(V.crc32,4),Q+=o(V.compressedSize,4),Q+=o(V.uncompressedSize,4),Q+=o(M.length,2),Q+=o(A.length,2),{fileRecord:d.LOCAL_FILE_HEADER+Q+M+A,dirRecord:d.CENTRAL_FILE_HEADER+o(et,2)+Q+o(G.length,2)+"\0\0\0\0"+o(L,4)+o(_,4)+M+A+G}}var s=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),f=e("../crc32"),d=e("../signature");function p(g,w,h,_){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=h,this.encodeFileName=_,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(p,l),p.prototype.push=function(g){var w=g.meta.percent||0,h=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,l.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:h?(w+100*(h-_-1))/h:100}}))},p.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var w=this.streamFiles&&!g.file.dir;if(w){var h=a(g,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(g){this.accumulate=!1;var w=this.streamFiles&&!g.file.dir,h=a(g,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),w)this.push({data:(function(_){return d.DATA_DESCRIPTOR+o(_.crc32,4)+o(_.compressedSize,4)+o(_.uncompressedSize,4)})(g),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var g=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var h=this.bytesWritten-g,_=(function(v,k,x,$,O){var z=s.transformTo("string",O($));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(v,2)+o(v,2)+o(k,4)+o(x,4)+o(z.length,2)+z})(this.dirRecords.length,h,g,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(g){this._sources.push(g);var w=this;return g.on("data",function(h){w.processChunk(h)}),g.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),g.on("error",function(h){w.error(h)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(g){var w=this._sources;if(!l.prototype.error.call(this,g))return!1;for(var h=0;h<w.length;h++)try{w[h].error(g)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var g=this._sources,w=0;w<g.length;w++)g[w].lock()},r.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,i){var o=e("../compressions"),a=e("./ZipFileWorker");i.generateWorker=function(s,l,c){var f=new a(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{s.forEach(function(p,g){d++;var w=(function(k,x){var $=k||x,O=o[$];if(!O)throw new Error($+" is not a valid compression method !");return O})(g.options.compression,l.compression),h=g.options.compressionOptions||l.compressionOptions||{},_=g.dir,v=g.date;g._compressWorker(w,h).withStreamInfo("file",{name:p,dir:_,date:v,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(f)}),f.entriesCount=d}catch(p){f.error(p)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new o;for(var s in this)typeof this[s]!="function"&&(a[s]=this[s]);return a}}(o.prototype=e("./object")).loadAsync=e("./load"),o.support=e("./support"),o.defaults=e("./defaults"),o.version="3.10.1",o.loadAsync=function(a,s){return new o().loadAsync(a,s)},o.external=e("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,i){var o=e("./utils"),a=e("./external"),s=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),f=e("./nodejsUtils");function d(p){return new a.Promise(function(g,w){var h=p.decompressed.getContentWorker().pipe(new c);h.on("error",function(_){w(_)}).on("end",function(){h.streamInfo.crc32!==p.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}r.exports=function(p,g){var w=this;return g=o.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),f.isNode&&f.isStream(p)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",p,!0,g.optimizedBinaryString,g.base64).then(function(h){var _=new l(g);return _.load(h),_}).then(function(h){var _=[a.Promise.resolve(h)],v=h.files;if(g.checkCRC32)for(var k=0;k<v.length;k++)_.push(d(v[k]));return a.Promise.all(_)}).then(function(h){for(var _=h.shift(),v=_.files,k=0;k<v.length;k++){var x=v[k],$=x.fileNameStr,O=o.resolve(x.fileNameStr);w.file(O,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:g.createFolders}),x.dir||(w.file(O).unsafeOriginalName=$)}return _.zipComment.length&&(w.comment=_.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,i){var o=e("../utils"),a=e("../stream/GenericWorker");function s(l,c){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}o.inherits(s,a),s.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(f){c.push({data:f,meta:{percent:0}})}).on("error",function(f){c.isPaused?this.generatedError=f:c.error(f)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},s.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,i){var o=e("readable-stream").Readable;function a(s,l,c){o.call(this,l),this._helper=s;var f=this;s.on("data",function(d,p){f.push(d)||f._helper.pause(),c&&c(p)}).on("error",function(d){f.emit("error",d)}).on("end",function(){f.push(null)})}e("../utils").inherits(a,o),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,a);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,a)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var a=new Buffer(o);return a.fill(0),a},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(e,r,i){function o(O,z,I){var M,T=s.getTypeOf(z),X=s.extend(I||{},f);X.date=X.date||new Date,X.compression!==null&&(X.compression=X.compression.toUpperCase()),typeof X.unixPermissions=="string"&&(X.unixPermissions=parseInt(X.unixPermissions,8)),X.unixPermissions&&16384&X.unixPermissions&&(X.dir=!0),X.dosPermissions&&16&X.dosPermissions&&(X.dir=!0),X.dir&&(O=v(O)),X.createFolders&&(M=_(O))&&k.call(this,M,!0);var G=T==="string"&&X.binary===!1&&X.base64===!1;I&&I.binary!==void 0||(X.binary=!G),(z instanceof d&&z.uncompressedSize===0||X.dir||!z||z.length===0)&&(X.base64=!1,X.binary=!0,z="",X.compression="STORE",T="string");var b=null;b=z instanceof d||z instanceof l?z:w.isNode&&w.isStream(z)?new h(O,z):s.prepareContent(O,z,X.binary,X.optimizedBinaryString,X.base64);var C=new p(O,b,X);this.files[O]=C}var a=e("./utf8"),s=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),f=e("./defaults"),d=e("./compressedObject"),p=e("./zipObject"),g=e("./generate"),w=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),_=function(O){O.slice(-1)==="/"&&(O=O.substring(0,O.length-1));var z=O.lastIndexOf("/");return 0<z?O.substring(0,z):""},v=function(O){return O.slice(-1)!=="/"&&(O+="/"),O},k=function(O,z){return z=z!==void 0?z:f.createFolders,O=v(O),this.files[O]||o.call(this,O,null,{dir:!0,createFolders:z}),this.files[O]};function x(O){return Object.prototype.toString.call(O)==="[object RegExp]"}var $={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(O){var z,I,M;for(z in this.files)M=this.files[z],(I=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&O(I,M)},filter:function(O){var z=[];return this.forEach(function(I,M){O(I,M)&&z.push(M)}),z},file:function(O,z,I){if(arguments.length!==1)return O=this.root+O,o.call(this,O,z,I),this;if(x(O)){var M=O;return this.filter(function(X,G){return!G.dir&&M.test(X)})}var T=this.files[this.root+O];return T&&!T.dir?T:null},folder:function(O){if(!O)return this;if(x(O))return this.filter(function(T,X){return X.dir&&O.test(T)});var z=this.root+O,I=k.call(this,z),M=this.clone();return M.root=I.name,M},remove:function(O){O=this.root+O;var z=this.files[O];if(z||(O.slice(-1)!=="/"&&(O+="/"),z=this.files[O]),z&&!z.dir)delete this.files[O];else for(var I=this.filter(function(T,X){return X.name.slice(0,O.length)===O}),M=0;M<I.length;M++)delete this.files[I[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(O){var z,I={};try{if((I=s.extend(O||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");s.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var M=I.comment||this.comment||"";z=g.generateWorker(this,I,M)}catch(T){(z=new l("error")).error(T)}return new c(z,I.type||"string",I.mimeType)},generateAsync:function(O,z){return this.generateInternalStream(O).accumulate(z)},generateNodeStream:function(O,z){return(O=O||{}).type||(O.type="nodebuffer"),this.generateInternalStream(O).toNodejsStream(z)}};r.exports=$},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,i){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,i){var o=e("./DataReader");function a(s){o.call(this,s);for(var l=0;l<this.data.length;l++)s[l]=255&s[l]}e("../utils").inherits(a,o),a.prototype.byteAt=function(s){return this.data[this.zero+s]},a.prototype.lastIndexOfSignature=function(s){for(var l=s.charCodeAt(0),c=s.charCodeAt(1),f=s.charCodeAt(2),d=s.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===f&&this.data[p+3]===d)return p-this.zero;return-1},a.prototype.readAndCheckSignature=function(s){var l=s.charCodeAt(0),c=s.charCodeAt(1),f=s.charCodeAt(2),d=s.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&f===p[2]&&d===p[3]},a.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,r,i){var o=e("../utils");function a(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var l,c=0;for(this.checkOffset(s),l=this.index+s-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=s,c},readString:function(s){return o.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},r.exports=a},{"../utils":32}],19:[function(e,r,i){var o=e("./Uint8ArrayReader");function a(s){o.call(this,s)}e("../utils").inherits(a,o),a.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,i){var o=e("./DataReader");function a(s){o.call(this,s)}e("../utils").inherits(a,o),a.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},a.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},a.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},a.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,r,i){var o=e("./ArrayReader");function a(s){o.call(this,s)}e("../utils").inherits(a,o),a.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,i){var o=e("../utils"),a=e("../support"),s=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),f=e("./Uint8ArrayReader");r.exports=function(d){var p=o.getTypeOf(d);return o.checkSupport(p),p!=="string"||a.uint8array?p==="nodebuffer"?new c(d):a.uint8array?new f(o.transformTo("uint8array",d)):new s(o.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,i){var o=e("./GenericWorker"),a=e("../utils");function s(l){o.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(s,o),s.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},r.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,i){var o=e("./GenericWorker"),a=e("../crc32");function s(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,o),s.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,i){var o=e("../utils"),a=e("./GenericWorker");function s(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(s,a),s.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}a.prototype.processChunk.call(this,l)},r.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,i){var o=e("../utils"),a=e("./GenericWorker");function s(l){a.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){c.dataIsReady=!0,c.data=f,c.max=f&&f.length||0,c.type=o.getTypeOf(f),c.isPaused||c._tickAndRepeat()},function(f){c.error(f)})}o.inherits(s,a),s.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,i){function o(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,s){return this._listeners[a].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,s){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,s)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var s=this;return a.on("data",function(l){s.processChunk(l)}),a.on("end",function(){s.end()}),a.on("error",function(l){s.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,s){return this.extraStreamInfo[a]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=o},{}],29:[function(e,r,i){var o=e("../utils"),a=e("./ConvertWorker"),s=e("./GenericWorker"),l=e("../base64"),c=e("../support"),f=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(w,h){return new f.Promise(function(_,v){var k=[],x=w._internalType,$=w._outputType,O=w._mimeType;w.on("data",function(z,I){k.push(z),h&&h(I)}).on("error",function(z){k=[],v(z)}).on("end",function(){try{var z=(function(I,M,T){switch(I){case"blob":return o.newBlob(o.transformTo("arraybuffer",M),T);case"base64":return l.encode(M);default:return o.transformTo(I,M)}})($,(function(I,M){var T,X=0,G=null,b=0;for(T=0;T<M.length;T++)b+=M[T].length;switch(I){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(G=new Uint8Array(b),T=0;T<M.length;T++)G.set(M[T],X),X+=M[T].length;return G;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+I+"'")}})(x,k),O);_(z)}catch(I){v(I)}k=[]}).resume()})}function g(w,h,_){var v=h;switch(h){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=h,this._mimeType=_,o.checkSupport(v),this._worker=w.pipe(new a(v)),w.lock()}catch(k){this._worker=new s("error"),this._worker.error(k)}}g.prototype={accumulate:function(w){return p(this,w)},on:function(w,h){var _=this;return w==="data"?this._worker.on(w,function(v){h.call(_,v.data,v.meta)}):this._worker.on(w,function(){o.delay(h,arguments,_)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},w)}},r.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(o),i.blob=a.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,i){for(var o=e("./utils"),a=e("./support"),s=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),f=0;f<256;f++)c[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}i.utf8encode=function(g){return a.nodebuffer?s.newBufferFrom(g,"utf-8"):(function(w){var h,_,v,k,x,$=w.length,O=0;for(k=0;k<$;k++)(64512&(_=w.charCodeAt(k)))==55296&&k+1<$&&(64512&(v=w.charCodeAt(k+1)))==56320&&(_=65536+(_-55296<<10)+(v-56320),k++),O+=_<128?1:_<2048?2:_<65536?3:4;for(h=a.uint8array?new Uint8Array(O):new Array(O),k=x=0;x<O;k++)(64512&(_=w.charCodeAt(k)))==55296&&k+1<$&&(64512&(v=w.charCodeAt(k+1)))==56320&&(_=65536+(_-55296<<10)+(v-56320),k++),_<128?h[x++]=_:(_<2048?h[x++]=192|_>>>6:(_<65536?h[x++]=224|_>>>12:(h[x++]=240|_>>>18,h[x++]=128|_>>>12&63),h[x++]=128|_>>>6&63),h[x++]=128|63&_);return h})(g)},i.utf8decode=function(g){return a.nodebuffer?o.transformTo("nodebuffer",g).toString("utf-8"):(function(w){var h,_,v,k,x=w.length,$=new Array(2*x);for(h=_=0;h<x;)if((v=w[h++])<128)$[_++]=v;else if(4<(k=c[v]))$[_++]=65533,h+=k-1;else{for(v&=k===2?31:k===3?15:7;1<k&&h<x;)v=v<<6|63&w[h++],k--;1<k?$[_++]=65533:v<65536?$[_++]=v:(v-=65536,$[_++]=55296|v>>10&1023,$[_++]=56320|1023&v)}return $.length!==_&&($.subarray?$=$.subarray(0,_):$.length=_),o.applyFromCharCode($)})(g=o.transformTo(a.uint8array?"uint8array":"array",g))},o.inherits(d,l),d.prototype.processChunk=function(g){var w=o.transformTo(a.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var h=w;(w=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),w.set(h,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var _=(function(k,x){var $;for((x=x||k.length)>k.length&&(x=k.length),$=x-1;0<=$&&(192&k[$])==128;)$--;return $<0||$===0?x:$+c[k[$]]>x?$:x})(w),v=w;_!==w.length&&(a.uint8array?(v=w.subarray(0,_),this.leftOver=w.subarray(_,w.length)):(v=w.slice(0,_),this.leftOver=w.slice(_,w.length))),this.push({data:i.utf8decode(v),meta:g.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,o.inherits(p,l),p.prototype.processChunk=function(g){this.push({data:i.utf8encode(g.data),meta:g.meta})},i.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,i){var o=e("./support"),a=e("./base64"),s=e("./nodejsUtils"),l=e("./external");function c(h){return h}function f(h,_){for(var v=0;v<h.length;++v)_[v]=255&h.charCodeAt(v);return _}e("setimmediate"),i.newBlob=function(h,_){i.checkSupport("blob");try{return new Blob([h],{type:_})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(h),v.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(h,_,v){var k=[],x=0,$=h.length;if($<=v)return String.fromCharCode.apply(null,h);for(;x<$;)_==="array"||_==="nodebuffer"?k.push(String.fromCharCode.apply(null,h.slice(x,Math.min(x+v,$)))):k.push(String.fromCharCode.apply(null,h.subarray(x,Math.min(x+v,$)))),x+=v;return k.join("")},stringifyByChar:function(h){for(var _="",v=0;v<h.length;v++)_+=String.fromCharCode(h[v]);return _},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}})()}};function p(h){var _=65536,v=i.getTypeOf(h),k=!0;if(v==="uint8array"?k=d.applyCanBeUsed.uint8array:v==="nodebuffer"&&(k=d.applyCanBeUsed.nodebuffer),k)for(;1<_;)try{return d.stringifyByChunk(h,v,_)}catch{_=Math.floor(_/2)}return d.stringifyByChar(h)}function g(h,_){for(var v=0;v<h.length;v++)_[v]=h[v];return _}i.applyFromCharCode=p;var w={};w.string={string:c,array:function(h){return f(h,new Array(h.length))},arraybuffer:function(h){return w.string.uint8array(h).buffer},uint8array:function(h){return f(h,new Uint8Array(h.length))},nodebuffer:function(h){return f(h,s.allocBuffer(h.length))}},w.array={string:p,array:c,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return s.newBufferFrom(h)}},w.arraybuffer={string:function(h){return p(new Uint8Array(h))},array:function(h){return g(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:c,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return s.newBufferFrom(new Uint8Array(h))}},w.uint8array={string:p,array:function(h){return g(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:c,nodebuffer:function(h){return s.newBufferFrom(h)}},w.nodebuffer={string:p,array:function(h){return g(h,new Array(h.length))},arraybuffer:function(h){return w.nodebuffer.uint8array(h).buffer},uint8array:function(h){return g(h,new Uint8Array(h.length))},nodebuffer:c},i.transformTo=function(h,_){if(_=_||"",!h)return _;i.checkSupport(h);var v=i.getTypeOf(_);return w[v][h](_)},i.resolve=function(h){for(var _=h.split("/"),v=[],k=0;k<_.length;k++){var x=_[k];x==="."||x===""&&k!==0&&k!==_.length-1||(x===".."?v.pop():v.push(x))}return v.join("/")},i.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":o.nodebuffer&&s.isBuffer(h)?"nodebuffer":o.uint8array&&h instanceof Uint8Array?"uint8array":o.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(h){if(!o[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(h){var _,v,k="";for(v=0;v<(h||"").length;v++)k+="\\x"+((_=h.charCodeAt(v))<16?"0":"")+_.toString(16).toUpperCase();return k},i.delay=function(h,_,v){setImmediate(function(){h.apply(v||null,_||[])})},i.inherits=function(h,_){function v(){}v.prototype=_.prototype,h.prototype=new v},i.extend=function(){var h,_,v={};for(h=0;h<arguments.length;h++)for(_ in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],_)&&v[_]===void 0&&(v[_]=arguments[h][_]);return v},i.prepareContent=function(h,_,v,k,x){return l.Promise.resolve(_).then(function($){return o.blob&&($ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call($))!==-1)&&typeof FileReader<"u"?new l.Promise(function(O,z){var I=new FileReader;I.onload=function(M){O(M.target.result)},I.onerror=function(M){z(M.target.error)},I.readAsArrayBuffer($)}):$}).then(function($){var O=i.getTypeOf($);return O?(O==="arraybuffer"?$=i.transformTo("uint8array",$):O==="string"&&(x?$=a.decode($):v&&k!==!0&&($=(function(z){return f(z,o.uint8array?new Uint8Array(z.length):new Array(z.length))})($))),$):l.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,i){var o=e("./reader/readerFor"),a=e("./utils"),s=e("./signature"),l=e("./zipEntry"),c=e("./support");function f(d){this.files=[],this.loadOptions=d}f.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(p)+", expected "+a.pretty(d)+")")}},isSignature:function(d,p){var g=this.reader.index;this.reader.setIndex(d);var w=this.reader.readString(4)===p;return this.reader.setIndex(g),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",g=a.transformTo(p,d);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,p,g,w=this.zip64EndOfCentralSize-44;0<w;)d=this.reader.readInt(2),p=this.reader.readInt(4),g=this.reader.readData(p),this.zip64ExtensibleData[d]={id:d,length:p,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,p;for(d=0;d<this.files.length;d++)p=this.files[d],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var p=d;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var w=p-g;if(0<w)this.isSignature(p,s.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(d){this.reader=o(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,i){var o=e("./reader/readerFor"),a=e("./utils"),s=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),f=e("./compressions"),d=e("./support");function p(g,w){this.options=g,this.loadOptions=w}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var w,h;if(g.skip(22),this.fileNameLength=g.readInt(2),h=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(_){for(var v in f)if(Object.prototype.hasOwnProperty.call(f,v)&&f[v].magic===_)return f[v];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,w,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var w=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(w),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=o(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var w,h,_,v=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<v;)w=g.readInt(2),h=g.readInt(2),_=g.readData(h),this.extraFields[w]={id:w,length:h,value:_};g.setIndex(v)},handleUTF8:function(){var g=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var h=a.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var v=a.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var w=o(g.value);return w.readInt(1)!==1||l(this.fileName)!==w.readInt(4)?null:c.utf8decode(w.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var w=o(g.value);return w.readInt(1)!==1||l(this.fileComment)!==w.readInt(4)?null:c.utf8decode(w.readData(g.length-5))}return null}},r.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,i){function o(w,h,_){this.name=w,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=h,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var a=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),f=e("./stream/GenericWorker");o.prototype={internalStream:function(w){var h=null,_="string";try{if(!w)throw new Error("No output type specified.");var v=(_=w.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),h=this._decompressWorker();var k=!this._dataBinary;k&&!v&&(h=h.pipe(new l.Utf8EncodeWorker)),!k&&v&&(h=h.pipe(new l.Utf8DecodeWorker))}catch(x){(h=new f("error")).error(x)}return new a(h,_,"")},async:function(w,h){return this.internalStream(w).accumulate(h)},nodeStream:function(w,h){return this.internalStream(w||"nodebuffer").toNodejsStream(h)},_compressWorker:function(w,h){if(this._data instanceof c&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(_,w,h)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof f?this._data:new s(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<d.length;g++)o.prototype[d[g]]=p;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,i){(function(o){var a,s,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var c=0,f=new l(w),d=o.document.createTextNode("");f.observe(d,{characterData:!0}),a=function(){d.data=c=++c%2}}else if(o.setImmediate||o.MessageChannel===void 0)a="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var h=o.document.createElement("script");h.onreadystatechange=function(){w(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},o.document.documentElement.appendChild(h)}:function(){setTimeout(w,0)};else{var p=new o.MessageChannel;p.port1.onmessage=w,a=function(){p.port2.postMessage(0)}}var g=[];function w(){var h,_;s=!0;for(var v=g.length;v;){for(_=g,g=[],h=-1;++h<v;)_[h]();v=g.length}s=!1}r.exports=function(h){g.push(h)!==1||s||a()}}).call(this,typeof ze<"u"?ze:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,i){var o=e("immediate");function a(){}var s={},l=["REJECTED"],c=["FULFILLED"],f=["PENDING"];function d(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,v!==a&&h(this,v)}function p(v,k,x){this.promise=v,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function g(v,k,x){o(function(){var $;try{$=k(x)}catch(O){return s.reject(v,O)}$===v?s.reject(v,new TypeError("Cannot resolve promise with itself")):s.resolve(v,$)})}function w(v){var k=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof k=="function")return function(){k.apply(v,arguments)}}function h(v,k){var x=!1;function $(I){x||(x=!0,s.reject(v,I))}function O(I){x||(x=!0,s.resolve(v,I))}var z=_(function(){k(O,$)});z.status==="error"&&$(z.value)}function _(v,k){var x={};try{x.value=v(k),x.status="success"}catch($){x.status="error",x.value=$}return x}(r.exports=d).prototype.finally=function(v){if(typeof v!="function")return this;var k=this.constructor;return this.then(function(x){return k.resolve(v()).then(function(){return x})},function(x){return k.resolve(v()).then(function(){throw x})})},d.prototype.catch=function(v){return this.then(null,v)},d.prototype.then=function(v,k){if(typeof v!="function"&&this.state===c||typeof k!="function"&&this.state===l)return this;var x=new this.constructor(a);return this.state!==f?g(x,this.state===c?v:k,this.outcome):this.queue.push(new p(x,v,k)),x},p.prototype.callFulfilled=function(v){s.resolve(this.promise,v)},p.prototype.otherCallFulfilled=function(v){g(this.promise,this.onFulfilled,v)},p.prototype.callRejected=function(v){s.reject(this.promise,v)},p.prototype.otherCallRejected=function(v){g(this.promise,this.onRejected,v)},s.resolve=function(v,k){var x=_(w,k);if(x.status==="error")return s.reject(v,x.value);var $=x.value;if($)h(v,$);else{v.state=c,v.outcome=k;for(var O=-1,z=v.queue.length;++O<z;)v.queue[O].callFulfilled(k)}return v},s.reject=function(v,k){v.state=l,v.outcome=k;for(var x=-1,$=v.queue.length;++x<$;)v.queue[x].callRejected(k);return v},d.resolve=function(v){return v instanceof this?v:s.resolve(new this(a),v)},d.reject=function(v){var k=new this(a);return s.reject(k,v)},d.all=function(v){var k=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=v.length,$=!1;if(!x)return this.resolve([]);for(var O=new Array(x),z=0,I=-1,M=new this(a);++I<x;)T(v[I],I);return M;function T(X,G){k.resolve(X).then(function(b){O[G]=b,++z!==x||$||($=!0,s.resolve(M,O))},function(b){$||($=!0,s.reject(M,b))})}},d.race=function(v){var k=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=v.length,$=!1;if(!x)return this.resolve([]);for(var O=-1,z=new this(a);++O<x;)I=v[O],k.resolve(I).then(function(M){$||($=!0,s.resolve(z,M))},function(M){$||($=!0,s.reject(z,M))});var I;return z}},{immediate:36}],38:[function(e,r,i){var o={};(0,e("./lib/utils/common").assign)(o,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,i){var o=e("./zlib/deflate"),a=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),f=Object.prototype.toString,d=0,p=-1,g=0,w=8;function h(v){if(!(this instanceof h))return new h(v);this.options=a.assign({level:p,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},v||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var x=o.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(x!==d)throw new Error(l[x]);if(k.header&&o.deflateSetHeader(this.strm,k.header),k.dictionary){var $;if($=typeof k.dictionary=="string"?s.string2buf(k.dictionary):f.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(x=o.deflateSetDictionary(this.strm,$))!==d)throw new Error(l[x]);this._dict_set=!0}}function _(v,k){var x=new h(k);if(x.push(v,!0),x.err)throw x.msg||l[x.err];return x.result}h.prototype.push=function(v,k){var x,$,O=this.strm,z=this.options.chunkSize;if(this.ended)return!1;$=k===~~k?k:k===!0?4:0,typeof v=="string"?O.input=s.string2buf(v):f.call(v)==="[object ArrayBuffer]"?O.input=new Uint8Array(v):O.input=v,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new a.Buf8(z),O.next_out=0,O.avail_out=z),(x=o.deflate(O,$))!==1&&x!==d)return this.onEnd(x),!(this.ended=!0);O.avail_out!==0&&(O.avail_in!==0||$!==4&&$!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(a.shrinkBuf(O.output,O.next_out))):this.onData(a.shrinkBuf(O.output,O.next_out)))}while((0<O.avail_in||O.avail_out===0)&&x!==1);return $===4?(x=o.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===d):$!==2||(this.onEnd(d),!(O.avail_out=0))},h.prototype.onData=function(v){this.chunks.push(v)},h.prototype.onEnd=function(v){v===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},i.Deflate=h,i.deflate=_,i.deflateRaw=function(v,k){return(k=k||{}).raw=!0,_(v,k)},i.gzip=function(v,k){return(k=k||{}).gzip=!0,_(v,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,i){var o=e("./zlib/inflate"),a=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=e("./zlib/gzheader"),p=Object.prototype.toString;function g(h){if(!(this instanceof g))return new g(h);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},h||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||h&&h.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var v=o.inflateInit2(this.strm,_.windowBits);if(v!==l.Z_OK)throw new Error(c[v]);this.header=new d,o.inflateGetHeader(this.strm,this.header)}function w(h,_){var v=new g(_);if(v.push(h,!0),v.err)throw v.msg||c[v.err];return v.result}g.prototype.push=function(h,_){var v,k,x,$,O,z,I=this.strm,M=this.options.chunkSize,T=this.options.dictionary,X=!1;if(this.ended)return!1;k=_===~~_?_:_===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof h=="string"?I.input=s.binstring2buf(h):p.call(h)==="[object ArrayBuffer]"?I.input=new Uint8Array(h):I.input=h,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new a.Buf8(M),I.next_out=0,I.avail_out=M),(v=o.inflate(I,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&T&&(z=typeof T=="string"?s.string2buf(T):p.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,v=o.inflateSetDictionary(this.strm,z)),v===l.Z_BUF_ERROR&&X===!0&&(v=l.Z_OK,X=!1),v!==l.Z_STREAM_END&&v!==l.Z_OK)return this.onEnd(v),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&v!==l.Z_STREAM_END&&(I.avail_in!==0||k!==l.Z_FINISH&&k!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=s.utf8border(I.output,I.next_out),$=I.next_out-x,O=s.buf2string(I.output,x),I.next_out=$,I.avail_out=M-$,$&&a.arraySet(I.output,I.output,x,$,0),this.onData(O)):this.onData(a.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(X=!0)}while((0<I.avail_in||I.avail_out===0)&&v!==l.Z_STREAM_END);return v===l.Z_STREAM_END&&(k=l.Z_FINISH),k===l.Z_FINISH?(v=o.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===l.Z_OK):k!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(I.avail_out=0))},g.prototype.onData=function(h){this.chunks.push(h)},g.prototype.onEnd=function(h){h===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},i.Inflate=g,i.inflate=w,i.inflateRaw=function(h,_){return(_=_||{}).raw=!0,w(h,_)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var f=c.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var d in f)f.hasOwnProperty(d)&&(l[d]=f[d])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var a={arraySet:function(l,c,f,d,p){if(c.subarray&&l.subarray)l.set(c.subarray(f,f+d),p);else for(var g=0;g<d;g++)l[p+g]=c[f+g]},flattenChunks:function(l){var c,f,d,p,g,w;for(c=d=0,f=l.length;c<f;c++)d+=l[c].length;for(w=new Uint8Array(d),c=p=0,f=l.length;c<f;c++)g=l[c],w.set(g,p),p+=g.length;return w}},s={arraySet:function(l,c,f,d,p){for(var g=0;g<d;g++)l[p+g]=c[f+g]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,s))},i.setTyped(o)},{}],42:[function(e,r,i){var o=e("./common"),a=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var l=new o.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function f(d,p){if(p<65537&&(d.subarray&&s||!d.subarray&&a))return String.fromCharCode.apply(null,o.shrinkBuf(d,p));for(var g="",w=0;w<p;w++)g+=String.fromCharCode(d[w]);return g}l[254]=l[254]=1,i.string2buf=function(d){var p,g,w,h,_,v=d.length,k=0;for(h=0;h<v;h++)(64512&(g=d.charCodeAt(h)))==55296&&h+1<v&&(64512&(w=d.charCodeAt(h+1)))==56320&&(g=65536+(g-55296<<10)+(w-56320),h++),k+=g<128?1:g<2048?2:g<65536?3:4;for(p=new o.Buf8(k),h=_=0;_<k;h++)(64512&(g=d.charCodeAt(h)))==55296&&h+1<v&&(64512&(w=d.charCodeAt(h+1)))==56320&&(g=65536+(g-55296<<10)+(w-56320),h++),g<128?p[_++]=g:(g<2048?p[_++]=192|g>>>6:(g<65536?p[_++]=224|g>>>12:(p[_++]=240|g>>>18,p[_++]=128|g>>>12&63),p[_++]=128|g>>>6&63),p[_++]=128|63&g);return p},i.buf2binstring=function(d){return f(d,d.length)},i.binstring2buf=function(d){for(var p=new o.Buf8(d.length),g=0,w=p.length;g<w;g++)p[g]=d.charCodeAt(g);return p},i.buf2string=function(d,p){var g,w,h,_,v=p||d.length,k=new Array(2*v);for(g=w=0;g<v;)if((h=d[g++])<128)k[w++]=h;else if(4<(_=l[h]))k[w++]=65533,g+=_-1;else{for(h&=_===2?31:_===3?15:7;1<_&&g<v;)h=h<<6|63&d[g++],_--;1<_?k[w++]=65533:h<65536?k[w++]=h:(h-=65536,k[w++]=55296|h>>10&1023,k[w++]=56320|1023&h)}return f(k,w)},i.utf8border=function(d,p){var g;for((p=p||d.length)>d.length&&(p=d.length),g=p-1;0<=g&&(192&d[g])==128;)g--;return g<0||g===0?p:g+l[d[g]]>p?g:p}},{"./common":41}],43:[function(e,r,i){r.exports=function(o,a,s,l){for(var c=65535&o|0,f=o>>>16&65535|0,d=0;s!==0;){for(s-=d=2e3<s?2e3:s;f=f+(c=c+a[l++]|0)|0,--d;);c%=65521,f%=65521}return c|f<<16|0}},{}],44:[function(e,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,i){var o=(function(){for(var a,s=[],l=0;l<256;l++){a=l;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;s[l]=a}return s})();r.exports=function(a,s,l,c){var f=o,d=c+l;a^=-1;for(var p=c;p<d;p++)a=a>>>8^f[255&(a^s[p])];return-1^a}},{}],46:[function(e,r,i){var o,a=e("../utils/common"),s=e("./trees"),l=e("./adler32"),c=e("./crc32"),f=e("./messages"),d=0,p=4,g=0,w=-2,h=-1,_=4,v=2,k=8,x=9,$=286,O=30,z=19,I=2*$+1,M=15,T=3,X=258,G=X+T+1,b=42,C=113,u=1,A=2,H=3,P=4;function Y(m,W){return m.msg=f[W],W}function j(m){return(m<<1)-(4<m?9:0)}function V(m){for(var W=m.length;0<=--W;)m[W]=0}function B(m){var W=m.state,F=W.pending;F>m.avail_out&&(F=m.avail_out),F!==0&&(a.arraySet(m.output,W.pending_buf,W.pending_out,F,m.next_out),m.next_out+=F,W.pending_out+=F,m.total_out+=F,m.avail_out-=F,W.pending-=F,W.pending===0&&(W.pending_out=0))}function L(m,W){s._tr_flush_block(m,0<=m.block_start?m.block_start:-1,m.strstart-m.block_start,W),m.block_start=m.strstart,B(m.strm)}function et(m,W){m.pending_buf[m.pending++]=W}function Q(m,W){m.pending_buf[m.pending++]=W>>>8&255,m.pending_buf[m.pending++]=255&W}function Z(m,W){var F,E,S=m.max_chain_length,R=m.strstart,N=m.prev_length,D=m.nice_match,U=m.strstart>m.w_size-G?m.strstart-(m.w_size-G):0,q=m.window,nt=m.w_mask,J=m.prev,st=m.strstart+X,gt=q[R+N-1],ft=q[R+N];m.prev_length>=m.good_match&&(S>>=2),D>m.lookahead&&(D=m.lookahead);do if(q[(F=W)+N]===ft&&q[F+N-1]===gt&&q[F]===q[R]&&q[++F]===q[R+1]){R+=2,F++;do;while(q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&q[++R]===q[++F]&&R<st);if(E=X-(st-R),R=st-X,N<E){if(m.match_start=W,D<=(N=E))break;gt=q[R+N-1],ft=q[R+N]}}while((W=J[W&nt])>U&&--S!=0);return N<=m.lookahead?N:m.lookahead}function pt(m){var W,F,E,S,R,N,D,U,q,nt,J=m.w_size;do{if(S=m.window_size-m.lookahead-m.strstart,m.strstart>=J+(J-G)){for(a.arraySet(m.window,m.window,J,J,0),m.match_start-=J,m.strstart-=J,m.block_start-=J,W=F=m.hash_size;E=m.head[--W],m.head[W]=J<=E?E-J:0,--F;);for(W=F=J;E=m.prev[--W],m.prev[W]=J<=E?E-J:0,--F;);S+=J}if(m.strm.avail_in===0)break;if(N=m.strm,D=m.window,U=m.strstart+m.lookahead,q=S,nt=void 0,nt=N.avail_in,q<nt&&(nt=q),F=nt===0?0:(N.avail_in-=nt,a.arraySet(D,N.input,N.next_in,nt,U),N.state.wrap===1?N.adler=l(N.adler,D,nt,U):N.state.wrap===2&&(N.adler=c(N.adler,D,nt,U)),N.next_in+=nt,N.total_in+=nt,nt),m.lookahead+=F,m.lookahead+m.insert>=T)for(R=m.strstart-m.insert,m.ins_h=m.window[R],m.ins_h=(m.ins_h<<m.hash_shift^m.window[R+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[R+T-1])&m.hash_mask,m.prev[R&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=R,R++,m.insert--,!(m.lookahead+m.insert<T)););}while(m.lookahead<G&&m.strm.avail_in!==0)}function yt(m,W){for(var F,E;;){if(m.lookahead<G){if(pt(m),m.lookahead<G&&W===d)return u;if(m.lookahead===0)break}if(F=0,m.lookahead>=T&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+T-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),F!==0&&m.strstart-F<=m.w_size-G&&(m.match_length=Z(m,F)),m.match_length>=T)if(E=s._tr_tally(m,m.strstart-m.match_start,m.match_length-T),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=T){for(m.match_length--;m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+T-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart,--m.match_length!=0;);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else E=s._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(E&&(L(m,!1),m.strm.avail_out===0))return u}return m.insert=m.strstart<T-1?m.strstart:T-1,W===p?(L(m,!0),m.strm.avail_out===0?H:P):m.last_lit&&(L(m,!1),m.strm.avail_out===0)?u:A}function K(m,W){for(var F,E,S;;){if(m.lookahead<G){if(pt(m),m.lookahead<G&&W===d)return u;if(m.lookahead===0)break}if(F=0,m.lookahead>=T&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+T-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=T-1,F!==0&&m.prev_length<m.max_lazy_match&&m.strstart-F<=m.w_size-G&&(m.match_length=Z(m,F),m.match_length<=5&&(m.strategy===1||m.match_length===T&&4096<m.strstart-m.match_start)&&(m.match_length=T-1)),m.prev_length>=T&&m.match_length<=m.prev_length){for(S=m.strstart+m.lookahead-T,E=s._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-T),m.lookahead-=m.prev_length-1,m.prev_length-=2;++m.strstart<=S&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+T-1])&m.hash_mask,F=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),--m.prev_length!=0;);if(m.match_available=0,m.match_length=T-1,m.strstart++,E&&(L(m,!1),m.strm.avail_out===0))return u}else if(m.match_available){if((E=s._tr_tally(m,0,m.window[m.strstart-1]))&&L(m,!1),m.strstart++,m.lookahead--,m.strm.avail_out===0)return u}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(E=s._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<T-1?m.strstart:T-1,W===p?(L(m,!0),m.strm.avail_out===0?H:P):m.last_lit&&(L(m,!1),m.strm.avail_out===0)?u:A}function ct(m,W,F,E,S){this.good_length=m,this.max_lazy=W,this.nice_length=F,this.max_chain=E,this.func=S}function at(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*I),this.dyn_dtree=new a.Buf16(2*(2*O+1)),this.bl_tree=new a.Buf16(2*(2*z+1)),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(M+1),this.heap=new a.Buf16(2*$+1),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*$+1),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ut(m){var W;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=v,(W=m.state).pending=0,W.pending_out=0,W.wrap<0&&(W.wrap=-W.wrap),W.status=W.wrap?b:C,m.adler=W.wrap===2?0:1,W.last_flush=d,s._tr_init(W),g):Y(m,w)}function wt(m){var W=ut(m);return W===g&&(function(F){F.window_size=2*F.w_size,V(F.head),F.max_lazy_match=o[F.level].max_lazy,F.good_match=o[F.level].good_length,F.nice_match=o[F.level].nice_length,F.max_chain_length=o[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=T-1,F.match_available=0,F.ins_h=0})(m.state),W}function St(m,W,F,E,S,R){if(!m)return w;var N=1;if(W===h&&(W=6),E<0?(N=0,E=-E):15<E&&(N=2,E-=16),S<1||x<S||F!==k||E<8||15<E||W<0||9<W||R<0||_<R)return Y(m,w);E===8&&(E=9);var D=new at;return(m.state=D).strm=m,D.wrap=N,D.gzhead=null,D.w_bits=E,D.w_size=1<<D.w_bits,D.w_mask=D.w_size-1,D.hash_bits=S+7,D.hash_size=1<<D.hash_bits,D.hash_mask=D.hash_size-1,D.hash_shift=~~((D.hash_bits+T-1)/T),D.window=new a.Buf8(2*D.w_size),D.head=new a.Buf16(D.hash_size),D.prev=new a.Buf16(D.w_size),D.lit_bufsize=1<<S+6,D.pending_buf_size=4*D.lit_bufsize,D.pending_buf=new a.Buf8(D.pending_buf_size),D.d_buf=1*D.lit_bufsize,D.l_buf=3*D.lit_bufsize,D.level=W,D.strategy=R,D.method=F,wt(m)}o=[new ct(0,0,0,0,function(m,W){var F=65535;for(F>m.pending_buf_size-5&&(F=m.pending_buf_size-5);;){if(m.lookahead<=1){if(pt(m),m.lookahead===0&&W===d)return u;if(m.lookahead===0)break}m.strstart+=m.lookahead,m.lookahead=0;var E=m.block_start+F;if((m.strstart===0||m.strstart>=E)&&(m.lookahead=m.strstart-E,m.strstart=E,L(m,!1),m.strm.avail_out===0)||m.strstart-m.block_start>=m.w_size-G&&(L(m,!1),m.strm.avail_out===0))return u}return m.insert=0,W===p?(L(m,!0),m.strm.avail_out===0?H:P):(m.strstart>m.block_start&&(L(m,!1),m.strm.avail_out),u)}),new ct(4,4,8,4,yt),new ct(4,5,16,8,yt),new ct(4,6,32,32,yt),new ct(4,4,16,16,K),new ct(8,16,32,32,K),new ct(8,16,128,128,K),new ct(8,32,128,256,K),new ct(32,128,258,1024,K),new ct(32,258,258,4096,K)],i.deflateInit=function(m,W){return St(m,W,k,15,8,0)},i.deflateInit2=St,i.deflateReset=wt,i.deflateResetKeep=ut,i.deflateSetHeader=function(m,W){return m&&m.state?m.state.wrap!==2?w:(m.state.gzhead=W,g):w},i.deflate=function(m,W){var F,E,S,R;if(!m||!m.state||5<W||W<0)return m?Y(m,w):w;if(E=m.state,!m.output||!m.input&&m.avail_in!==0||E.status===666&&W!==p)return Y(m,m.avail_out===0?-5:w);if(E.strm=m,F=E.last_flush,E.last_flush=W,E.status===b)if(E.wrap===2)m.adler=0,et(E,31),et(E,139),et(E,8),E.gzhead?(et(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),et(E,255&E.gzhead.time),et(E,E.gzhead.time>>8&255),et(E,E.gzhead.time>>16&255),et(E,E.gzhead.time>>24&255),et(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),et(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(et(E,255&E.gzhead.extra.length),et(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(m.adler=c(m.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(et(E,0),et(E,0),et(E,0),et(E,0),et(E,0),et(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),et(E,3),E.status=C);else{var N=k+(E.w_bits-8<<4)<<8;N|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(N|=32),N+=31-N%31,E.status=C,Q(E,N),E.strstart!==0&&(Q(E,m.adler>>>16),Q(E,65535&m.adler)),m.adler=1}if(E.status===69)if(E.gzhead.extra){for(S=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),B(m),S=E.pending,E.pending!==E.pending_buf_size));)et(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),B(m),S=E.pending,E.pending===E.pending_buf_size)){R=1;break}R=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,et(E,R)}while(R!==0);E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),R===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){S=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),B(m),S=E.pending,E.pending===E.pending_buf_size)){R=1;break}R=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,et(E,R)}while(R!==0);E.gzhead.hcrc&&E.pending>S&&(m.adler=c(m.adler,E.pending_buf,E.pending-S,S)),R===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&B(m),E.pending+2<=E.pending_buf_size&&(et(E,255&m.adler),et(E,m.adler>>8&255),m.adler=0,E.status=C)):E.status=C),E.pending!==0){if(B(m),m.avail_out===0)return E.last_flush=-1,g}else if(m.avail_in===0&&j(W)<=j(F)&&W!==p)return Y(m,-5);if(E.status===666&&m.avail_in!==0)return Y(m,-5);if(m.avail_in!==0||E.lookahead!==0||W!==d&&E.status!==666){var D=E.strategy===2?(function(U,q){for(var nt;;){if(U.lookahead===0&&(pt(U),U.lookahead===0)){if(q===d)return u;break}if(U.match_length=0,nt=s._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,nt&&(L(U,!1),U.strm.avail_out===0))return u}return U.insert=0,q===p?(L(U,!0),U.strm.avail_out===0?H:P):U.last_lit&&(L(U,!1),U.strm.avail_out===0)?u:A})(E,W):E.strategy===3?(function(U,q){for(var nt,J,st,gt,ft=U.window;;){if(U.lookahead<=X){if(pt(U),U.lookahead<=X&&q===d)return u;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=T&&0<U.strstart&&(J=ft[st=U.strstart-1])===ft[++st]&&J===ft[++st]&&J===ft[++st]){gt=U.strstart+X;do;while(J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&J===ft[++st]&&st<gt);U.match_length=X-(gt-st),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=T?(nt=s._tr_tally(U,1,U.match_length-T),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(nt=s._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),nt&&(L(U,!1),U.strm.avail_out===0))return u}return U.insert=0,q===p?(L(U,!0),U.strm.avail_out===0?H:P):U.last_lit&&(L(U,!1),U.strm.avail_out===0)?u:A})(E,W):o[E.level].func(E,W);if(D!==H&&D!==P||(E.status=666),D===u||D===H)return m.avail_out===0&&(E.last_flush=-1),g;if(D===A&&(W===1?s._tr_align(E):W!==5&&(s._tr_stored_block(E,0,0,!1),W===3&&(V(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),B(m),m.avail_out===0))return E.last_flush=-1,g}return W!==p?g:E.wrap<=0?1:(E.wrap===2?(et(E,255&m.adler),et(E,m.adler>>8&255),et(E,m.adler>>16&255),et(E,m.adler>>24&255),et(E,255&m.total_in),et(E,m.total_in>>8&255),et(E,m.total_in>>16&255),et(E,m.total_in>>24&255)):(Q(E,m.adler>>>16),Q(E,65535&m.adler)),B(m),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?g:1)},i.deflateEnd=function(m){var W;return m&&m.state?(W=m.state.status)!==b&&W!==69&&W!==73&&W!==91&&W!==103&&W!==C&&W!==666?Y(m,w):(m.state=null,W===C?Y(m,-3):g):w},i.deflateSetDictionary=function(m,W){var F,E,S,R,N,D,U,q,nt=W.length;if(!m||!m.state||(R=(F=m.state).wrap)===2||R===1&&F.status!==b||F.lookahead)return w;for(R===1&&(m.adler=l(m.adler,W,nt,0)),F.wrap=0,nt>=F.w_size&&(R===0&&(V(F.head),F.strstart=0,F.block_start=0,F.insert=0),q=new a.Buf8(F.w_size),a.arraySet(q,W,nt-F.w_size,F.w_size,0),W=q,nt=F.w_size),N=m.avail_in,D=m.next_in,U=m.input,m.avail_in=nt,m.next_in=0,m.input=W,pt(F);F.lookahead>=T;){for(E=F.strstart,S=F.lookahead-(T-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[E+T-1])&F.hash_mask,F.prev[E&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=E,E++,--S;);F.strstart=E,F.lookahead=T-1,pt(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=T-1,F.match_available=0,m.next_in=D,m.input=U,m.avail_in=N,F.wrap=R,g},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,i){r.exports=function(o,a){var s,l,c,f,d,p,g,w,h,_,v,k,x,$,O,z,I,M,T,X,G,b,C,u,A;s=o.state,l=o.next_in,u=o.input,c=l+(o.avail_in-5),f=o.next_out,A=o.output,d=f-(a-o.avail_out),p=f+(o.avail_out-257),g=s.dmax,w=s.wsize,h=s.whave,_=s.wnext,v=s.window,k=s.hold,x=s.bits,$=s.lencode,O=s.distcode,z=(1<<s.lenbits)-1,I=(1<<s.distbits)-1;t:do{x<15&&(k+=u[l++]<<x,x+=8,k+=u[l++]<<x,x+=8),M=$[k&z];e:for(;;){if(k>>>=T=M>>>24,x-=T,(T=M>>>16&255)===0)A[f++]=65535&M;else{if(!(16&T)){if((64&T)==0){M=$[(65535&M)+(k&(1<<T)-1)];continue e}if(32&T){s.mode=12;break t}o.msg="invalid literal/length code",s.mode=30;break t}X=65535&M,(T&=15)&&(x<T&&(k+=u[l++]<<x,x+=8),X+=k&(1<<T)-1,k>>>=T,x-=T),x<15&&(k+=u[l++]<<x,x+=8,k+=u[l++]<<x,x+=8),M=O[k&I];n:for(;;){if(k>>>=T=M>>>24,x-=T,!(16&(T=M>>>16&255))){if((64&T)==0){M=O[(65535&M)+(k&(1<<T)-1)];continue n}o.msg="invalid distance code",s.mode=30;break t}if(G=65535&M,x<(T&=15)&&(k+=u[l++]<<x,(x+=8)<T&&(k+=u[l++]<<x,x+=8)),g<(G+=k&(1<<T)-1)){o.msg="invalid distance too far back",s.mode=30;break t}if(k>>>=T,x-=T,(T=f-d)<G){if(h<(T=G-T)&&s.sane){o.msg="invalid distance too far back",s.mode=30;break t}if(C=v,(b=0)===_){if(b+=w-T,T<X){for(X-=T;A[f++]=v[b++],--T;);b=f-G,C=A}}else if(_<T){if(b+=w+_-T,(T-=_)<X){for(X-=T;A[f++]=v[b++],--T;);if(b=0,_<X){for(X-=T=_;A[f++]=v[b++],--T;);b=f-G,C=A}}}else if(b+=_-T,T<X){for(X-=T;A[f++]=v[b++],--T;);b=f-G,C=A}for(;2<X;)A[f++]=C[b++],A[f++]=C[b++],A[f++]=C[b++],X-=3;X&&(A[f++]=C[b++],1<X&&(A[f++]=C[b++]))}else{for(b=f-G;A[f++]=A[b++],A[f++]=A[b++],A[f++]=A[b++],2<(X-=3););X&&(A[f++]=A[b++],1<X&&(A[f++]=A[b++]))}break}}break}}while(l<c&&f<p);l-=X=x>>3,k&=(1<<(x-=X<<3))-1,o.next_in=l,o.next_out=f,o.avail_in=l<c?c-l+5:5-(l-c),o.avail_out=f<p?p-f+257:257-(f-p),s.hold=k,s.bits=x}},{}],49:[function(e,r,i){var o=e("../utils/common"),a=e("./adler32"),s=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),f=1,d=2,p=0,g=-2,w=1,h=852,_=592;function v(b){return(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(b){var C;return b&&b.state?(C=b.state,b.total_in=b.total_out=C.total=0,b.msg="",C.wrap&&(b.adler=1&C.wrap),C.mode=w,C.last=0,C.havedict=0,C.dmax=32768,C.head=null,C.hold=0,C.bits=0,C.lencode=C.lendyn=new o.Buf32(h),C.distcode=C.distdyn=new o.Buf32(_),C.sane=1,C.back=-1,p):g}function $(b){var C;return b&&b.state?((C=b.state).wsize=0,C.whave=0,C.wnext=0,x(b)):g}function O(b,C){var u,A;return b&&b.state?(A=b.state,C<0?(u=0,C=-C):(u=1+(C>>4),C<48&&(C&=15)),C&&(C<8||15<C)?g:(A.window!==null&&A.wbits!==C&&(A.window=null),A.wrap=u,A.wbits=C,$(b))):g}function z(b,C){var u,A;return b?(A=new k,(b.state=A).window=null,(u=O(b,C))!==p&&(b.state=null),u):g}var I,M,T=!0;function X(b){if(T){var C;for(I=new o.Buf32(512),M=new o.Buf32(32),C=0;C<144;)b.lens[C++]=8;for(;C<256;)b.lens[C++]=9;for(;C<280;)b.lens[C++]=7;for(;C<288;)b.lens[C++]=8;for(c(f,b.lens,0,288,I,0,b.work,{bits:9}),C=0;C<32;)b.lens[C++]=5;c(d,b.lens,0,32,M,0,b.work,{bits:5}),T=!1}b.lencode=I,b.lenbits=9,b.distcode=M,b.distbits=5}function G(b,C,u,A){var H,P=b.state;return P.window===null&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new o.Buf8(P.wsize)),A>=P.wsize?(o.arraySet(P.window,C,u-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):(A<(H=P.wsize-P.wnext)&&(H=A),o.arraySet(P.window,C,u-A,H,P.wnext),(A-=H)?(o.arraySet(P.window,C,u-A,A,0),P.wnext=A,P.whave=P.wsize):(P.wnext+=H,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=H))),0}i.inflateReset=$,i.inflateReset2=O,i.inflateResetKeep=x,i.inflateInit=function(b){return z(b,15)},i.inflateInit2=z,i.inflate=function(b,C){var u,A,H,P,Y,j,V,B,L,et,Q,Z,pt,yt,K,ct,at,ut,wt,St,m,W,F,E,S=0,R=new o.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&b.avail_in!==0)return g;(u=b.state).mode===12&&(u.mode=13),Y=b.next_out,H=b.output,V=b.avail_out,P=b.next_in,A=b.input,j=b.avail_in,B=u.hold,L=u.bits,et=j,Q=V,W=p;t:for(;;)switch(u.mode){case w:if(u.wrap===0){u.mode=13;break}for(;L<16;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(2&u.wrap&&B===35615){R[u.check=0]=255&B,R[1]=B>>>8&255,u.check=s(u.check,R,2,0),L=B=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&B)<<8)+(B>>8))%31){b.msg="incorrect header check",u.mode=30;break}if((15&B)!=8){b.msg="unknown compression method",u.mode=30;break}if(L-=4,m=8+(15&(B>>>=4)),u.wbits===0)u.wbits=m;else if(m>u.wbits){b.msg="invalid window size",u.mode=30;break}u.dmax=1<<m,b.adler=u.check=1,u.mode=512&B?10:12,L=B=0;break;case 2:for(;L<16;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(u.flags=B,(255&u.flags)!=8){b.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){b.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=B>>8&1),512&u.flags&&(R[0]=255&B,R[1]=B>>>8&255,u.check=s(u.check,R,2,0)),L=B=0,u.mode=3;case 3:for(;L<32;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.head&&(u.head.time=B),512&u.flags&&(R[0]=255&B,R[1]=B>>>8&255,R[2]=B>>>16&255,R[3]=B>>>24&255,u.check=s(u.check,R,4,0)),L=B=0,u.mode=4;case 4:for(;L<16;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.head&&(u.head.xflags=255&B,u.head.os=B>>8),512&u.flags&&(R[0]=255&B,R[1]=B>>>8&255,u.check=s(u.check,R,2,0)),L=B=0,u.mode=5;case 5:if(1024&u.flags){for(;L<16;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.length=B,u.head&&(u.head.extra_len=B),512&u.flags&&(R[0]=255&B,R[1]=B>>>8&255,u.check=s(u.check,R,2,0)),L=B=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(j<(Z=u.length)&&(Z=j),Z&&(u.head&&(m=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),o.arraySet(u.head.extra,A,P,Z,m)),512&u.flags&&(u.check=s(u.check,A,Z,P)),j-=Z,P+=Z,u.length-=Z),u.length))break t;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(j===0)break t;for(Z=0;m=A[P+Z++],u.head&&m&&u.length<65536&&(u.head.name+=String.fromCharCode(m)),m&&Z<j;);if(512&u.flags&&(u.check=s(u.check,A,Z,P)),j-=Z,P+=Z,m)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(j===0)break t;for(Z=0;m=A[P+Z++],u.head&&m&&u.length<65536&&(u.head.comment+=String.fromCharCode(m)),m&&Z<j;);if(512&u.flags&&(u.check=s(u.check,A,Z,P)),j-=Z,P+=Z,m)break t}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;L<16;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(B!==(65535&u.check)){b.msg="header crc mismatch",u.mode=30;break}L=B=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),b.adler=u.check=0,u.mode=12;break;case 10:for(;L<32;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}b.adler=u.check=v(B),L=B=0,u.mode=11;case 11:if(u.havedict===0)return b.next_out=Y,b.avail_out=V,b.next_in=P,b.avail_in=j,u.hold=B,u.bits=L,2;b.adler=u.check=1,u.mode=12;case 12:if(C===5||C===6)break t;case 13:if(u.last){B>>>=7&L,L-=7&L,u.mode=27;break}for(;L<3;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}switch(u.last=1&B,L-=1,3&(B>>>=1)){case 0:u.mode=14;break;case 1:if(X(u),u.mode=20,C!==6)break;B>>>=2,L-=2;break t;case 2:u.mode=17;break;case 3:b.msg="invalid block type",u.mode=30}B>>>=2,L-=2;break;case 14:for(B>>>=7&L,L-=7&L;L<32;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if((65535&B)!=(B>>>16^65535)){b.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&B,L=B=0,u.mode=15,C===6)break t;case 15:u.mode=16;case 16:if(Z=u.length){if(j<Z&&(Z=j),V<Z&&(Z=V),Z===0)break t;o.arraySet(H,A,P,Z,Y),j-=Z,P+=Z,V-=Z,Y+=Z,u.length-=Z;break}u.mode=12;break;case 17:for(;L<14;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(u.nlen=257+(31&B),B>>>=5,L-=5,u.ndist=1+(31&B),B>>>=5,L-=5,u.ncode=4+(15&B),B>>>=4,L-=4,286<u.nlen||30<u.ndist){b.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;L<3;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.lens[N[u.have++]]=7&B,B>>>=3,L-=3}for(;u.have<19;)u.lens[N[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,F={bits:u.lenbits},W=c(0,u.lens,0,19,u.lencode,0,u.work,F),u.lenbits=F.bits,W){b.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;ct=(S=u.lencode[B&(1<<u.lenbits)-1])>>>16&255,at=65535&S,!((K=S>>>24)<=L);){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(at<16)B>>>=K,L-=K,u.lens[u.have++]=at;else{if(at===16){for(E=K+2;L<E;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(B>>>=K,L-=K,u.have===0){b.msg="invalid bit length repeat",u.mode=30;break}m=u.lens[u.have-1],Z=3+(3&B),B>>>=2,L-=2}else if(at===17){for(E=K+3;L<E;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}L-=K,m=0,Z=3+(7&(B>>>=K)),B>>>=3,L-=3}else{for(E=K+7;L<E;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}L-=K,m=0,Z=11+(127&(B>>>=K)),B>>>=7,L-=7}if(u.have+Z>u.nlen+u.ndist){b.msg="invalid bit length repeat",u.mode=30;break}for(;Z--;)u.lens[u.have++]=m}}if(u.mode===30)break;if(u.lens[256]===0){b.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,F={bits:u.lenbits},W=c(f,u.lens,0,u.nlen,u.lencode,0,u.work,F),u.lenbits=F.bits,W){b.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,F={bits:u.distbits},W=c(d,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,F),u.distbits=F.bits,W){b.msg="invalid distances set",u.mode=30;break}if(u.mode=20,C===6)break t;case 20:u.mode=21;case 21:if(6<=j&&258<=V){b.next_out=Y,b.avail_out=V,b.next_in=P,b.avail_in=j,u.hold=B,u.bits=L,l(b,Q),Y=b.next_out,H=b.output,V=b.avail_out,P=b.next_in,A=b.input,j=b.avail_in,B=u.hold,L=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;ct=(S=u.lencode[B&(1<<u.lenbits)-1])>>>16&255,at=65535&S,!((K=S>>>24)<=L);){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(ct&&(240&ct)==0){for(ut=K,wt=ct,St=at;ct=(S=u.lencode[St+((B&(1<<ut+wt)-1)>>ut)])>>>16&255,at=65535&S,!(ut+(K=S>>>24)<=L);){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}B>>>=ut,L-=ut,u.back+=ut}if(B>>>=K,L-=K,u.back+=K,u.length=at,ct===0){u.mode=26;break}if(32&ct){u.back=-1,u.mode=12;break}if(64&ct){b.msg="invalid literal/length code",u.mode=30;break}u.extra=15&ct,u.mode=22;case 22:if(u.extra){for(E=u.extra;L<E;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.length+=B&(1<<u.extra)-1,B>>>=u.extra,L-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;ct=(S=u.distcode[B&(1<<u.distbits)-1])>>>16&255,at=65535&S,!((K=S>>>24)<=L);){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if((240&ct)==0){for(ut=K,wt=ct,St=at;ct=(S=u.distcode[St+((B&(1<<ut+wt)-1)>>ut)])>>>16&255,at=65535&S,!(ut+(K=S>>>24)<=L);){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}B>>>=ut,L-=ut,u.back+=ut}if(B>>>=K,L-=K,u.back+=K,64&ct){b.msg="invalid distance code",u.mode=30;break}u.offset=at,u.extra=15&ct,u.mode=24;case 24:if(u.extra){for(E=u.extra;L<E;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}u.offset+=B&(1<<u.extra)-1,B>>>=u.extra,L-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){b.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(V===0)break t;if(Z=Q-V,u.offset>Z){if((Z=u.offset-Z)>u.whave&&u.sane){b.msg="invalid distance too far back",u.mode=30;break}pt=Z>u.wnext?(Z-=u.wnext,u.wsize-Z):u.wnext-Z,Z>u.length&&(Z=u.length),yt=u.window}else yt=H,pt=Y-u.offset,Z=u.length;for(V<Z&&(Z=V),V-=Z,u.length-=Z;H[Y++]=yt[pt++],--Z;);u.length===0&&(u.mode=21);break;case 26:if(V===0)break t;H[Y++]=u.length,V--,u.mode=21;break;case 27:if(u.wrap){for(;L<32;){if(j===0)break t;j--,B|=A[P++]<<L,L+=8}if(Q-=V,b.total_out+=Q,u.total+=Q,Q&&(b.adler=u.check=u.flags?s(u.check,H,Q,Y-Q):a(u.check,H,Q,Y-Q)),Q=V,(u.flags?B:v(B))!==u.check){b.msg="incorrect data check",u.mode=30;break}L=B=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;L<32;){if(j===0)break t;j--,B+=A[P++]<<L,L+=8}if(B!==(4294967295&u.total)){b.msg="incorrect length check",u.mode=30;break}L=B=0}u.mode=29;case 29:W=1;break t;case 30:W=-3;break t;case 31:return-4;case 32:default:return g}return b.next_out=Y,b.avail_out=V,b.next_in=P,b.avail_in=j,u.hold=B,u.bits=L,(u.wsize||Q!==b.avail_out&&u.mode<30&&(u.mode<27||C!==4))&&G(b,b.output,b.next_out,Q-b.avail_out)?(u.mode=31,-4):(et-=b.avail_in,Q-=b.avail_out,b.total_in+=et,b.total_out+=Q,u.total+=Q,u.wrap&&Q&&(b.adler=u.check=u.flags?s(u.check,H,Q,b.next_out-Q):a(u.check,H,Q,b.next_out-Q)),b.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(et==0&&Q===0||C===4)&&W===p&&(W=-5),W)},i.inflateEnd=function(b){if(!b||!b.state)return g;var C=b.state;return C.window&&(C.window=null),b.state=null,p},i.inflateGetHeader=function(b,C){var u;return b&&b.state?(2&(u=b.state).wrap)==0?g:((u.head=C).done=!1,p):g},i.inflateSetDictionary=function(b,C){var u,A=C.length;return b&&b.state?(u=b.state).wrap!==0&&u.mode!==11?g:u.mode===11&&a(1,C,A,0)!==u.check?-3:G(b,C,A,A)?(u.mode=31,-4):(u.havedict=1,p):g},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,i){var o=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(f,d,p,g,w,h,_,v){var k,x,$,O,z,I,M,T,X,G=v.bits,b=0,C=0,u=0,A=0,H=0,P=0,Y=0,j=0,V=0,B=0,L=null,et=0,Q=new o.Buf16(16),Z=new o.Buf16(16),pt=null,yt=0;for(b=0;b<=15;b++)Q[b]=0;for(C=0;C<g;C++)Q[d[p+C]]++;for(H=G,A=15;1<=A&&Q[A]===0;A--);if(A<H&&(H=A),A===0)return w[h++]=20971520,w[h++]=20971520,v.bits=1,0;for(u=1;u<A&&Q[u]===0;u++);for(H<u&&(H=u),b=j=1;b<=15;b++)if(j<<=1,(j-=Q[b])<0)return-1;if(0<j&&(f===0||A!==1))return-1;for(Z[1]=0,b=1;b<15;b++)Z[b+1]=Z[b]+Q[b];for(C=0;C<g;C++)d[p+C]!==0&&(_[Z[d[p+C]]++]=C);if(I=f===0?(L=pt=_,19):f===1?(L=a,et-=257,pt=s,yt-=257,256):(L=l,pt=c,-1),b=u,z=h,Y=C=B=0,$=-1,O=(V=1<<(P=H))-1,f===1&&852<V||f===2&&592<V)return 1;for(;;){for(M=b-Y,X=_[C]<I?(T=0,_[C]):_[C]>I?(T=pt[yt+_[C]],L[et+_[C]]):(T=96,0),k=1<<b-Y,u=x=1<<P;w[z+(B>>Y)+(x-=k)]=M<<24|T<<16|X|0,x!==0;);for(k=1<<b-1;B&k;)k>>=1;if(k!==0?(B&=k-1,B+=k):B=0,C++,--Q[b]==0){if(b===A)break;b=d[p+_[C]]}if(H<b&&(B&O)!==$){for(Y===0&&(Y=H),z+=u,j=1<<(P=b-Y);P+Y<A&&!((j-=Q[P+Y])<=0);)P++,j<<=1;if(V+=1<<P,f===1&&852<V||f===2&&592<V)return 1;w[$=B&O]=H<<24|P<<16|z-h|0}}return B!==0&&(w[z+B]=b-Y<<24|64<<16|0),v.bits=H,0}},{"../utils/common":41}],51:[function(e,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,i){var o=e("../utils/common"),a=0,s=1;function l(S){for(var R=S.length;0<=--R;)S[R]=0}var c=0,f=29,d=256,p=d+1+f,g=30,w=19,h=2*p+1,_=15,v=16,k=7,x=256,$=16,O=17,z=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(p+2));l(G);var b=new Array(2*g);l(b);var C=new Array(512);l(C);var u=new Array(256);l(u);var A=new Array(f);l(A);var H,P,Y,j=new Array(g);function V(S,R,N,D,U){this.static_tree=S,this.extra_bits=R,this.extra_base=N,this.elems=D,this.max_length=U,this.has_stree=S&&S.length}function B(S,R){this.dyn_tree=S,this.max_code=0,this.stat_desc=R}function L(S){return S<256?C[S]:C[256+(S>>>7)]}function et(S,R){S.pending_buf[S.pending++]=255&R,S.pending_buf[S.pending++]=R>>>8&255}function Q(S,R,N){S.bi_valid>v-N?(S.bi_buf|=R<<S.bi_valid&65535,et(S,S.bi_buf),S.bi_buf=R>>v-S.bi_valid,S.bi_valid+=N-v):(S.bi_buf|=R<<S.bi_valid&65535,S.bi_valid+=N)}function Z(S,R,N){Q(S,N[2*R],N[2*R+1])}function pt(S,R){for(var N=0;N|=1&S,S>>>=1,N<<=1,0<--R;);return N>>>1}function yt(S,R,N){var D,U,q=new Array(_+1),nt=0;for(D=1;D<=_;D++)q[D]=nt=nt+N[D-1]<<1;for(U=0;U<=R;U++){var J=S[2*U+1];J!==0&&(S[2*U]=pt(q[J]++,J))}}function K(S){var R;for(R=0;R<p;R++)S.dyn_ltree[2*R]=0;for(R=0;R<g;R++)S.dyn_dtree[2*R]=0;for(R=0;R<w;R++)S.bl_tree[2*R]=0;S.dyn_ltree[2*x]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function ct(S){8<S.bi_valid?et(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function at(S,R,N,D){var U=2*R,q=2*N;return S[U]<S[q]||S[U]===S[q]&&D[R]<=D[N]}function ut(S,R,N){for(var D=S.heap[N],U=N<<1;U<=S.heap_len&&(U<S.heap_len&&at(R,S.heap[U+1],S.heap[U],S.depth)&&U++,!at(R,D,S.heap[U],S.depth));)S.heap[N]=S.heap[U],N=U,U<<=1;S.heap[N]=D}function wt(S,R,N){var D,U,q,nt,J=0;if(S.last_lit!==0)for(;D=S.pending_buf[S.d_buf+2*J]<<8|S.pending_buf[S.d_buf+2*J+1],U=S.pending_buf[S.l_buf+J],J++,D===0?Z(S,U,R):(Z(S,(q=u[U])+d+1,R),(nt=I[q])!==0&&Q(S,U-=A[q],nt),Z(S,q=L(--D),N),(nt=M[q])!==0&&Q(S,D-=j[q],nt)),J<S.last_lit;);Z(S,x,R)}function St(S,R){var N,D,U,q=R.dyn_tree,nt=R.stat_desc.static_tree,J=R.stat_desc.has_stree,st=R.stat_desc.elems,gt=-1;for(S.heap_len=0,S.heap_max=h,N=0;N<st;N++)q[2*N]!==0?(S.heap[++S.heap_len]=gt=N,S.depth[N]=0):q[2*N+1]=0;for(;S.heap_len<2;)q[2*(U=S.heap[++S.heap_len]=gt<2?++gt:0)]=1,S.depth[U]=0,S.opt_len--,J&&(S.static_len-=nt[2*U+1]);for(R.max_code=gt,N=S.heap_len>>1;1<=N;N--)ut(S,q,N);for(U=st;N=S.heap[1],S.heap[1]=S.heap[S.heap_len--],ut(S,q,1),D=S.heap[1],S.heap[--S.heap_max]=N,S.heap[--S.heap_max]=D,q[2*U]=q[2*N]+q[2*D],S.depth[U]=(S.depth[N]>=S.depth[D]?S.depth[N]:S.depth[D])+1,q[2*N+1]=q[2*D+1]=U,S.heap[1]=U++,ut(S,q,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],(function(ft,Ut){var ge,Xt,ye,_t,Ae,Ze,Wt=Ut.dyn_tree,On=Ut.max_code,ei=Ut.stat_desc.static_tree,ni=Ut.stat_desc.has_stree,ri=Ut.stat_desc.extra_bits,In=Ut.stat_desc.extra_base,ve=Ut.stat_desc.max_length,Ce=0;for(_t=0;_t<=_;_t++)ft.bl_count[_t]=0;for(Wt[2*ft.heap[ft.heap_max]+1]=0,ge=ft.heap_max+1;ge<h;ge++)ve<(_t=Wt[2*Wt[2*(Xt=ft.heap[ge])+1]+1]+1)&&(_t=ve,Ce++),Wt[2*Xt+1]=_t,On<Xt||(ft.bl_count[_t]++,Ae=0,In<=Xt&&(Ae=ri[Xt-In]),Ze=Wt[2*Xt],ft.opt_len+=Ze*(_t+Ae),ni&&(ft.static_len+=Ze*(ei[2*Xt+1]+Ae)));if(Ce!==0){do{for(_t=ve-1;ft.bl_count[_t]===0;)_t--;ft.bl_count[_t]--,ft.bl_count[_t+1]+=2,ft.bl_count[ve]--,Ce-=2}while(0<Ce);for(_t=ve;_t!==0;_t--)for(Xt=ft.bl_count[_t];Xt!==0;)On<(ye=ft.heap[--ge])||(Wt[2*ye+1]!==_t&&(ft.opt_len+=(_t-Wt[2*ye+1])*Wt[2*ye],Wt[2*ye+1]=_t),Xt--)}})(S,R),yt(q,gt,S.bl_count)}function m(S,R,N){var D,U,q=-1,nt=R[1],J=0,st=7,gt=4;for(nt===0&&(st=138,gt=3),R[2*(N+1)+1]=65535,D=0;D<=N;D++)U=nt,nt=R[2*(D+1)+1],++J<st&&U===nt||(J<gt?S.bl_tree[2*U]+=J:U!==0?(U!==q&&S.bl_tree[2*U]++,S.bl_tree[2*$]++):J<=10?S.bl_tree[2*O]++:S.bl_tree[2*z]++,q=U,gt=(J=0)===nt?(st=138,3):U===nt?(st=6,3):(st=7,4))}function W(S,R,N){var D,U,q=-1,nt=R[1],J=0,st=7,gt=4;for(nt===0&&(st=138,gt=3),D=0;D<=N;D++)if(U=nt,nt=R[2*(D+1)+1],!(++J<st&&U===nt)){if(J<gt)for(;Z(S,U,S.bl_tree),--J!=0;);else U!==0?(U!==q&&(Z(S,U,S.bl_tree),J--),Z(S,$,S.bl_tree),Q(S,J-3,2)):J<=10?(Z(S,O,S.bl_tree),Q(S,J-3,3)):(Z(S,z,S.bl_tree),Q(S,J-11,7));q=U,gt=(J=0)===nt?(st=138,3):U===nt?(st=6,3):(st=7,4)}}l(j);var F=!1;function E(S,R,N,D){Q(S,(c<<1)+(D?1:0),3),(function(U,q,nt,J){ct(U),et(U,nt),et(U,~nt),o.arraySet(U.pending_buf,U.window,q,nt,U.pending),U.pending+=nt})(S,R,N)}i._tr_init=function(S){F||((function(){var R,N,D,U,q,nt=new Array(_+1);for(U=D=0;U<f-1;U++)for(A[U]=D,R=0;R<1<<I[U];R++)u[D++]=U;for(u[D-1]=U,U=q=0;U<16;U++)for(j[U]=q,R=0;R<1<<M[U];R++)C[q++]=U;for(q>>=7;U<g;U++)for(j[U]=q<<7,R=0;R<1<<M[U]-7;R++)C[256+q++]=U;for(N=0;N<=_;N++)nt[N]=0;for(R=0;R<=143;)G[2*R+1]=8,R++,nt[8]++;for(;R<=255;)G[2*R+1]=9,R++,nt[9]++;for(;R<=279;)G[2*R+1]=7,R++,nt[7]++;for(;R<=287;)G[2*R+1]=8,R++,nt[8]++;for(yt(G,p+1,nt),R=0;R<g;R++)b[2*R+1]=5,b[2*R]=pt(R,5);H=new V(G,I,d+1,p,_),P=new V(b,M,0,g,_),Y=new V(new Array(0),T,0,w,k)})(),F=!0),S.l_desc=new B(S.dyn_ltree,H),S.d_desc=new B(S.dyn_dtree,P),S.bl_desc=new B(S.bl_tree,Y),S.bi_buf=0,S.bi_valid=0,K(S)},i._tr_stored_block=E,i._tr_flush_block=function(S,R,N,D){var U,q,nt=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=(function(J){var st,gt=4093624447;for(st=0;st<=31;st++,gt>>>=1)if(1&gt&&J.dyn_ltree[2*st]!==0)return a;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return s;for(st=32;st<d;st++)if(J.dyn_ltree[2*st]!==0)return s;return a})(S)),St(S,S.l_desc),St(S,S.d_desc),nt=(function(J){var st;for(m(J,J.dyn_ltree,J.l_desc.max_code),m(J,J.dyn_dtree,J.d_desc.max_code),St(J,J.bl_desc),st=w-1;3<=st&&J.bl_tree[2*X[st]+1]===0;st--);return J.opt_len+=3*(st+1)+5+5+4,st})(S),U=S.opt_len+3+7>>>3,(q=S.static_len+3+7>>>3)<=U&&(U=q)):U=q=N+5,N+4<=U&&R!==-1?E(S,R,N,D):S.strategy===4||q===U?(Q(S,2+(D?1:0),3),wt(S,G,b)):(Q(S,4+(D?1:0),3),(function(J,st,gt,ft){var Ut;for(Q(J,st-257,5),Q(J,gt-1,5),Q(J,ft-4,4),Ut=0;Ut<ft;Ut++)Q(J,J.bl_tree[2*X[Ut]+1],3);W(J,J.dyn_ltree,st-1),W(J,J.dyn_dtree,gt-1)})(S,S.l_desc.max_code+1,S.d_desc.max_code+1,nt+1),wt(S,S.dyn_ltree,S.dyn_dtree)),K(S),D&&ct(S)},i._tr_tally=function(S,R,N){return S.pending_buf[S.d_buf+2*S.last_lit]=R>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&R,S.pending_buf[S.l_buf+S.last_lit]=255&N,S.last_lit++,R===0?S.dyn_ltree[2*N]++:(S.matches++,R--,S.dyn_ltree[2*(u[N]+d+1)]++,S.dyn_dtree[2*L(R)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){Q(S,2,3),Z(S,x,G),(function(R){R.bi_valid===16?(et(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):8<=R.bi_valid&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(S)}},{"../utils/common":41}],53:[function(e,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,i){(function(o){(function(a,s){if(!a.setImmediate){var l,c,f,d,p=1,g={},w=!1,h=a.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(a);_=_&&_.setTimeout?_:a,l={}.toString.call(a.process)==="[object process]"?function($){process.nextTick(function(){k($)})}:(function(){if(a.postMessage&&!a.importScripts){var $=!0,O=a.onmessage;return a.onmessage=function(){$=!1},a.postMessage("","*"),a.onmessage=O,$}})()?(d="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",x,!1):a.attachEvent("onmessage",x),function($){a.postMessage(d+$,"*")}):a.MessageChannel?((f=new MessageChannel).port1.onmessage=function($){k($.data)},function($){f.port2.postMessage($)}):h&&"onreadystatechange"in h.createElement("script")?(c=h.documentElement,function($){var O=h.createElement("script");O.onreadystatechange=function(){k($),O.onreadystatechange=null,c.removeChild(O),O=null},c.appendChild(O)}):function($){setTimeout(k,0,$)},_.setImmediate=function($){typeof $!="function"&&($=new Function(""+$));for(var O=new Array(arguments.length-1),z=0;z<O.length;z++)O[z]=arguments[z+1];var I={callback:$,args:O};return g[p]=I,l(p),p++},_.clearImmediate=v}function v($){delete g[$]}function k($){if(w)setTimeout(k,0,$);else{var O=g[$];if(O){w=!0;try{(function(z){var I=z.callback,M=z.args;switch(M.length){case 0:I();break;case 1:I(M[0]);break;case 2:I(M[0],M[1]);break;case 3:I(M[0],M[1],M[2]);break;default:I.apply(s,M)}})(O)}finally{v($),w=!1}}}}function x($){$.source===a&&typeof $.data=="string"&&$.data.indexOf(d)===0&&k(+$.data.slice(d.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof ze<"u"?ze:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(fn)),fn.exports}var oa=ia();const sa=ra(oa),aa="modulepreload",la=function(t){return"/"+t},Er={},Zr=function(n,e,r){let i=Promise.resolve();if(e&&e.length>0){let l=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");i=l(e.map(c=>{if(c=la(c),c in Er)return;Er[c]=!0;const f=c.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const p=document.createElement("link");if(p.rel=f?"stylesheet":aa,f||(p.as="script"),p.crossOrigin="",p.href=c,s&&p.setAttribute("nonce",s),document.head.appendChild(p),f)return new Promise((g,w)=>{p.addEventListener("load",g),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return n().catch(o)})};/*! Capacitor: https://capacitorjs.com/ - MIT License */var pe;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(pe||(pe={}));class hn extends Error{constructor(n,e,r){super(n),this.message=n,this.code=e,this.data=r}}const ca=t=>{var n,e;return t?.androidBridge?"android":!((e=(n=t?.webkit)===null||n===void 0?void 0:n.messageHandlers)===null||e===void 0)&&e.bridge?"ios":"web"},da=t=>{const n=t.CapacitorCustomPlatform||null,e=t.Capacitor||{},r=e.Plugins=e.Plugins||{},i=()=>n!==null?n.name:ca(t),o=()=>i()!=="web",a=d=>{const p=c.get(d);return!!(p?.platforms.has(i())||s(d))},s=d=>{var p;return(p=e.PluginHeaders)===null||p===void 0?void 0:p.find(g=>g.name===d)},l=d=>t.console.error(d),c=new Map,f=(d,p={})=>{const g=c.get(d);if(g)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),g.proxy;const w=i(),h=s(d);let _;const v=async()=>(!_&&w in p?_=typeof p[w]=="function"?_=await p[w]():_=p[w]:n!==null&&!_&&"web"in p&&(_=typeof p.web=="function"?_=await p.web():_=p.web),_),k=(M,T)=>{var X,G;if(h){const b=h?.methods.find(C=>T===C.name);if(b)return b.rtype==="promise"?C=>e.nativePromise(d,T.toString(),C):(C,u)=>e.nativeCallback(d,T.toString(),C,u);if(M)return(X=M[T])===null||X===void 0?void 0:X.bind(M)}else{if(M)return(G=M[T])===null||G===void 0?void 0:G.bind(M);throw new hn(`"${d}" plugin is not implemented on ${w}`,pe.Unimplemented)}},x=M=>{let T;const X=(...G)=>{const b=v().then(C=>{const u=k(C,M);if(u){const A=u(...G);return T=A?.remove,A}else throw new hn(`"${d}.${M}()" is not implemented on ${w}`,pe.Unimplemented)});return M==="addListener"&&(b.remove=async()=>T()),b};return X.toString=()=>`${M.toString()}() { [capacitor code] }`,Object.defineProperty(X,"name",{value:M,writable:!1,configurable:!1}),X},$=x("addListener"),O=x("removeListener"),z=(M,T)=>{const X=$({eventName:M},T),G=async()=>{const C=await X;O({eventName:M,callbackId:C},T)},b=new Promise(C=>X.then(()=>C({remove:G})));return b.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await G()},b},I=new Proxy({},{get(M,T){switch(T){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return h?z:$;case"removeListener":return O;default:return x(T)}}});return r[d]=I,c.set(d,{name:d,proxy:I,platforms:new Set([...Object.keys(p),...h?[w]:[]])}),I};return e.convertFileSrc||(e.convertFileSrc=d=>d),e.getPlatform=i,e.handleError=l,e.isNativePlatform=o,e.isPluginAvailable=a,e.registerPlugin=f,e.Exception=hn,e.DEBUG=!!e.DEBUG,e.isLoggingEnabled=!!e.isLoggingEnabled,e},ua=t=>t.Capacitor=da(t),wn=ua(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),He=wn.registerPlugin;class Gr{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(n,e){let r=!1;this.listeners[n]||(this.listeners[n]=[],r=!0),this.listeners[n].push(e);const o=this.windowListeners[n];o&&!o.registered&&this.addWindowListener(o),r&&this.sendRetainedArgumentsForEvent(n);const a=async()=>this.removeListener(n,e);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const n in this.windowListeners)this.removeWindowListener(this.windowListeners[n]);this.windowListeners={}}notifyListeners(n,e,r){const i=this.listeners[n];if(!i){if(r){let o=this.retainedEventArguments[n];o||(o=[]),o.push(e),this.retainedEventArguments[n]=o}return}i.forEach(o=>o(e))}hasListeners(n){var e;return!!(!((e=this.listeners[n])===null||e===void 0)&&e.length)}registerWindowListener(n,e){this.windowListeners[e]={registered:!1,windowEventName:n,pluginEventName:e,handler:r=>{this.notifyListeners(e,r)}}}unimplemented(n="not implemented"){return new wn.Exception(n,pe.Unimplemented)}unavailable(n="not available"){return new wn.Exception(n,pe.Unavailable)}async removeListener(n,e){const r=this.listeners[n];if(!r)return;const i=r.indexOf(e);this.listeners[n].splice(i,1),this.listeners[n].length||this.removeWindowListener(this.windowListeners[n])}addWindowListener(n){window.addEventListener(n.windowEventName,n.handler),n.registered=!0}removeWindowListener(n){n&&(window.removeEventListener(n.windowEventName,n.handler),n.registered=!1)}sendRetainedArgumentsForEvent(n){const e=this.retainedEventArguments[n];e&&(delete this.retainedEventArguments[n],e.forEach(r=>{this.notifyListeners(n,r)}))}}const $r=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Sr=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class fa extends Gr{async getCookies(){const n=document.cookie,e={};return n.split(";").forEach(r=>{if(r.length<=0)return;let[i,o]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Sr(i).trim(),o=Sr(o).trim(),e[i]=o}),e}async setCookie(n){try{const e=$r(n.key),r=$r(n.value),i=`; expires=${(n.expires||"").replace("expires=","")}`,o=(n.path||"/").replace("path=",""),a=n.url!=null&&n.url.length>0?`domain=${n.url}`:"";document.cookie=`${e}=${r||""}${i}; path=${o}; ${a};`}catch(e){return Promise.reject(e)}}async deleteCookie(n){try{document.cookie=`${n.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const n=document.cookie.split(";")||[];for(const e of n)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(n){return Promise.reject(n)}}async clearAllCookies(){try{await this.clearCookies()}catch(n){return Promise.reject(n)}}}He("CapacitorCookies",{web:()=>new fa});const ha=async t=>new Promise((n,e)=>{const r=new FileReader;r.onload=()=>{const i=r.result;n(i.indexOf(",")>=0?i.split(",")[1]:i)},r.onerror=i=>e(i),r.readAsDataURL(t)}),pa=(t={})=>{const n=Object.keys(t);return Object.keys(t).map(i=>i.toLocaleLowerCase()).reduce((i,o,a)=>(i[o]=t[n[a]],i),{})},ma=(t,n=!0)=>t?Object.entries(t).reduce((r,i)=>{const[o,a]=i;let s,l;return Array.isArray(a)?(l="",a.forEach(c=>{s=n?encodeURIComponent(c):c,l+=`${o}=${s}&`}),l.slice(0,-1)):(s=n?encodeURIComponent(a):a,l=`${o}=${s}`),`${r}&${l}`},"").substr(1):null,ga=(t,n={})=>{const e=Object.assign({method:t.method||"GET",headers:t.headers},n),i=pa(t.headers)["content-type"]||"";if(typeof t.data=="string")e.body=t.data;else if(i.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[a,s]of Object.entries(t.data||{}))o.set(a,s);e.body=o.toString()}else if(i.includes("multipart/form-data")||t.data instanceof FormData){const o=new FormData;if(t.data instanceof FormData)t.data.forEach((s,l)=>{o.append(l,s)});else for(const s of Object.keys(t.data))o.append(s,t.data[s]);e.body=o;const a=new Headers(e.headers);a.delete("content-type"),e.headers=a}else(i.includes("application/json")||typeof t.data=="object")&&(e.body=JSON.stringify(t.data));return e};class ya extends Gr{async request(n){const e=ga(n,n.webFetchExtra),r=ma(n.params,n.shouldEncodeUrlParams),i=r?`${n.url}?${r}`:n.url,o=await fetch(i,e),a=o.headers.get("content-type")||"";let{responseType:s="text"}=o.ok?n:{};a.includes("application/json")&&(s="json");let l,c;switch(s){case"arraybuffer":case"blob":c=await o.blob(),l=await ha(c);break;case"json":l=await o.json();break;case"document":case"text":default:l=await o.text()}const f={};return o.headers.forEach((d,p)=>{f[p]=d}),{data:l,headers:f,status:o.status,url:o.url}}async get(n){return this.request(Object.assign(Object.assign({},n),{method:"GET"}))}async post(n){return this.request(Object.assign(Object.assign({},n),{method:"POST"}))}async put(n){return this.request(Object.assign(Object.assign({},n),{method:"PUT"}))}async patch(n){return this.request(Object.assign(Object.assign({},n),{method:"PATCH"}))}async delete(n){return this.request(Object.assign(Object.assign({},n),{method:"DELETE"}))}}He("CapacitorHttp",{web:()=>new ya});function va(t){t.CapacitorUtils.Synapse=new Proxy({},{get(n,e){return new Proxy({},{get(r,i){return(o,a,s)=>{const l=t.Capacitor.Plugins[e];if(l===void 0){s(new Error(`Capacitor plugin ${e} not found`));return}if(typeof l[i]!="function"){s(new Error(`Method ${i} not found in Capacitor plugin ${e}`));return}(async()=>{try{const c=await l[i](o);a(c)}catch(c){s(c)}})()}}})}})}function wa(t){t.CapacitorUtils.Synapse=new Proxy({},{get(n,e){return t.cordova.plugins[e]}})}function ba(t=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!t?va(window):window.cordova!==void 0&&wa(window))}var bn;(function(t){t.Documents="DOCUMENTS",t.Data="DATA",t.Library="LIBRARY",t.Cache="CACHE",t.External="EXTERNAL",t.ExternalStorage="EXTERNAL_STORAGE",t.ExternalCache="EXTERNAL_CACHE",t.LibraryNoCloud="LIBRARY_NO_CLOUD",t.Temporary="TEMPORARY"})(bn||(bn={}));var Ar;(function(t){t.UTF8="utf8",t.ASCII="ascii",t.UTF16="utf16"})(Ar||(Ar={}));const _a=He("Filesystem",{web:()=>Zr(()=>import("./web-DBT1tb5v.js"),[]).then(t=>new t.FilesystemWeb)});ba();const xa=He("Share",{web:()=>Zr(()=>import("./web-CgOoDQab.js"),[]).then(t=>new t.ShareWeb)}),ka=document.getElementById("image-input"),Jt=document.getElementById("floor-plan"),jt=document.getElementById("new-space-form"),Ea=document.getElementById("new-space-close-btn"),$a=document.getElementById("new-space-name"),Nt=document.getElementById("update-space-form"),Sa=document.getElementById("update-space-close-btn"),Aa=document.getElementById("update-space-delete-btn"),Ca=document.getElementById("update-space-save-btn"),Vr=document.getElementById("update-space-name"),Oa=document.getElementById("update-space-desc"),Cr=document.getElementById("update-space-files"),Ia=document.getElementById("new-space-save-btn"),Se=document.getElementById("dir-name"),Ta=document.getElementById("submit-floor-plan"),_n=na(Jt);let Zt=[],qr=0,ue={minX:0,minY:0,maxX:0,maxY:0},je=0,xn=0,fe={minX:0,minY:0,maxX:0,maxY:0},An="",Kr="",Jr=0,Qr=0,We=0,Ye=0,qt=!1,Cn="";window.addEventListener("DOMContentLoaded",()=>{if(!Jt){console.error("Image element not found!");return}_n.on("createAnnotation",t=>{jt.hidden=!1,qr=t.id;const n=t.target.selector.geometry.bounds;ue.maxX=parseFloat(n.maxX.toFixed(2)),ue.maxY=parseFloat(n.maxY.toFixed(2)),ue.minX=parseFloat(n.minX.toFixed(2)),ue.minY=parseFloat(n.minY.toFixed(2))}),_n.on("updateAnnotation",t=>{je=t.id;const n=ti(je);xn=n.coordinates;const e=t.target.selector.geometry.bounds;if(fe.maxX=parseFloat(e.maxX.toFixed(2)),fe.maxY=parseFloat(e.maxY.toFixed(2)),fe.minX=parseFloat(e.minX.toFixed(2)),fe.minY=parseFloat(e.minY.toFixed(2)),Oa.value=n.desc,Vr.value=n.name,n.files.length===0)Cr.files="";else{const r=new DataTransfer;n.files.forEach(i=>r.items.add(i)),Cr.files=r.files}Nt.hidden=!1})});window.addEventListener("load",()=>{Cn=Ma()});Ea.addEventListener("click",t=>{t.preventDefault(),jt.hidden=!0});Sa.addEventListener("click",t=>{t.preventDefault(),Nt.hidden=!0});Aa.addEventListener("click",async t=>{t.preventDefault();const n=ti(je);_n.removeAnnotation(n.id),Zt=Zt.filter(e=>e.id!==n.id),Nt.hidden=!0});Ca.addEventListener("click",async t=>{t.preventDefault(),Vr.value.trim()||alert("Please enter a title!");const n=new FormData(Nt),e=Zt.findIndex(i=>i.id===je),r=n.getAll("files");e!==-1&&(Zt[e]={...Zt[e],name:n.get("name"),desc:n.get("desc"),files:r,coordinates:Pa(fe,xn)?xn:fe,fileNames:r.map(i=>i.name),color:n.get("color")}),Nt.hidden=!0});Ia.addEventListener("click",async t=>{t.preventDefault(),$a.value.trim()||alert("Please enter a title!");const n=new FormData(jt),e=n.getAll("files"),r={id:qr,name:n.get("name"),desc:n.get("desc"),files:e,coordinates:ue,geometry:"rect",fileNames:e.map(i=>i.name),color:n.get("color")};ue={minX:0,minY:0,maxX:0,maxY:0},Zt.push(r),jt.hidden=!0});jt.addEventListener("mousedown",t=>{qt=!0,We=t.clientX-jt.getBoundingClientRect().left,Ye=t.clientY-jt.getBoundingClientRect().top,jt.style.cursor="grabbing"});document.addEventListener("mousemove",t=>{qt&&(jt.style.left=t.clientX-We+"px",jt.style.top=t.clientY-Ye+"px")});document.addEventListener("mouseup",()=>{qt&&(qt=!1,jt.style.cursor="grab")});Nt.addEventListener("mousedown",t=>{qt=!0,We=t.clientX-Nt.getBoundingClientRect().left,Ye=t.clientY-Nt.getBoundingClientRect().top,Nt.style.cursor="grabbing"});document.addEventListener("mousemove",t=>{qt&&(Nt.style.left=t.clientX-We+"px",Nt.style.top=t.clientY-Ye+"px")});document.addEventListener("mouseup",()=>{qt&&(qt=!1,Nt.style.cursor="grab")});ka.addEventListener("change",function(t){const n=t.target.files[0];if(n){const e=new FileReader;e.onload=function(r){Jt.alt=`Floor Plan: ${n.name}`,Jt.src=r.target.result,Kr=r.target.result,An=n.name,Jt.onload=()=>{Jr=Jt.naturalWidth,Qr=Jt.naturalHeight}},e.readAsDataURL(n)}});Ta.addEventListener("click",async t=>{t.preventDefault();const n=await La();if(Se||alert("Please Enter a project name"),Cn==="Mobile"){const e=await Da(n);Ua(e)}else Ba(n,`${Se.value.trim()}.zip`)});async function La(){const t=new sa,n=Se.value.trim(),e=t.folder(`${n}/assets`),r=Ra(Kr);e.file(An,r),Zt.forEach(o=>{o.files.forEach(a=>{e.file(`${o.id}-${a.name}`,a)})});const i=za(n);return t.file(`${n}/index.html`,i),await t.generateAsync({type:"blob"})}function za(t){return`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${t}</title>
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
      line-height: 1.6;
      background-color: #fafafa;
      color: #1a1a1a;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .header p {
      color: #666;
      font-size: 14px;
      font-weight: 400;
    }

    /* File input styling */
    .file-input-wrapper {
      text-align: center;
      margin-bottom: 30px;
    }

    .file-input-wrapper label {
      display: inline-block;
      padding: 10px 20px;
      background: white;
      color: #1a1a1a;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 400;
      transition: all 0.2s ease;
    }

    .file-input-wrapper label:hover {
      border-color: #1a1a1a;
      background: #fafafa;
    }

    .file-input-wrapper input[type="file"] {
      display: none;
    }

    /* Main container */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }

    /* Image container */
    .image-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
      background: white;
      position: relative;
    }

    /* Wrapper for image and overlays */
    .image-wrapper {
      position: relative;
      display: inline-block;
      max-width: 100%;
    }

    /* Floor plan image */
    #floor-plan {
      max-width: 100%;
      max-height: 70vh;
      border-radius: 2px;
      object-fit: contain;
      display: block;
    }

    /* Overlay container for clickable areas */
    .overlay-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* Individual clickable area */
    .floor-space-area {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      pointer-events: auto;
      opacity: 0.3;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(0,0,0,0.2);
      color: #1a1a1a;
    }

    .floor-space-area:hover {
      opacity: 0.5;
      border-color: rgba(0,0,0,0.4);
    }

    /* Form Styling */
    form {
      background: white;
      padding: 24px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      max-width: 400px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: grab;
      z-index: 1000;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    form:active {
      cursor: grabbing;
    }

    form.hidden {
      display: none;
    }

    form h3 {
      font-size: 18px;
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 20px;
      padding-right: 30px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 16px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      font-size: 14px;
      background-color: #fafafa;
      font-family: inherit;
      resize: vertical;
      min-height: 80px;
      transition: border-color 0.2s ease;
    }

    textarea:focus {
      border-color: #1a1a1a;
      outline: none;
      background-color: white;
    }

    /* Close button */
    button[type="button"] {
      background: white;
      color: #1a1a1a;
      border: 1px solid #e0e0e0;
      padding: 6px;
      border-radius: 2px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 400;
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    button[type="button"]:hover {
      background: #fafafa;
      border-color: #1a1a1a;
    }

    /* Files section */
    #misc-files {
      margin-top: 8px;
      padding: 12px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }

    #misc-files-list {
      list-style: none;
      padding-left: 0;
    }

    #misc-files-list li {
      margin-bottom: 6px;
      padding: 6px 8px;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 2px;
      transition: all 0.15s ease;
    }

    #misc-files-list li:hover {
      border-color: #1a1a1a;
    }

    #misc-files-list a {
      color: #1a1a1a;
      text-decoration: none;
      font-size: 13px;
      font-weight: 400;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #misc-files-list a:before {
      content: "";
      font-size: 14px;
    }

    #misc-files-list a:hover {
      text-decoration: underline;
    }

    .no-files {
      color: #999;
      font-size: 13px;
      text-align: center;
      padding: 8px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }

      .header h1 {
        font-size: 22px;
      }

      .image-container {
        padding: 20px;
      }

      form {
        width: 90%;
        max-width: 90%;
        padding: 20px;
      }

      #floor-plan {
        max-height: 50vh;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>${t}</h1>
    <p>Interactive Floor Plan</p>
  </div>

  <div class="file-input-wrapper">
    <label for="new-image">
      Replace Image
      <input type="file" id="new-image" accept="image/*">
    </label>
  </div>

  <div class="main-container">
    <div class="image-container">
      <div class="image-wrapper">
        <img id="floor-plan" alt="Floor Plan">
        <div class="overlay-container" id="overlay-container">
          <!-- Clickable areas will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <form id="floor-space-form" hidden>
    <button type="button" id="close-form"></button>
    <h3 id="space-name"></h3>
    <label for="space-desc">Description</label>
    <textarea id="space-desc" readonly></textarea>
    <label for="space-files">Files</label>
    <div id="misc-files">
      <ul id="misc-files-list"></ul>
    </div>
  </form>

  <script>
    // Floor spaces data from the editor
    const floorSpaces = ${JSON.stringify(Zt)};
    const originalImageName = "${An}";
    const originalImageWidth = ${Jr};
    const originalImageHeight = ${Qr};

    // DOM references
    const form = document.getElementById('floor-space-form');
    const nameField = document.getElementById('space-name');
    const desc = document.getElementById('space-desc');
    const miscFilesList = document.getElementById('misc-files-list');
    const newImageInput = document.getElementById('new-image');
    const floorPlanImage = document.getElementById('floor-plan');
    const overlayContainer = document.getElementById('overlay-container');

    // Load the original image
    window.addEventListener("load", () => {
      floorPlanImage.src = "./assets/" + originalImageName;
      floorPlanImage.onload = () => {
        updateOverlayAreas();
      };
    });

    // Close form button
    document.getElementById('close-form').addEventListener('click', () => {
      form.hidden = true;
    });

    /**
     * Updates the position and size of overlay areas based on current image dimensions
     */
    function updateOverlayAreas() {
      // Clear existing areas
      overlayContainer.innerHTML = '';

      // Get current displayed dimensions
      const displayedWidth = floorPlanImage.clientWidth;
      const displayedHeight = floorPlanImage.clientHeight;

      // Calculate scale factors
      const scaleX = displayedWidth / originalImageWidth;
      const scaleY = displayedHeight / originalImageHeight;

      // Create overlay areas for each floor space
      floorSpaces.forEach(fs => {
        const { minX, minY, maxX, maxY } = fs.coordinates;

        // Scale coordinates to match displayed image size
        const scaledMinX = minX * scaleX;
        const scaledMinY = minY * scaleY;
        const scaledMaxX = maxX * scaleX;
        const scaledMaxY = maxY * scaleY;

        const width = scaledMaxX - scaledMinX;
        const height = scaledMaxY - scaledMinY;

        // Create the clickable area
        const area = document.createElement('a');
        area.className = 'floor-space-area';
        area.dataset.id = fs.id;
        area.title = fs.name;
        area.style.left = scaledMinX + 'px';
        area.style.top = scaledMinY + 'px';
        area.style.width = width + 'px';
        area.style.height = height + 'px';
        area.style.backgroundColor = fs.color;
        area.textContent = fs.name;

        // Add click handler
        area.addEventListener('click', (event) => {
          event.preventDefault();
          showFloorSpaceDetails(fs);
        });

        overlayContainer.appendChild(area);
      });
    }

    /**
     * Displays the details of a floor space in the form
     * @param {Object} fs - Floor space object
     */
    function showFloorSpaceDetails(fs) {
      // Clear previous file list
      miscFilesList.innerHTML = '';

      // Populate form fields
      nameField.innerText = fs.name;
      desc.value = fs.desc;

      // Create clickable file links
      if (fs.fileNames && fs.fileNames.length > 0) {
        fs.fileNames.forEach(name => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = "./assets/" + fs.id + "-" + name;
          a.target = "_blank";
          a.textContent = name;
          li.appendChild(a);
          miscFilesList.appendChild(li);
        });
      } else {
        const noFiles = document.createElement('div');
        noFiles.className = 'no-files';
        noFiles.textContent = 'No files attached';
        miscFilesList.appendChild(noFiles);
      }

      form.hidden = false;
    }

    // Update overlay areas when window is resized
    window.addEventListener('resize', updateOverlayAreas);

    // Form dragging functionality
    let offsetX, offsetY, isDragging = false;

    form.addEventListener("mousedown", (event) => {
      isDragging = true;
      offsetX = event.clientX - form.getBoundingClientRect().left;
      offsetY = event.clientY - form.getBoundingClientRect().top;
    });

    document.addEventListener("mousemove", (event) => {
      if (isDragging) {
        form.style.left = event.clientX - offsetX + "px";
        form.style.top = event.clientY - offsetY + "px";
        form.style.transform = 'none';
      }
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
    });

    // Replace image functionality
    newImageInput.addEventListener("change", function (event) {
      const file = event.target.files[0];

      if (file) {
        const reader = new FileReader();

        reader.onload = function (e) {
          floorPlanImage.src = e.target.result;
          floorPlanImage.onload = () => {
            updateOverlayAreas();
          };
        };

        reader.readAsDataURL(file);
      }
    });
  <\/script>
</body>
</html>
`}function Ba(t,n){const e=URL.createObjectURL(t),r=document.createElement("a");r.href=e,r.download=n,r.click(),URL.revokeObjectURL(e)}function Ra(t){const[n,e]=t.split(","),r=n.match(/:(.*?);/)[1],i=atob(e),o=i.length,a=new Uint8Array(o);for(let s=0;s<o;s++)a[s]=i.charCodeAt(s);return new Blob([a],{type:r})}function ti(t){return Zt.find(n=>n.id==t)}function Pa(t,n){return t.minX===n.minX&&t.minY===n.minY&&t.maxX===n.maxX&&t.maxY===n.maxY}function Ma(){const t=navigator.userAgent||navigator.vendor||window.opera;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"Mobile":"Desktop"}async function Da(t){return new Promise((n,e)=>{const r=new FileReader;r.onloadend=()=>n(r.result.split(",")[1]),r.onerror=e,r.readAsDataURL(t)})}async function Ua(t){try{const n=await _a.writeFile({path:`${Se.value.trim()}.zip`,data:t,directory:bn.Documents,recursive:!0});return console.log("File saved at:",n.uri),Cn==="Mobile"&&await xa.share({title:`${Se.value.trim()}.zip`,text:"Export your floor plan project",url:n.uri,dialogTitle:"Save or Share Project"}),n}catch(n){console.error("Error saving file:",n),alert("Failed to save project: "+n.message)}}export{Ar as E,Gr as W,ga as b};
